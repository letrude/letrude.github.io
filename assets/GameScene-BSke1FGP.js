import{j as z,u as nt}from"./index-CXmzTZEl.js";import{b as X,e as Ki}from"./react-vendor-B-TwoIBf.js";import{R as Pn,s as ji,t as xn,u as Xs,v as Vs,w as Sn,Q as Fn,x as Ys,V as Ne,y as Et,z as Hn,E as zi,F as Zs,G as lr,H as Pr,I as lt,q as we,C as Ye,J as Wi,K as Qi,X as Xi,Y as Vi,Z as qs,O as Kt,_ as jr,$ as Yi,a0 as Dt,a1 as Zi,a2 as $s,a3 as qi,a4 as $i,a5 as ea,a6 as ot,a7 as pr,a8 as Hr,a9 as ta,aa as ra,ab as na,ac as cr,ad as sa,ae as ei,af as Ft,ag as Nt,ah as ia,ai as On,aj as aa,ak as Ar,al as oa,am as la,an as ca,ao as ua,ap as dn,e as ti,M as wr,d as ri,aq as fa,ar as ha,as as da,at as ni,au as pa,av as It,aw as As,ax as si,ay as Aa,az as kn,aA as ii,aB as va,aC as ma,aD as ga,a as Ba,aE as Ca,aF as Ea,aG as ya,aH as Or,aI as Nn,aJ as it,aK as ai,aL as oi,aM as li,A as ba,p as wt,l as ke,aN as Ta,aO as Ma,aP as xa,aQ as Sa,aR as jt,aS as Jn,L as ci,aT as ui,U as be,f as vs,B as Rr,S as yt,aU as _t,aV as Fa,N as Ra}from"./three-core-Dw7HmUCS.js";import{a as st,s as Da,b as zt,u as bt,e as Ga}from"./react-three-fiber.esm-B_7n75fd.js";import{F as ms}from"./Float-BuYsn__W.js";import{_ as fi}from"./extends-CF3RwP-h.js";const Ua=parseInt(Pn.replace(/\D+/g,""));function gs(n,t){if(t===ji)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),n;if(t===xn||t===Xs){let i=n.getIndex();if(i===null){const s=[],o=n.getAttribute("position");if(o!==void 0){for(let a=0;a<o.count;a++)s.push(a);n.setIndex(s),i=n.getIndex()}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),n}const c=i.count-2,r=[];if(i)if(t===xn)for(let s=1;s<=c;s++)r.push(i.getX(0)),r.push(i.getX(s)),r.push(i.getX(s+1));else for(let s=0;s<c;s++)s%2===0?(r.push(i.getX(s)),r.push(i.getX(s+1)),r.push(i.getX(s+2))):(r.push(i.getX(s+2)),r.push(i.getX(s+1)),r.push(i.getX(s)));r.length/3!==c&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const e=n.clone();return e.setIndex(r),e.clearGroups(),e}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",t),n}function hi(n,t,i={}){const c=new Ne,r=new Hn,e=new Ne,s=new Et,o=new Et,a=new Et;i.preserveMatrix=i.preserveMatrix!==void 0?i.preserveMatrix:!0,i.preservePosition=i.preservePosition!==void 0?i.preservePosition:!0,i.preserveHipPosition=i.preserveHipPosition!==void 0?i.preserveHipPosition:!1,i.useTargetMatrix=i.useTargetMatrix!==void 0?i.useTargetMatrix:!1,i.hip=i.hip!==void 0?i.hip:"hip",i.names=i.names||{};const l=t.isObject3D?t.skeleton.bones:kr(t),u=n.isObject3D?n.skeleton.bones:kr(n);let f,h,d,p,v;if(n.isObject3D?n.skeleton.pose():(i.useTargetMatrix=!0,i.preserveMatrix=!1),i.preservePosition){v=[];for(let A=0;A<u.length;A++)v.push(u[A].position.clone())}if(i.preserveMatrix){n.updateMatrixWorld(),n.matrixWorld.identity();for(let A=0;A<n.children.length;++A)n.children[A].updateMatrixWorld(!0)}if(i.offsets){f=[];for(let A=0;A<u.length;++A)h=u[A],d=i.names[h.name]||h.name,i.offsets[d]&&(h.matrix.multiply(i.offsets[d]),h.matrix.decompose(h.position,h.quaternion,h.scale),h.updateMatrixWorld()),f.push(h.matrixWorld.clone())}for(let A=0;A<u.length;++A){if(h=u[A],d=i.names[h.name]||h.name,p=di(d,l),a.copy(h.matrixWorld),p){if(p.updateMatrixWorld(),i.useTargetMatrix?o.copy(p.matrixWorld):(o.copy(n.matrixWorld).invert(),o.multiply(p.matrixWorld)),e.setFromMatrixScale(o),o.scale(e.set(1/e.x,1/e.y,1/e.z)),a.makeRotationFromQuaternion(r.setFromRotationMatrix(o)),n.isObject3D){const E=u.indexOf(h),m=f?f[E]:s.copy(n.skeleton.boneInverses[E]).invert();a.multiply(m)}a.copyPosition(o)}h.parent&&h.parent.isBone?(h.matrix.copy(h.parent.matrixWorld).invert(),h.matrix.multiply(a)):h.matrix.copy(a),i.preserveHipPosition&&d===i.hip&&h.matrix.setPosition(c.set(0,h.position.y,0)),h.matrix.decompose(h.position,h.quaternion,h.scale),h.updateMatrixWorld()}if(i.preservePosition)for(let A=0;A<u.length;++A)h=u[A],d=i.names[h.name]||h.name,d!==i.hip&&h.position.copy(v[A]);i.preserveMatrix&&n.updateMatrixWorld(!0)}function Ia(n,t,i,c={}){c.useFirstFramePosition=c.useFirstFramePosition!==void 0?c.useFirstFramePosition:!1,c.fps=c.fps!==void 0?c.fps:30,c.names=c.names||[],t.isObject3D||(t=_a(t));const r=Math.round(i.duration*(c.fps/1e3)*1e3),e=1/c.fps,s=[],o=new Vs(t),a=kr(n.skeleton),l=[];let u,f,h,d,p;o.clipAction(i).play(),o.update(0),t.updateMatrixWorld();for(let v=0;v<r;++v){const A=v*e;hi(n,t,c);for(let E=0;E<a.length;++E)p=c.names[a[E].name]||a[E].name,h=di(p,t.skeleton),h&&(f=a[E],d=l[E]=l[E]||{bone:f},c.hip===p&&(d.pos||(d.pos={times:new Float32Array(r),values:new Float32Array(r*3)}),c.useFirstFramePosition&&(v===0&&(u=f.position.clone()),f.position.sub(u)),d.pos.times[v]=A,f.position.toArray(d.pos.values,v*3)),d.quat||(d.quat={times:new Float32Array(r),values:new Float32Array(r*4)}),d.quat.times[v]=A,f.quaternion.toArray(d.quat.values,v*4));o.update(e),t.updateMatrixWorld()}for(let v=0;v<l.length;++v)d=l[v],d&&(d.pos&&s.push(new Sn(".bones["+d.bone.name+"].position",d.pos.times,d.pos.values)),s.push(new Fn(".bones["+d.bone.name+"].quaternion",d.quat.times,d.quat.values)));return o.uncacheAction(i),new Ys(i.name,-1,s)}function wa(n){const t=new Map,i=new Map,c=n.clone();return pi(n,c,function(r,e){t.set(e,r),i.set(r,e)}),c.traverse(function(r){if(!r.isSkinnedMesh)return;const e=r,s=t.get(r),o=s.skeleton.bones;e.skeleton=s.skeleton.clone(),e.bindMatrix.copy(s.bindMatrix),e.skeleton.bones=o.map(function(a){return i.get(a)}),e.bind(e.skeleton,e.bindMatrix)}),c}function di(n,t){for(let i=0,c=kr(t);i<c.length;i++)if(n===c[i].name)return c[i]}function kr(n){return Array.isArray(n)?n:n.bones}function _a(n){const t=new zi(n.bones[0]);return t.skeleton=n,t}function pi(n,t,i){i(n,t);for(let c=0;c<n.children.length;c++)pi(n.children[c],t.children[c],i)}const Nr={retarget:hi,retargetClip:Ia,clone:wa};function Jr(n){if(typeof TextDecoder<"u")return new TextDecoder().decode(n);let t="";for(let i=0,c=n.length;i<c;i++)t+=String.fromCharCode(n[i]);try{return decodeURIComponent(escape(t))}catch{return t}}const Rt="srgb",ht="srgb-linear",Bs=3001,La=3e3;class Kn extends Zs{constructor(t){super(t),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(i){return new Na(i)}),this.register(function(i){return new Ja(i)}),this.register(function(i){return new Za(i)}),this.register(function(i){return new qa(i)}),this.register(function(i){return new $a(i)}),this.register(function(i){return new ja(i)}),this.register(function(i){return new za(i)}),this.register(function(i){return new Wa(i)}),this.register(function(i){return new Qa(i)}),this.register(function(i){return new ka(i)}),this.register(function(i){return new Xa(i)}),this.register(function(i){return new Ka(i)}),this.register(function(i){return new Ya(i)}),this.register(function(i){return new Va(i)}),this.register(function(i){return new Ha(i)}),this.register(function(i){return new eo(i)}),this.register(function(i){return new to(i)})}load(t,i,c,r){const e=this;let s;if(this.resourcePath!=="")s=this.resourcePath;else if(this.path!==""){const l=lr.extractUrlBase(t);s=lr.resolveURL(l,this.path)}else s=lr.extractUrlBase(t);this.manager.itemStart(t);const o=function(l){r?r(l):console.error(l),e.manager.itemError(t),e.manager.itemEnd(t)},a=new Pr(this.manager);a.setPath(this.path),a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(t,function(l){try{e.parse(l,s,function(u){i(u),e.manager.itemEnd(t)},o)}catch(u){o(u)}},c,o)}setDRACOLoader(t){return this.dracoLoader=t,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(t){return this.ktx2Loader=t,this}setMeshoptDecoder(t){return this.meshoptDecoder=t,this}register(t){return this.pluginCallbacks.indexOf(t)===-1&&this.pluginCallbacks.push(t),this}unregister(t){return this.pluginCallbacks.indexOf(t)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(t),1),this}parse(t,i,c,r){let e;const s={},o={};if(typeof t=="string")e=JSON.parse(t);else if(t instanceof ArrayBuffer)if(Jr(new Uint8Array(t.slice(0,4)))===Ai){try{s[Ce.KHR_BINARY_GLTF]=new ro(t)}catch(u){r&&r(u);return}e=JSON.parse(s[Ce.KHR_BINARY_GLTF].content)}else e=JSON.parse(Jr(new Uint8Array(t)));else e=t;if(e.asset===void 0||e.asset.version[0]<2){r&&r(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const a=new vo(e,{path:i||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});a.fileLoader.setRequestHeader(this.requestHeader);for(let l=0;l<this.pluginCallbacks.length;l++){const u=this.pluginCallbacks[l](a);u.name||console.error("THREE.GLTFLoader: Invalid plugin found: missing name"),o[u.name]=u,s[u.name]=!0}if(e.extensionsUsed)for(let l=0;l<e.extensionsUsed.length;++l){const u=e.extensionsUsed[l],f=e.extensionsRequired||[];switch(u){case Ce.KHR_MATERIALS_UNLIT:s[u]=new Oa;break;case Ce.KHR_DRACO_MESH_COMPRESSION:s[u]=new no(e,this.dracoLoader);break;case Ce.KHR_TEXTURE_TRANSFORM:s[u]=new so;break;case Ce.KHR_MESH_QUANTIZATION:s[u]=new io;break;default:f.indexOf(u)>=0&&o[u]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+u+'".')}}a.setExtensions(s),a.setPlugins(o),a.parse(c,r)}parseAsync(t,i){const c=this;return new Promise(function(r,e){c.parse(t,i,r,e)})}}function Pa(){let n={};return{get:function(t){return n[t]},add:function(t,i){n[t]=i},remove:function(t){delete n[t]},removeAll:function(){n={}}}}const Ce={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_DISPERSION:"KHR_materials_dispersion",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_MATERIALS_BUMP:"EXT_materials_bump",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class Ha{constructor(t){this.parser=t,this.name=Ce.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const t=this.parser,i=this.parser.json.nodes||[];for(let c=0,r=i.length;c<r;c++){const e=i[c];e.extensions&&e.extensions[this.name]&&e.extensions[this.name].light!==void 0&&t._addNodeRef(this.cache,e.extensions[this.name].light)}}_loadLight(t){const i=this.parser,c="light:"+t;let r=i.cache.get(c);if(r)return r;const e=i.json,a=((e.extensions&&e.extensions[this.name]||{}).lights||[])[t];let l;const u=new Ye(16777215);a.color!==void 0&&u.setRGB(a.color[0],a.color[1],a.color[2],ht);const f=a.range!==void 0?a.range:0;switch(a.type){case"directional":l=new Xi(u),l.target.position.set(0,0,-1),l.add(l.target);break;case"point":l=new Qi(u),l.distance=f;break;case"spot":l=new Wi(u),l.distance=f,a.spot=a.spot||{},a.spot.innerConeAngle=a.spot.innerConeAngle!==void 0?a.spot.innerConeAngle:0,a.spot.outerConeAngle=a.spot.outerConeAngle!==void 0?a.spot.outerConeAngle:Math.PI/4,l.angle=a.spot.outerConeAngle,l.penumbra=1-a.spot.innerConeAngle/a.spot.outerConeAngle,l.target.position.set(0,0,-1),l.add(l.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+a.type)}return l.position.set(0,0,0),l.decay=2,ft(l,a),a.intensity!==void 0&&(l.intensity=a.intensity),l.name=i.createUniqueName(a.name||"light_"+t),r=Promise.resolve(l),i.cache.add(c,r),r}getDependency(t,i){if(t==="light")return this._loadLight(i)}createNodeAttachment(t){const i=this,c=this.parser,e=c.json.nodes[t],o=(e.extensions&&e.extensions[this.name]||{}).light;return o===void 0?null:this._loadLight(o).then(function(a){return c._getNodeRef(i.cache,o,a)})}}class Oa{constructor(){this.name=Ce.KHR_MATERIALS_UNLIT}getMaterialType(){return Nt}extendParams(t,i,c){const r=[];t.color=new Ye(1,1,1),t.opacity=1;const e=i.pbrMetallicRoughness;if(e){if(Array.isArray(e.baseColorFactor)){const s=e.baseColorFactor;t.color.setRGB(s[0],s[1],s[2],ht),t.opacity=s[3]}e.baseColorTexture!==void 0&&r.push(c.assignTexture(t,"map",e.baseColorTexture,Rt))}return Promise.all(r)}}class ka{constructor(t){this.parser=t,this.name=Ce.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(t,i){const r=this.parser.json.materials[t];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const e=r.extensions[this.name].emissiveStrength;return e!==void 0&&(i.emissiveIntensity=e),Promise.resolve()}}class Na{constructor(t){this.parser=t,this.name=Ce.KHR_MATERIALS_CLEARCOAT}getMaterialType(t){const c=this.parser.json.materials[t];return!c.extensions||!c.extensions[this.name]?null:lt}extendMaterialParams(t,i){const c=this.parser,r=c.json.materials[t];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const e=[],s=r.extensions[this.name];if(s.clearcoatFactor!==void 0&&(i.clearcoat=s.clearcoatFactor),s.clearcoatTexture!==void 0&&e.push(c.assignTexture(i,"clearcoatMap",s.clearcoatTexture)),s.clearcoatRoughnessFactor!==void 0&&(i.clearcoatRoughness=s.clearcoatRoughnessFactor),s.clearcoatRoughnessTexture!==void 0&&e.push(c.assignTexture(i,"clearcoatRoughnessMap",s.clearcoatRoughnessTexture)),s.clearcoatNormalTexture!==void 0&&(e.push(c.assignTexture(i,"clearcoatNormalMap",s.clearcoatNormalTexture)),s.clearcoatNormalTexture.scale!==void 0)){const o=s.clearcoatNormalTexture.scale;i.clearcoatNormalScale=new we(o,o)}return Promise.all(e)}}class Ja{constructor(t){this.parser=t,this.name=Ce.KHR_MATERIALS_DISPERSION}getMaterialType(t){const c=this.parser.json.materials[t];return!c.extensions||!c.extensions[this.name]?null:lt}extendMaterialParams(t,i){const r=this.parser.json.materials[t];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const e=r.extensions[this.name];return i.dispersion=e.dispersion!==void 0?e.dispersion:0,Promise.resolve()}}class Ka{constructor(t){this.parser=t,this.name=Ce.KHR_MATERIALS_IRIDESCENCE}getMaterialType(t){const c=this.parser.json.materials[t];return!c.extensions||!c.extensions[this.name]?null:lt}extendMaterialParams(t,i){const c=this.parser,r=c.json.materials[t];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const e=[],s=r.extensions[this.name];return s.iridescenceFactor!==void 0&&(i.iridescence=s.iridescenceFactor),s.iridescenceTexture!==void 0&&e.push(c.assignTexture(i,"iridescenceMap",s.iridescenceTexture)),s.iridescenceIor!==void 0&&(i.iridescenceIOR=s.iridescenceIor),i.iridescenceThicknessRange===void 0&&(i.iridescenceThicknessRange=[100,400]),s.iridescenceThicknessMinimum!==void 0&&(i.iridescenceThicknessRange[0]=s.iridescenceThicknessMinimum),s.iridescenceThicknessMaximum!==void 0&&(i.iridescenceThicknessRange[1]=s.iridescenceThicknessMaximum),s.iridescenceThicknessTexture!==void 0&&e.push(c.assignTexture(i,"iridescenceThicknessMap",s.iridescenceThicknessTexture)),Promise.all(e)}}class ja{constructor(t){this.parser=t,this.name=Ce.KHR_MATERIALS_SHEEN}getMaterialType(t){const c=this.parser.json.materials[t];return!c.extensions||!c.extensions[this.name]?null:lt}extendMaterialParams(t,i){const c=this.parser,r=c.json.materials[t];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const e=[];i.sheenColor=new Ye(0,0,0),i.sheenRoughness=0,i.sheen=1;const s=r.extensions[this.name];if(s.sheenColorFactor!==void 0){const o=s.sheenColorFactor;i.sheenColor.setRGB(o[0],o[1],o[2],ht)}return s.sheenRoughnessFactor!==void 0&&(i.sheenRoughness=s.sheenRoughnessFactor),s.sheenColorTexture!==void 0&&e.push(c.assignTexture(i,"sheenColorMap",s.sheenColorTexture,Rt)),s.sheenRoughnessTexture!==void 0&&e.push(c.assignTexture(i,"sheenRoughnessMap",s.sheenRoughnessTexture)),Promise.all(e)}}class za{constructor(t){this.parser=t,this.name=Ce.KHR_MATERIALS_TRANSMISSION}getMaterialType(t){const c=this.parser.json.materials[t];return!c.extensions||!c.extensions[this.name]?null:lt}extendMaterialParams(t,i){const c=this.parser,r=c.json.materials[t];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const e=[],s=r.extensions[this.name];return s.transmissionFactor!==void 0&&(i.transmission=s.transmissionFactor),s.transmissionTexture!==void 0&&e.push(c.assignTexture(i,"transmissionMap",s.transmissionTexture)),Promise.all(e)}}class Wa{constructor(t){this.parser=t,this.name=Ce.KHR_MATERIALS_VOLUME}getMaterialType(t){const c=this.parser.json.materials[t];return!c.extensions||!c.extensions[this.name]?null:lt}extendMaterialParams(t,i){const c=this.parser,r=c.json.materials[t];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const e=[],s=r.extensions[this.name];i.thickness=s.thicknessFactor!==void 0?s.thicknessFactor:0,s.thicknessTexture!==void 0&&e.push(c.assignTexture(i,"thicknessMap",s.thicknessTexture)),i.attenuationDistance=s.attenuationDistance||1/0;const o=s.attenuationColor||[1,1,1];return i.attenuationColor=new Ye().setRGB(o[0],o[1],o[2],ht),Promise.all(e)}}class Qa{constructor(t){this.parser=t,this.name=Ce.KHR_MATERIALS_IOR}getMaterialType(t){const c=this.parser.json.materials[t];return!c.extensions||!c.extensions[this.name]?null:lt}extendMaterialParams(t,i){const r=this.parser.json.materials[t];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const e=r.extensions[this.name];return i.ior=e.ior!==void 0?e.ior:1.5,Promise.resolve()}}class Xa{constructor(t){this.parser=t,this.name=Ce.KHR_MATERIALS_SPECULAR}getMaterialType(t){const c=this.parser.json.materials[t];return!c.extensions||!c.extensions[this.name]?null:lt}extendMaterialParams(t,i){const c=this.parser,r=c.json.materials[t];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const e=[],s=r.extensions[this.name];i.specularIntensity=s.specularFactor!==void 0?s.specularFactor:1,s.specularTexture!==void 0&&e.push(c.assignTexture(i,"specularIntensityMap",s.specularTexture));const o=s.specularColorFactor||[1,1,1];return i.specularColor=new Ye().setRGB(o[0],o[1],o[2],ht),s.specularColorTexture!==void 0&&e.push(c.assignTexture(i,"specularColorMap",s.specularColorTexture,Rt)),Promise.all(e)}}class Va{constructor(t){this.parser=t,this.name=Ce.EXT_MATERIALS_BUMP}getMaterialType(t){const c=this.parser.json.materials[t];return!c.extensions||!c.extensions[this.name]?null:lt}extendMaterialParams(t,i){const c=this.parser,r=c.json.materials[t];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const e=[],s=r.extensions[this.name];return i.bumpScale=s.bumpFactor!==void 0?s.bumpFactor:1,s.bumpTexture!==void 0&&e.push(c.assignTexture(i,"bumpMap",s.bumpTexture)),Promise.all(e)}}class Ya{constructor(t){this.parser=t,this.name=Ce.KHR_MATERIALS_ANISOTROPY}getMaterialType(t){const c=this.parser.json.materials[t];return!c.extensions||!c.extensions[this.name]?null:lt}extendMaterialParams(t,i){const c=this.parser,r=c.json.materials[t];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const e=[],s=r.extensions[this.name];return s.anisotropyStrength!==void 0&&(i.anisotropy=s.anisotropyStrength),s.anisotropyRotation!==void 0&&(i.anisotropyRotation=s.anisotropyRotation),s.anisotropyTexture!==void 0&&e.push(c.assignTexture(i,"anisotropyMap",s.anisotropyTexture)),Promise.all(e)}}class Za{constructor(t){this.parser=t,this.name=Ce.KHR_TEXTURE_BASISU}loadTexture(t){const i=this.parser,c=i.json,r=c.textures[t];if(!r.extensions||!r.extensions[this.name])return null;const e=r.extensions[this.name],s=i.options.ktx2Loader;if(!s){if(c.extensionsRequired&&c.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return i.loadTextureImage(t,e.source,s)}}class qa{constructor(t){this.parser=t,this.name=Ce.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(t){const i=this.name,c=this.parser,r=c.json,e=r.textures[t];if(!e.extensions||!e.extensions[i])return null;const s=e.extensions[i],o=r.images[s.source];let a=c.textureLoader;if(o.uri){const l=c.options.manager.getHandler(o.uri);l!==null&&(a=l)}return this.detectSupport().then(function(l){if(l)return c.loadTextureImage(t,s.source,a);if(r.extensionsRequired&&r.extensionsRequired.indexOf(i)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return c.loadTexture(t)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(t){const i=new Image;i.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",i.onload=i.onerror=function(){t(i.height===1)}})),this.isSupported}}class $a{constructor(t){this.parser=t,this.name=Ce.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(t){const i=this.name,c=this.parser,r=c.json,e=r.textures[t];if(!e.extensions||!e.extensions[i])return null;const s=e.extensions[i],o=r.images[s.source];let a=c.textureLoader;if(o.uri){const l=c.options.manager.getHandler(o.uri);l!==null&&(a=l)}return this.detectSupport().then(function(l){if(l)return c.loadTextureImage(t,s.source,a);if(r.extensionsRequired&&r.extensionsRequired.indexOf(i)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return c.loadTexture(t)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(t){const i=new Image;i.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",i.onload=i.onerror=function(){t(i.height===1)}})),this.isSupported}}class eo{constructor(t){this.name=Ce.EXT_MESHOPT_COMPRESSION,this.parser=t}loadBufferView(t){const i=this.parser.json,c=i.bufferViews[t];if(c.extensions&&c.extensions[this.name]){const r=c.extensions[this.name],e=this.parser.getDependency("buffer",r.buffer),s=this.parser.options.meshoptDecoder;if(!s||!s.supported){if(i.extensionsRequired&&i.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return e.then(function(o){const a=r.byteOffset||0,l=r.byteLength||0,u=r.count,f=r.byteStride,h=new Uint8Array(o,a,l);return s.decodeGltfBufferAsync?s.decodeGltfBufferAsync(u,f,h,r.mode,r.filter).then(function(d){return d.buffer}):s.ready.then(function(){const d=new ArrayBuffer(u*f);return s.decodeGltfBuffer(new Uint8Array(d),u,f,h,r.mode,r.filter),d})})}else return null}}class to{constructor(t){this.name=Ce.EXT_MESH_GPU_INSTANCING,this.parser=t}createNodeMesh(t){const i=this.parser.json,c=i.nodes[t];if(!c.extensions||!c.extensions[this.name]||c.mesh===void 0)return null;const r=i.meshes[c.mesh];for(const l of r.primitives)if(l.mode!==qe.TRIANGLES&&l.mode!==qe.TRIANGLE_STRIP&&l.mode!==qe.TRIANGLE_FAN&&l.mode!==void 0)return null;const s=c.extensions[this.name].attributes,o=[],a={};for(const l in s)o.push(this.parser.getDependency("accessor",s[l]).then(u=>(a[l]=u,a[l])));return o.length<1?null:(o.push(this.parser.createNodeMesh(t)),Promise.all(o).then(l=>{const u=l.pop(),f=u.isGroup?u.children:[u],h=l[0].count,d=[];for(const p of f){const v=new Et,A=new Ne,E=new Hn,m=new Ne(1,1,1),C=new Vi(p.geometry,p.material,h);for(let g=0;g<h;g++)a.TRANSLATION&&A.fromBufferAttribute(a.TRANSLATION,g),a.ROTATION&&E.fromBufferAttribute(a.ROTATION,g),a.SCALE&&m.fromBufferAttribute(a.SCALE,g),C.setMatrixAt(g,v.compose(A,E,m));for(const g in a)if(g==="_COLOR_0"){const T=a[g];C.instanceColor=new qs(T.array,T.itemSize,T.normalized)}else g!=="TRANSLATION"&&g!=="ROTATION"&&g!=="SCALE"&&p.geometry.setAttribute(g,a[g]);Kt.prototype.copy.call(C,p),this.parser.assignFinalMaterial(C),d.push(C)}return u.isGroup?(u.clear(),u.add(...d),u):d[0]}))}}const Ai="glTF",nr=12,Cs={JSON:1313821514,BIN:5130562};class ro{constructor(t){this.name=Ce.KHR_BINARY_GLTF,this.content=null,this.body=null;const i=new DataView(t,0,nr);if(this.header={magic:Jr(new Uint8Array(t.slice(0,4))),version:i.getUint32(4,!0),length:i.getUint32(8,!0)},this.header.magic!==Ai)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const c=this.header.length-nr,r=new DataView(t,nr);let e=0;for(;e<c;){const s=r.getUint32(e,!0);e+=4;const o=r.getUint32(e,!0);if(e+=4,o===Cs.JSON){const a=new Uint8Array(t,nr+e,s);this.content=Jr(a)}else if(o===Cs.BIN){const a=nr+e;this.body=t.slice(a,a+s)}e+=s}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class no{constructor(t,i){if(!i)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=Ce.KHR_DRACO_MESH_COMPRESSION,this.json=t,this.dracoLoader=i,this.dracoLoader.preload()}decodePrimitive(t,i){const c=this.json,r=this.dracoLoader,e=t.extensions[this.name].bufferView,s=t.extensions[this.name].attributes,o={},a={},l={};for(const u in s){const f=Rn[u]||u.toLowerCase();o[f]=s[u]}for(const u in t.attributes){const f=Rn[u]||u.toLowerCase();if(s[u]!==void 0){const h=c.accessors[t.attributes[u]],d=Jt[h.componentType];l[f]=d.name,a[f]=h.normalized===!0}}return i.getDependency("bufferView",e).then(function(u){return new Promise(function(f,h){r.decodeDracoFile(u,function(d){for(const p in d.attributes){const v=d.attributes[p],A=a[p];A!==void 0&&(v.normalized=A)}f(d)},o,l,ht,h)})})}}class so{constructor(){this.name=Ce.KHR_TEXTURE_TRANSFORM}extendTexture(t,i){return(i.texCoord===void 0||i.texCoord===t.channel)&&i.offset===void 0&&i.rotation===void 0&&i.scale===void 0||(t=t.clone(),i.texCoord!==void 0&&(t.channel=i.texCoord),i.offset!==void 0&&t.offset.fromArray(i.offset),i.rotation!==void 0&&(t.rotation=i.rotation),i.scale!==void 0&&t.repeat.fromArray(i.scale),t.needsUpdate=!0),t}}class io{constructor(){this.name=Ce.KHR_MESH_QUANTIZATION}}class vi extends Aa{constructor(t,i,c,r){super(t,i,c,r)}copySampleValue_(t){const i=this.resultBuffer,c=this.sampleValues,r=this.valueSize,e=t*r*3+r;for(let s=0;s!==r;s++)i[s]=c[e+s];return i}interpolate_(t,i,c,r){const e=this.resultBuffer,s=this.sampleValues,o=this.valueSize,a=o*2,l=o*3,u=r-i,f=(c-i)/u,h=f*f,d=h*f,p=t*l,v=p-l,A=-2*d+3*h,E=d-h,m=1-A,C=E-h+f;for(let g=0;g!==o;g++){const T=s[v+g+o],G=s[v+g+a]*u,M=s[p+g+o],b=s[p+g]*u;e[g]=m*T+C*G+A*M+E*b}return e}}const ao=new Hn;class oo extends vi{interpolate_(t,i,c,r){const e=super.interpolate_(t,i,c,r);return ao.fromArray(e).normalize().toArray(e),e}}const qe={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},Jt={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},Es={9728:pr,9729:ot,9984:ea,9985:$i,9986:qi,9987:$s},ys={33071:ra,33648:ta,10497:Hr},pn={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Rn={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",...Ua>=152?{TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3"}:{TEXCOORD_0:"uv",TEXCOORD_1:"uv2"},COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},Bt={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},lo={CUBICSPLINE:void 0,LINEAR:ni,STEP:da},An={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function co(n){return n.DefaultMaterial===void 0&&(n.DefaultMaterial=new ei({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:si})),n.DefaultMaterial}function xt(n,t,i){for(const c in i.extensions)n[c]===void 0&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[c]=i.extensions[c])}function ft(n,t){t.extras!==void 0&&(typeof t.extras=="object"?Object.assign(n.userData,t.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+t.extras))}function uo(n,t,i){let c=!1,r=!1,e=!1;for(let l=0,u=t.length;l<u;l++){const f=t[l];if(f.POSITION!==void 0&&(c=!0),f.NORMAL!==void 0&&(r=!0),f.COLOR_0!==void 0&&(e=!0),c&&r&&e)break}if(!c&&!r&&!e)return Promise.resolve(n);const s=[],o=[],a=[];for(let l=0,u=t.length;l<u;l++){const f=t[l];if(c){const h=f.POSITION!==void 0?i.getDependency("accessor",f.POSITION):n.attributes.position;s.push(h)}if(r){const h=f.NORMAL!==void 0?i.getDependency("accessor",f.NORMAL):n.attributes.normal;o.push(h)}if(e){const h=f.COLOR_0!==void 0?i.getDependency("accessor",f.COLOR_0):n.attributes.color;a.push(h)}}return Promise.all([Promise.all(s),Promise.all(o),Promise.all(a)]).then(function(l){const u=l[0],f=l[1],h=l[2];return c&&(n.morphAttributes.position=u),r&&(n.morphAttributes.normal=f),e&&(n.morphAttributes.color=h),n.morphTargetsRelative=!0,n})}function fo(n,t){if(n.updateMorphTargets(),t.weights!==void 0)for(let i=0,c=t.weights.length;i<c;i++)n.morphTargetInfluences[i]=t.weights[i];if(t.extras&&Array.isArray(t.extras.targetNames)){const i=t.extras.targetNames;if(n.morphTargetInfluences.length===i.length){n.morphTargetDictionary={};for(let c=0,r=i.length;c<r;c++)n.morphTargetDictionary[i[c]]=c}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function ho(n){let t;const i=n.extensions&&n.extensions[Ce.KHR_DRACO_MESH_COMPRESSION];if(i?t="draco:"+i.bufferView+":"+i.indices+":"+vn(i.attributes):t=n.indices+":"+vn(n.attributes)+":"+n.mode,n.targets!==void 0)for(let c=0,r=n.targets.length;c<r;c++)t+=":"+vn(n.targets[c]);return t}function vn(n){let t="";const i=Object.keys(n).sort();for(let c=0,r=i.length;c<r;c++)t+=i[c]+":"+n[i[c]]+";";return t}function Dn(n){switch(n){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function po(n){return n.search(/\.jpe?g($|\?)/i)>0||n.search(/^data\:image\/jpeg/)===0?"image/jpeg":n.search(/\.webp($|\?)/i)>0||n.search(/^data\:image\/webp/)===0?"image/webp":"image/png"}const Ao=new Et;class vo{constructor(t={},i={}){this.json=t,this.extensions={},this.plugins={},this.options=i,this.cache=new Pa,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let c=!1,r=!1,e=-1;typeof navigator<"u"&&typeof navigator.userAgent<"u"&&(c=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)===!0,r=navigator.userAgent.indexOf("Firefox")>-1,e=r?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1),typeof createImageBitmap>"u"||c||r&&e<98?this.textureLoader=new jr(this.options.manager):this.textureLoader=new Yi(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new Pr(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(t){this.extensions=t}setPlugins(t){this.plugins=t}parse(t,i){const c=this,r=this.json,e=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(s){return s._markDefs&&s._markDefs()}),Promise.all(this._invokeAll(function(s){return s.beforeRoot&&s.beforeRoot()})).then(function(){return Promise.all([c.getDependencies("scene"),c.getDependencies("animation"),c.getDependencies("camera")])}).then(function(s){const o={scene:s[0][r.scene||0],scenes:s[0],animations:s[1],cameras:s[2],asset:r.asset,parser:c,userData:{}};return xt(e,o,r),ft(o,r),Promise.all(c._invokeAll(function(a){return a.afterRoot&&a.afterRoot(o)})).then(function(){for(const a of o.scenes)a.updateMatrixWorld();t(o)})}).catch(i)}_markDefs(){const t=this.json.nodes||[],i=this.json.skins||[],c=this.json.meshes||[];for(let r=0,e=i.length;r<e;r++){const s=i[r].joints;for(let o=0,a=s.length;o<a;o++)t[s[o]].isBone=!0}for(let r=0,e=t.length;r<e;r++){const s=t[r];s.mesh!==void 0&&(this._addNodeRef(this.meshCache,s.mesh),s.skin!==void 0&&(c[s.mesh].isSkinnedMesh=!0)),s.camera!==void 0&&this._addNodeRef(this.cameraCache,s.camera)}}_addNodeRef(t,i){i!==void 0&&(t.refs[i]===void 0&&(t.refs[i]=t.uses[i]=0),t.refs[i]++)}_getNodeRef(t,i,c){if(t.refs[i]<=1)return c;const r=c.clone(),e=(s,o)=>{const a=this.associations.get(s);a!=null&&this.associations.set(o,a);for(const[l,u]of s.children.entries())e(u,o.children[l])};return e(c,r),r.name+="_instance_"+t.uses[i]++,r}_invokeOne(t){const i=Object.values(this.plugins);i.push(this);for(let c=0;c<i.length;c++){const r=t(i[c]);if(r)return r}return null}_invokeAll(t){const i=Object.values(this.plugins);i.unshift(this);const c=[];for(let r=0;r<i.length;r++){const e=t(i[r]);e&&c.push(e)}return c}getDependency(t,i){const c=t+":"+i;let r=this.cache.get(c);if(!r){switch(t){case"scene":r=this.loadScene(i);break;case"node":r=this._invokeOne(function(e){return e.loadNode&&e.loadNode(i)});break;case"mesh":r=this._invokeOne(function(e){return e.loadMesh&&e.loadMesh(i)});break;case"accessor":r=this.loadAccessor(i);break;case"bufferView":r=this._invokeOne(function(e){return e.loadBufferView&&e.loadBufferView(i)});break;case"buffer":r=this.loadBuffer(i);break;case"material":r=this._invokeOne(function(e){return e.loadMaterial&&e.loadMaterial(i)});break;case"texture":r=this._invokeOne(function(e){return e.loadTexture&&e.loadTexture(i)});break;case"skin":r=this.loadSkin(i);break;case"animation":r=this._invokeOne(function(e){return e.loadAnimation&&e.loadAnimation(i)});break;case"camera":r=this.loadCamera(i);break;default:if(r=this._invokeOne(function(e){return e!=this&&e.getDependency&&e.getDependency(t,i)}),!r)throw new Error("Unknown type: "+t);break}this.cache.add(c,r)}return r}getDependencies(t){let i=this.cache.get(t);if(!i){const c=this,r=this.json[t+(t==="mesh"?"es":"s")]||[];i=Promise.all(r.map(function(e,s){return c.getDependency(t,s)})),this.cache.add(t,i)}return i}loadBuffer(t){const i=this.json.buffers[t],c=this.fileLoader;if(i.type&&i.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+i.type+" buffer type is not supported.");if(i.uri===void 0&&t===0)return Promise.resolve(this.extensions[Ce.KHR_BINARY_GLTF].body);const r=this.options;return new Promise(function(e,s){c.load(lr.resolveURL(i.uri,r.path),e,void 0,function(){s(new Error('THREE.GLTFLoader: Failed to load buffer "'+i.uri+'".'))})})}loadBufferView(t){const i=this.json.bufferViews[t];return this.getDependency("buffer",i.buffer).then(function(c){const r=i.byteLength||0,e=i.byteOffset||0;return c.slice(e,e+r)})}loadAccessor(t){const i=this,c=this.json,r=this.json.accessors[t];if(r.bufferView===void 0&&r.sparse===void 0){const s=pn[r.type],o=Jt[r.componentType],a=r.normalized===!0,l=new o(r.count*s);return Promise.resolve(new Dt(l,s,a))}const e=[];return r.bufferView!==void 0?e.push(this.getDependency("bufferView",r.bufferView)):e.push(null),r.sparse!==void 0&&(e.push(this.getDependency("bufferView",r.sparse.indices.bufferView)),e.push(this.getDependency("bufferView",r.sparse.values.bufferView))),Promise.all(e).then(function(s){const o=s[0],a=pn[r.type],l=Jt[r.componentType],u=l.BYTES_PER_ELEMENT,f=u*a,h=r.byteOffset||0,d=r.bufferView!==void 0?c.bufferViews[r.bufferView].byteStride:void 0,p=r.normalized===!0;let v,A;if(d&&d!==f){const E=Math.floor(h/d),m="InterleavedBuffer:"+r.bufferView+":"+r.componentType+":"+E+":"+r.count;let C=i.cache.get(m);C||(v=new l(o,E*d,r.count*d/u),C=new Zi(v,d/u),i.cache.add(m,C)),A=new pa(C,a,h%d/u,p)}else o===null?v=new l(r.count*a):v=new l(o,h,r.count*a),A=new Dt(v,a,p);if(r.sparse!==void 0){const E=pn.SCALAR,m=Jt[r.sparse.indices.componentType],C=r.sparse.indices.byteOffset||0,g=r.sparse.values.byteOffset||0,T=new m(s[1],C,r.sparse.count*E),G=new l(s[2],g,r.sparse.count*a);o!==null&&(A=new Dt(A.array.slice(),A.itemSize,A.normalized));for(let M=0,b=T.length;M<b;M++){const U=T[M];if(A.setX(U,G[M*a]),a>=2&&A.setY(U,G[M*a+1]),a>=3&&A.setZ(U,G[M*a+2]),a>=4&&A.setW(U,G[M*a+3]),a>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return A})}loadTexture(t){const i=this.json,c=this.options,e=i.textures[t].source,s=i.images[e];let o=this.textureLoader;if(s.uri){const a=c.manager.getHandler(s.uri);a!==null&&(o=a)}return this.loadTextureImage(t,e,o)}loadTextureImage(t,i,c){const r=this,e=this.json,s=e.textures[t],o=e.images[i],a=(o.uri||o.bufferView)+":"+s.sampler;if(this.textureCache[a])return this.textureCache[a];const l=this.loadImageSource(i,c).then(function(u){u.flipY=!1,u.name=s.name||o.name||"",u.name===""&&typeof o.uri=="string"&&o.uri.startsWith("data:image/")===!1&&(u.name=o.uri);const h=(e.samplers||{})[s.sampler]||{};return u.magFilter=Es[h.magFilter]||ot,u.minFilter=Es[h.minFilter]||$s,u.wrapS=ys[h.wrapS]||Hr,u.wrapT=ys[h.wrapT]||Hr,r.associations.set(u,{textures:t}),u}).catch(function(){return null});return this.textureCache[a]=l,l}loadImageSource(t,i){const c=this,r=this.json,e=this.options;if(this.sourceCache[t]!==void 0)return this.sourceCache[t].then(f=>f.clone());const s=r.images[t],o=self.URL||self.webkitURL;let a=s.uri||"",l=!1;if(s.bufferView!==void 0)a=c.getDependency("bufferView",s.bufferView).then(function(f){l=!0;const h=new Blob([f],{type:s.mimeType});return a=o.createObjectURL(h),a});else if(s.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+t+" is missing URI and bufferView");const u=Promise.resolve(a).then(function(f){return new Promise(function(h,d){let p=h;i.isImageBitmapLoader===!0&&(p=function(v){const A=new It(v);A.needsUpdate=!0,h(A)}),i.load(lr.resolveURL(f,e.path),p,void 0,d)})}).then(function(f){return l===!0&&o.revokeObjectURL(a),ft(f,s),f.userData.mimeType=s.mimeType||po(s.uri),f}).catch(function(f){throw console.error("THREE.GLTFLoader: Couldn't load texture",a),f});return this.sourceCache[t]=u,u}assignTexture(t,i,c,r){const e=this;return this.getDependency("texture",c.index).then(function(s){if(!s)return null;if(c.texCoord!==void 0&&c.texCoord>0&&(s=s.clone(),s.channel=c.texCoord),e.extensions[Ce.KHR_TEXTURE_TRANSFORM]){const o=c.extensions!==void 0?c.extensions[Ce.KHR_TEXTURE_TRANSFORM]:void 0;if(o){const a=e.associations.get(s);s=e.extensions[Ce.KHR_TEXTURE_TRANSFORM].extendTexture(s,o),e.associations.set(s,a)}}return r!==void 0&&(typeof r=="number"&&(r=r===Bs?Rt:ht),"colorSpace"in s?s.colorSpace=r:s.encoding=r===Rt?Bs:La),t[i]=s,s})}assignFinalMaterial(t){const i=t.geometry;let c=t.material;const r=i.attributes.tangent===void 0,e=i.attributes.color!==void 0,s=i.attributes.normal===void 0;if(t.isPoints){const o="PointsMaterial:"+c.uuid;let a=this.cache.get(o);a||(a=new na,cr.prototype.copy.call(a,c),a.color.copy(c.color),a.map=c.map,a.sizeAttenuation=!1,this.cache.add(o,a)),c=a}else if(t.isLine){const o="LineBasicMaterial:"+c.uuid;let a=this.cache.get(o);a||(a=new sa,cr.prototype.copy.call(a,c),a.color.copy(c.color),a.map=c.map,this.cache.add(o,a)),c=a}if(r||e||s){let o="ClonedMaterial:"+c.uuid+":";r&&(o+="derivative-tangents:"),e&&(o+="vertex-colors:"),s&&(o+="flat-shading:");let a=this.cache.get(o);a||(a=c.clone(),e&&(a.vertexColors=!0),s&&(a.flatShading=!0),r&&(a.normalScale&&(a.normalScale.y*=-1),a.clearcoatNormalScale&&(a.clearcoatNormalScale.y*=-1)),this.cache.add(o,a),this.associations.set(a,this.associations.get(c))),c=a}t.material=c}getMaterialType(){return ei}loadMaterial(t){const i=this,c=this.json,r=this.extensions,e=c.materials[t];let s;const o={},a=e.extensions||{},l=[];if(a[Ce.KHR_MATERIALS_UNLIT]){const f=r[Ce.KHR_MATERIALS_UNLIT];s=f.getMaterialType(),l.push(f.extendParams(o,e,i))}else{const f=e.pbrMetallicRoughness||{};if(o.color=new Ye(1,1,1),o.opacity=1,Array.isArray(f.baseColorFactor)){const h=f.baseColorFactor;o.color.setRGB(h[0],h[1],h[2],ht),o.opacity=h[3]}f.baseColorTexture!==void 0&&l.push(i.assignTexture(o,"map",f.baseColorTexture,Rt)),o.metalness=f.metallicFactor!==void 0?f.metallicFactor:1,o.roughness=f.roughnessFactor!==void 0?f.roughnessFactor:1,f.metallicRoughnessTexture!==void 0&&(l.push(i.assignTexture(o,"metalnessMap",f.metallicRoughnessTexture)),l.push(i.assignTexture(o,"roughnessMap",f.metallicRoughnessTexture))),s=this._invokeOne(function(h){return h.getMaterialType&&h.getMaterialType(t)}),l.push(Promise.all(this._invokeAll(function(h){return h.extendMaterialParams&&h.extendMaterialParams(t,o)})))}e.doubleSided===!0&&(o.side=Ft);const u=e.alphaMode||An.OPAQUE;if(u===An.BLEND?(o.transparent=!0,o.depthWrite=!1):(o.transparent=!1,u===An.MASK&&(o.alphaTest=e.alphaCutoff!==void 0?e.alphaCutoff:.5)),e.normalTexture!==void 0&&s!==Nt&&(l.push(i.assignTexture(o,"normalMap",e.normalTexture)),o.normalScale=new we(1,1),e.normalTexture.scale!==void 0)){const f=e.normalTexture.scale;o.normalScale.set(f,f)}if(e.occlusionTexture!==void 0&&s!==Nt&&(l.push(i.assignTexture(o,"aoMap",e.occlusionTexture)),e.occlusionTexture.strength!==void 0&&(o.aoMapIntensity=e.occlusionTexture.strength)),e.emissiveFactor!==void 0&&s!==Nt){const f=e.emissiveFactor;o.emissive=new Ye().setRGB(f[0],f[1],f[2],ht)}return e.emissiveTexture!==void 0&&s!==Nt&&l.push(i.assignTexture(o,"emissiveMap",e.emissiveTexture,Rt)),Promise.all(l).then(function(){const f=new s(o);return e.name&&(f.name=e.name),ft(f,e),i.associations.set(f,{materials:t}),e.extensions&&xt(r,f,e),f})}createUniqueName(t){const i=ia.sanitizeNodeName(t||"");return i in this.nodeNamesUsed?i+"_"+ ++this.nodeNamesUsed[i]:(this.nodeNamesUsed[i]=0,i)}loadGeometries(t){const i=this,c=this.extensions,r=this.primitiveCache;function e(o){return c[Ce.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(o,i).then(function(a){return bs(a,o,i)})}const s=[];for(let o=0,a=t.length;o<a;o++){const l=t[o],u=ho(l),f=r[u];if(f)s.push(f.promise);else{let h;l.extensions&&l.extensions[Ce.KHR_DRACO_MESH_COMPRESSION]?h=e(l):h=bs(new On,l,i),r[u]={primitive:l,promise:h},s.push(h)}}return Promise.all(s)}loadMesh(t){const i=this,c=this.json,r=this.extensions,e=c.meshes[t],s=e.primitives,o=[];for(let a=0,l=s.length;a<l;a++){const u=s[a].material===void 0?co(this.cache):this.getDependency("material",s[a].material);o.push(u)}return o.push(i.loadGeometries(s)),Promise.all(o).then(function(a){const l=a.slice(0,a.length-1),u=a[a.length-1],f=[];for(let d=0,p=u.length;d<p;d++){const v=u[d],A=s[d];let E;const m=l[d];if(A.mode===qe.TRIANGLES||A.mode===qe.TRIANGLE_STRIP||A.mode===qe.TRIANGLE_FAN||A.mode===void 0)E=e.isSkinnedMesh===!0?new aa(v,m):new Ar(v,m),E.isSkinnedMesh===!0&&E.normalizeSkinWeights(),A.mode===qe.TRIANGLE_STRIP?E.geometry=gs(E.geometry,Xs):A.mode===qe.TRIANGLE_FAN&&(E.geometry=gs(E.geometry,xn));else if(A.mode===qe.LINES)E=new oa(v,m);else if(A.mode===qe.LINE_STRIP)E=new la(v,m);else if(A.mode===qe.LINE_LOOP)E=new ca(v,m);else if(A.mode===qe.POINTS)E=new ua(v,m);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+A.mode);Object.keys(E.geometry.morphAttributes).length>0&&fo(E,e),E.name=i.createUniqueName(e.name||"mesh_"+t),ft(E,e),A.extensions&&xt(r,E,A),i.assignFinalMaterial(E),f.push(E)}for(let d=0,p=f.length;d<p;d++)i.associations.set(f[d],{meshes:t,primitives:d});if(f.length===1)return e.extensions&&xt(r,f[0],e),f[0];const h=new dn;e.extensions&&xt(r,h,e),i.associations.set(h,{meshes:t});for(let d=0,p=f.length;d<p;d++)h.add(f[d]);return h})}loadCamera(t){let i;const c=this.json.cameras[t],r=c[c.type];if(!r){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return c.type==="perspective"?i=new ti(wr.radToDeg(r.yfov),r.aspectRatio||1,r.znear||1,r.zfar||2e6):c.type==="orthographic"&&(i=new ri(-r.xmag,r.xmag,r.ymag,-r.ymag,r.znear,r.zfar)),c.name&&(i.name=this.createUniqueName(c.name)),ft(i,c),Promise.resolve(i)}loadSkin(t){const i=this.json.skins[t],c=[];for(let r=0,e=i.joints.length;r<e;r++)c.push(this._loadNodeShallow(i.joints[r]));return i.inverseBindMatrices!==void 0?c.push(this.getDependency("accessor",i.inverseBindMatrices)):c.push(null),Promise.all(c).then(function(r){const e=r.pop(),s=r,o=[],a=[];for(let l=0,u=s.length;l<u;l++){const f=s[l];if(f){o.push(f);const h=new Et;e!==null&&h.fromArray(e.array,l*16),a.push(h)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',i.joints[l])}return new fa(o,a)})}loadAnimation(t){const i=this.json,c=this,r=i.animations[t],e=r.name?r.name:"animation_"+t,s=[],o=[],a=[],l=[],u=[];for(let f=0,h=r.channels.length;f<h;f++){const d=r.channels[f],p=r.samplers[d.sampler],v=d.target,A=v.node,E=r.parameters!==void 0?r.parameters[p.input]:p.input,m=r.parameters!==void 0?r.parameters[p.output]:p.output;v.node!==void 0&&(s.push(this.getDependency("node",A)),o.push(this.getDependency("accessor",E)),a.push(this.getDependency("accessor",m)),l.push(p),u.push(v))}return Promise.all([Promise.all(s),Promise.all(o),Promise.all(a),Promise.all(l),Promise.all(u)]).then(function(f){const h=f[0],d=f[1],p=f[2],v=f[3],A=f[4],E=[];for(let m=0,C=h.length;m<C;m++){const g=h[m],T=d[m],G=p[m],M=v[m],b=A[m];if(g===void 0)continue;g.updateMatrix&&g.updateMatrix();const U=c._createAnimationTracks(g,T,G,M,b);if(U)for(let S=0;S<U.length;S++)E.push(U[S])}return new Ys(e,void 0,E)})}createNodeMesh(t){const i=this.json,c=this,r=i.nodes[t];return r.mesh===void 0?null:c.getDependency("mesh",r.mesh).then(function(e){const s=c._getNodeRef(c.meshCache,r.mesh,e);return r.weights!==void 0&&s.traverse(function(o){if(o.isMesh)for(let a=0,l=r.weights.length;a<l;a++)o.morphTargetInfluences[a]=r.weights[a]}),s})}loadNode(t){const i=this.json,c=this,r=i.nodes[t],e=c._loadNodeShallow(t),s=[],o=r.children||[];for(let l=0,u=o.length;l<u;l++)s.push(c.getDependency("node",o[l]));const a=r.skin===void 0?Promise.resolve(null):c.getDependency("skin",r.skin);return Promise.all([e,Promise.all(s),a]).then(function(l){const u=l[0],f=l[1],h=l[2];h!==null&&u.traverse(function(d){d.isSkinnedMesh&&d.bind(h,Ao)});for(let d=0,p=f.length;d<p;d++)u.add(f[d]);return u})}_loadNodeShallow(t){const i=this.json,c=this.extensions,r=this;if(this.nodeCache[t]!==void 0)return this.nodeCache[t];const e=i.nodes[t],s=e.name?r.createUniqueName(e.name):"",o=[],a=r._invokeOne(function(l){return l.createNodeMesh&&l.createNodeMesh(t)});return a&&o.push(a),e.camera!==void 0&&o.push(r.getDependency("camera",e.camera).then(function(l){return r._getNodeRef(r.cameraCache,e.camera,l)})),r._invokeAll(function(l){return l.createNodeAttachment&&l.createNodeAttachment(t)}).forEach(function(l){o.push(l)}),this.nodeCache[t]=Promise.all(o).then(function(l){let u;if(e.isBone===!0?u=new ha:l.length>1?u=new dn:l.length===1?u=l[0]:u=new Kt,u!==l[0])for(let f=0,h=l.length;f<h;f++)u.add(l[f]);if(e.name&&(u.userData.name=e.name,u.name=s),ft(u,e),e.extensions&&xt(c,u,e),e.matrix!==void 0){const f=new Et;f.fromArray(e.matrix),u.applyMatrix4(f)}else e.translation!==void 0&&u.position.fromArray(e.translation),e.rotation!==void 0&&u.quaternion.fromArray(e.rotation),e.scale!==void 0&&u.scale.fromArray(e.scale);return r.associations.has(u)||r.associations.set(u,{}),r.associations.get(u).nodes=t,u}),this.nodeCache[t]}loadScene(t){const i=this.extensions,c=this.json.scenes[t],r=this,e=new dn;c.name&&(e.name=r.createUniqueName(c.name)),ft(e,c),c.extensions&&xt(i,e,c);const s=c.nodes||[],o=[];for(let a=0,l=s.length;a<l;a++)o.push(r.getDependency("node",s[a]));return Promise.all(o).then(function(a){for(let u=0,f=a.length;u<f;u++)e.add(a[u]);const l=u=>{const f=new Map;for(const[h,d]of r.associations)(h instanceof cr||h instanceof It)&&f.set(h,d);return u.traverse(h=>{const d=r.associations.get(h);d!=null&&f.set(h,d)}),f};return r.associations=l(e),e})}_createAnimationTracks(t,i,c,r,e){const s=[],o=t.name?t.name:t.uuid,a=[];Bt[e.path]===Bt.weights?t.traverse(function(h){h.morphTargetInfluences&&a.push(h.name?h.name:h.uuid)}):a.push(o);let l;switch(Bt[e.path]){case Bt.weights:l=As;break;case Bt.rotation:l=Fn;break;case Bt.position:case Bt.scale:l=Sn;break;default:switch(c.itemSize){case 1:l=As;break;case 2:case 3:default:l=Sn;break}break}const u=r.interpolation!==void 0?lo[r.interpolation]:ni,f=this._getArrayFromAccessor(c);for(let h=0,d=a.length;h<d;h++){const p=new l(a[h]+"."+Bt[e.path],i.array,f,u);r.interpolation==="CUBICSPLINE"&&this._createCubicSplineTrackInterpolant(p),s.push(p)}return s}_getArrayFromAccessor(t){let i=t.array;if(t.normalized){const c=Dn(i.constructor),r=new Float32Array(i.length);for(let e=0,s=i.length;e<s;e++)r[e]=i[e]*c;i=r}return i}_createCubicSplineTrackInterpolant(t){t.createInterpolant=function(c){const r=this instanceof Fn?oo:vi;return new r(this.times,this.values,this.getValueSize()/3,c)},t.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}}function mo(n,t,i){const c=t.attributes,r=new kn;if(c.POSITION!==void 0){const o=i.json.accessors[c.POSITION],a=o.min,l=o.max;if(a!==void 0&&l!==void 0){if(r.set(new Ne(a[0],a[1],a[2]),new Ne(l[0],l[1],l[2])),o.normalized){const u=Dn(Jt[o.componentType]);r.min.multiplyScalar(u),r.max.multiplyScalar(u)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const e=t.targets;if(e!==void 0){const o=new Ne,a=new Ne;for(let l=0,u=e.length;l<u;l++){const f=e[l];if(f.POSITION!==void 0){const h=i.json.accessors[f.POSITION],d=h.min,p=h.max;if(d!==void 0&&p!==void 0){if(a.setX(Math.max(Math.abs(d[0]),Math.abs(p[0]))),a.setY(Math.max(Math.abs(d[1]),Math.abs(p[1]))),a.setZ(Math.max(Math.abs(d[2]),Math.abs(p[2]))),h.normalized){const v=Dn(Jt[h.componentType]);a.multiplyScalar(v)}o.max(a)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}r.expandByVector(o)}n.boundingBox=r;const s=new ii;r.getCenter(s.center),s.radius=r.min.distanceTo(r.max)/2,n.boundingSphere=s}function bs(n,t,i){const c=t.attributes,r=[];function e(s,o){return i.getDependency("accessor",s).then(function(a){n.setAttribute(o,a)})}for(const s in c){const o=Rn[s]||s.toLowerCase();o in n.attributes||r.push(e(c[s],o))}if(t.indices!==void 0&&!n.index){const s=i.getDependency("accessor",t.indices).then(function(o){n.setIndex(o)});r.push(s)}return ft(n,t),mo(n,t,i),Promise.all(r).then(function(){return t.targets!==void 0?uo(n,t.targets,i):n})}const mn=new WeakMap;class go extends Zs{constructor(t){super(t),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(t){return this.decoderPath=t,this}setDecoderConfig(t){return this.decoderConfig=t,this}setWorkerLimit(t){return this.workerLimit=t,this}load(t,i,c,r){const e=new Pr(this.manager);e.setPath(this.path),e.setResponseType("arraybuffer"),e.setRequestHeader(this.requestHeader),e.setWithCredentials(this.withCredentials),e.load(t,s=>{const o={attributeIDs:this.defaultAttributeIDs,attributeTypes:this.defaultAttributeTypes,useUniqueIDs:!1};this.decodeGeometry(s,o).then(i).catch(r)},c,r)}decodeDracoFile(t,i,c,r){const e={attributeIDs:c||this.defaultAttributeIDs,attributeTypes:r||this.defaultAttributeTypes,useUniqueIDs:!!c};this.decodeGeometry(t,e).then(i)}decodeGeometry(t,i){for(const a in i.attributeTypes){const l=i.attributeTypes[a];l.BYTES_PER_ELEMENT!==void 0&&(i.attributeTypes[a]=l.name)}const c=JSON.stringify(i);if(mn.has(t)){const a=mn.get(t);if(a.key===c)return a.promise;if(t.byteLength===0)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let r;const e=this.workerNextTaskID++,s=t.byteLength,o=this._getWorker(e,s).then(a=>(r=a,new Promise((l,u)=>{r._callbacks[e]={resolve:l,reject:u},r.postMessage({type:"decode",id:e,taskConfig:i,buffer:t},[t])}))).then(a=>this._createGeometry(a.geometry));return o.catch(()=>!0).then(()=>{r&&e&&this._releaseTask(r,e)}),mn.set(t,{key:c,promise:o}),o}_createGeometry(t){const i=new On;t.index&&i.setIndex(new Dt(t.index.array,1));for(let c=0;c<t.attributes.length;c++){const r=t.attributes[c],e=r.name,s=r.array,o=r.itemSize;i.setAttribute(e,new Dt(s,o))}return i}_loadLibrary(t,i){const c=new Pr(this.manager);return c.setPath(this.decoderPath),c.setResponseType(i),c.setWithCredentials(this.withCredentials),new Promise((r,e)=>{c.load(t,r,void 0,e)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const t=typeof WebAssembly!="object"||this.decoderConfig.type==="js",i=[];return t?i.push(this._loadLibrary("draco_decoder.js","text")):(i.push(this._loadLibrary("draco_wasm_wrapper.js","text")),i.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(i).then(c=>{const r=c[0];t||(this.decoderConfig.wasmBinary=c[1]);const e=Bo.toString(),s=["/* draco decoder */",r,"","/* worker */",e.substring(e.indexOf("{")+1,e.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([s]))}),this.decoderPending}_getWorker(t,i){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){const r=new Worker(this.workerSourceURL);r._callbacks={},r._taskCosts={},r._taskLoad=0,r.postMessage({type:"init",decoderConfig:this.decoderConfig}),r.onmessage=function(e){const s=e.data;switch(s.type){case"decode":r._callbacks[s.id].resolve(s);break;case"error":r._callbacks[s.id].reject(s);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+s.type+'"')}},this.workerPool.push(r)}else this.workerPool.sort(function(r,e){return r._taskLoad>e._taskLoad?-1:1});const c=this.workerPool[this.workerPool.length-1];return c._taskCosts[t]=i,c._taskLoad+=i,c})}_releaseTask(t,i){t._taskLoad-=t._taskCosts[i],delete t._callbacks[i],delete t._taskCosts[i]}debug(){console.log("Task load: ",this.workerPool.map(t=>t._taskLoad))}dispose(){for(let t=0;t<this.workerPool.length;++t)this.workerPool[t].terminate();return this.workerPool.length=0,this}}function Bo(){let n,t;onmessage=function(s){const o=s.data;switch(o.type){case"init":n=o.decoderConfig,t=new Promise(function(u){n.onModuleLoaded=function(f){u({draco:f})},DracoDecoderModule(n)});break;case"decode":const a=o.buffer,l=o.taskConfig;t.then(u=>{const f=u.draco,h=new f.Decoder,d=new f.DecoderBuffer;d.Init(new Int8Array(a),a.byteLength);try{const p=i(f,h,d,l),v=p.attributes.map(A=>A.array.buffer);p.index&&v.push(p.index.array.buffer),self.postMessage({type:"decode",id:o.id,geometry:p},v)}catch(p){console.error(p),self.postMessage({type:"error",id:o.id,error:p.message})}finally{f.destroy(d),f.destroy(h)}});break}};function i(s,o,a,l){const u=l.attributeIDs,f=l.attributeTypes;let h,d;const p=o.GetEncodedGeometryType(a);if(p===s.TRIANGULAR_MESH)h=new s.Mesh,d=o.DecodeBufferToMesh(a,h);else if(p===s.POINT_CLOUD)h=new s.PointCloud,d=o.DecodeBufferToPointCloud(a,h);else throw new Error("THREE.DRACOLoader: Unexpected geometry type.");if(!d.ok()||h.ptr===0)throw new Error("THREE.DRACOLoader: Decoding failed: "+d.error_msg());const v={index:null,attributes:[]};for(const A in u){const E=self[f[A]];let m,C;if(l.useUniqueIDs)C=u[A],m=o.GetAttributeByUniqueId(h,C);else{if(C=o.GetAttributeId(h,s[u[A]]),C===-1)continue;m=o.GetAttribute(h,C)}v.attributes.push(r(s,o,h,A,E,m))}return p===s.TRIANGULAR_MESH&&(v.index=c(s,o,h)),s.destroy(h),v}function c(s,o,a){const u=a.num_faces()*3,f=u*4,h=s._malloc(f);o.GetTrianglesUInt32Array(a,f,h);const d=new Uint32Array(s.HEAPF32.buffer,h,u).slice();return s._free(h),{array:d,itemSize:1}}function r(s,o,a,l,u,f){const h=f.num_components(),p=a.num_points()*h,v=p*u.BYTES_PER_ELEMENT,A=e(s,u),E=s._malloc(v);o.GetAttributeDataArrayForAllPoints(a,f,A,v,E);const m=new u(s.HEAPF32.buffer,E,p).slice();return s._free(E),{name:l,array:m,itemSize:h}}function e(s,o){switch(o){case Float32Array:return s.DT_FLOAT32;case Int8Array:return s.DT_INT8;case Int16Array:return s.DT_INT16;case Int32Array:return s.DT_INT32;case Uint8Array:return s.DT_UINT8;case Uint16Array:return s.DT_UINT16;case Uint32Array:return s.DT_UINT32}}}let Dr;const gn=()=>{if(Dr)return Dr;const n="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",t="B9h9z9tFBBBFiI9gBB9gLaaaaaFa9gEaaaB9gFaFaEMcBBFBFFGGGEILF9wFFFLEFBFKNFaFCx/aFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBG8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBIy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBKi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBOn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBNI9z9iqlBVc+N9IcIBTEM9+FLa8jUUUUBCTlRBCBRFEXCBRGCBREEXABCNJAGJAECUaAFAGrCFZHIy86BBAEAIJREAGCFJHGCN9HQBMAFCx+YUUBJAE86BBAFCEWCxkUUBJAB8pEN83EBAFCFJHFCUG9HQBMMk8lLbaE97F9+FaL978jUUUUBCU/KBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAG/8cBBCUoBAG9uC/wgBZHKCUGAKCUG9JyRNAECFJRKCBRVGXEXAVAF9PQFANAFAVlAVANJAF9JyRcGXGXAG9FQBAcCbJHIC9wZHMCE9sRSAMCFWRQAICIrCEJCGrRfCBRbEXAKRTCBRtGXEXGXAOATlAf9PQBCBRKSLMALCU/CBJAtAM9sJRmATAfJRKCBREGXAMCoB9JQBAOAKlC/gB9JQBCBRIEXAmAIJREGXGXGXGXGXATAICKrJ2BBHYCEZfIBFGEBMAECBDtDMIBSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAeDeBJAiCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAeDeBJAiCx+YUUBJ2BBJRKSFMAEAKDBBBDMIBAKCTJRKMGXGXGXGXGXAYCGrCEZfIBFGEBMAECBDtDMITSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCIJAeDeBJAiCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCNJAeDeBJAiCx+YUUBJ2BBJRKSFMAEAKDBBBDMITAKCTJRKMGXGXGXGXGXAYCIrCEZfIBFGEBMAECBDtDMIASEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCIJAeDeBJAiCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCNJAeDeBJAiCx+YUUBJ2BBJRKSFMAEAKDBBBDMIAAKCTJRKMGXGXGXGXGXAYCKrfIBFGEBMAECBDtDMI8wSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCIJAeDeBJAYCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCNJAeDeBJAYCx+YUUBJ2BBJRKSFMAEAKDBBBDMI8wAKCTJRKMAICoBJREAICUFJAM9LQFAERIAOAKlC/fB9LQBMMGXAEAM9PQBAECErRIEXGXAOAKlCi9PQBCBRKSOMAmAEJRYGXGXGXGXGXATAECKrJ2BBAICKZrCEZfIBFGEBMAYCBDtDMIBSEMAYAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAeDeBJAiCx+YUUBJ2BBJRKSGMAYAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAeDeBJAiCx+YUUBJ2BBJRKSFMAYAKDBBBDMIBAKCTJRKMAICGJRIAECTJHEAM9JQBMMGXAK9FQBAKRTAtCFJHtCI6QGSFMMCBRKSEMGXAM9FQBALCUGJAbJREALAbJDBGBReCBRYEXAEALCU/CBJAYJHIDBIBHdCFD9tAdCFDbHPD9OD9hD9RHdAIAMJDBIBH8ZCFD9tA8ZAPD9OD9hD9RH8ZDQBTFtGmEYIPLdKeOnHpAIAQJDBIBHyCFD9tAyAPD9OD9hD9RHyAIASJDBIBH8cCFD9tA8cAPD9OD9hD9RH8cDQBTFtGmEYIPLdKeOnH8dDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGEAeD9uHeDyBjGBAEAGJHIAeAPAPDQILKOILKOILKOILKOD9uHeDyBjGBAIAGJHIAeAPAPDQNVcMNVcMNVcMNVcMD9uHeDyBjGBAIAGJHIAeAPAPDQSQfbSQfbSQfbSQfbD9uHeDyBjGBAIAGJHIAeApA8dDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHeDyBjGBAIAGJHIAeAPAPDQILKOILKOILKOILKOD9uHeDyBjGBAIAGJHIAeAPAPDQNVcMNVcMNVcMNVcMD9uHeDyBjGBAIAGJHIAeAPAPDQSQfbSQfbSQfbSQfbD9uHeDyBjGBAIAGJHIAeAdA8ZDQNiV8ZcpMyS8cQ8df8eb8fHdAyA8cDQNiV8ZcpMyS8cQ8df8eb8fH8ZDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGED9uHeDyBjGBAIAGJHIAeAPAPDQILKOILKOILKOILKOD9uHeDyBjGBAIAGJHIAeAPAPDQNVcMNVcMNVcMNVcMD9uHeDyBjGBAIAGJHIAeAPAPDQSQfbSQfbSQfbSQfbD9uHeDyBjGBAIAGJHIAeAdA8ZDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHeDyBjGBAIAGJHIAeAPAPDQILKOILKOILKOILKOD9uHeDyBjGBAIAGJHIAeAPAPDQNVcMNVcMNVcMNVcMD9uHeDyBjGBAIAGJHIAeAPAPDQSQfbSQfbSQfbSQfbD9uHeDyBjGBAIAGJREAYCTJHYAM9JQBMMAbCIJHbAG9JQBMMABAVAG9sJALCUGJAcAG9s/8cBBALALCUGJAcCaJAG9sJAG/8cBBMAcCBAKyAVJRVAKQBMC9+RKSFMCBC99AOAKlAGCAAGCA9Ly6yRKMALCU/KBJ8kUUUUBAKMNBT+BUUUBM+KmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUF/8MBALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM/dLEK97FaF97GXGXAGCI9HQBAF9FQFCBRGEXABABDBBBHECiD+rFCiD+sFD/6FHIAECND+rFCiD+sFD/6FAID/gFAECTD+rFCiD+sFD/6FHLD/gFD/kFD/lFHKCBDtD+2FHOAICUUUU94DtHND9OD9RD/kFHI9DBB/+hDYAIAID/mFAKAKD/mFALAOALAND9OD9RD/kFHIAID/mFD/kFD/kFD/jFD/nFHLD/mF9DBBX9LDYHOD/kFCgFDtD9OAECUUU94DtD9OD9QAIALD/mFAOD/kFCND+rFCU/+EDtD9OD9QAKALD/mFAOD/kFCTD+rFCUU/8ODtD9OD9QDMBBABCTJRBAGCIJHGAF9JQBSGMMAF9FQBCBRGEXABCTJHVAVDBBBHECBDtHOCUU98D8cFCUU98D8cEHND9OABDBBBHKAEDQILKOSQfbPden8c8d8e8fCggFDtD9OD/6FAKAEDQBFGENVcMTtmYi8ZpyHECTD+sFD/6FHID/gFAECTD+rFCTD+sFD/6FHLD/gFD/kFD/lFHE9DB/+g6DYALAEAOD+2FHOALCUUUU94DtHcD9OD9RD/kFHLALD/mFAEAED/mFAIAOAIAcD9OD9RD/kFHEAED/mFD/kFD/kFD/jFD/nFHID/mF9DBBX9LDYHOD/kFCTD+rFALAID/mFAOD/kFCggEDtD9OD9QHLAEAID/mFAOD/kFCaDbCBDnGCBDnECBDnKCBDnOCBDncCBDnMCBDnfCBDnbD9OHEDQNVi8ZcMpySQ8c8dfb8e8fD9QDMBBABAKAND9OALAEDQBFTtGEmYILPdKOenD9QDMBBABCAJRBAGCIJHGAF9JQBMMM/hEIGaF97FaL978jUUUUBCTlREGXAF9FQBCBRIEXAEABDBBBHLABCTJHKDBBBHODQILKOSQfbPden8c8d8e8fHNCTD+sFHVCID+rFDMIBAB9DBBU8/DY9D/zI818/DYAVCEDtD9QD/6FD/nFHVALAODQBFGENVcMTtmYi8ZpyHLCTD+rFCTD+sFD/6FD/mFHOAOD/mFAVALCTD+sFD/6FD/mFHcAcD/mFAVANCTD+rFCTD+sFD/6FD/mFHNAND/mFD/kFD/kFD/lFCBDtD+4FD/jF9DB/+g6DYHVD/mF9DBBX9LDYHLD/kFCggEDtHMD9OAcAVD/mFALD/kFCTD+rFD9QHcANAVD/mFALD/kFCTD+rFAOAVD/mFALD/kFAMD9OD9QHVDQBFTtGEmYILPdKOenHLD8dBAEDBIBDyB+t+J83EBABCNJALD8dFAEDBIBDyF+t+J83EBAKAcAVDQNVi8ZcMpySQ8c8dfb8e8fHVD8dBAEDBIBDyG+t+J83EBABCiJAVD8dFAEDBIBDyE+t+J83EBABCAJRBAICIJHIAF9JQBMMM9jFF97GXAGCGrAF9sHG9FQBCBRFEXABABDBBBHECND+rFCND+sFD/6FAECiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMBBABCTJRBAFCIJHFAG9JQBMMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEMMMFBCUNMIT9tBB",i=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),c=new Uint8Array([32,0,65,253,3,1,2,34,4,106,6,5,11,8,7,20,13,33,12,16,128,9,116,64,19,113,127,15,10,21,22,14,255,66,24,54,136,107,18,23,192,26,114,118,132,17,77,101,130,144,27,87,131,44,45,74,156,154,70,167]);if(typeof WebAssembly!="object")return{supported:!1};let r=n;WebAssembly.validate(i)&&(r=t);let e;const s=WebAssembly.instantiate(o(r),{}).then(f=>{e=f.instance,e.exports.__wasm_call_ctors()});function o(f){const h=new Uint8Array(f.length);for(let p=0;p<f.length;++p){const v=f.charCodeAt(p);h[p]=v>96?v-71:v>64?v-65:v>47?v+4:v>46?63:62}let d=0;for(let p=0;p<f.length;++p)h[d++]=h[p]<60?c[h[p]]:(h[p]-60)*64+h[++p];return h.buffer.slice(0,d)}function a(f,h,d,p,v,A){const E=e.exports.sbrk,m=d+3&-4,C=E(m*p),g=E(v.length),T=new Uint8Array(e.exports.memory.buffer);T.set(v,g);const G=f(C,d,p,g,v.length);if(G===0&&A&&A(C,m,p),h.set(T.subarray(C,C+d*p)),E(C-E(0)),G!==0)throw new Error(`Malformed buffer data: ${G}`)}const l={0:"",1:"meshopt_decodeFilterOct",2:"meshopt_decodeFilterQuat",3:"meshopt_decodeFilterExp",NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},u={0:"meshopt_decodeVertexBuffer",1:"meshopt_decodeIndexBuffer",2:"meshopt_decodeIndexSequence",ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return Dr={ready:s,supported:!0,decodeVertexBuffer(f,h,d,p,v){a(e.exports.meshopt_decodeVertexBuffer,f,h,d,p,e.exports[l[v]])},decodeIndexBuffer(f,h,d,p){a(e.exports.meshopt_decodeIndexBuffer,f,h,d,p)},decodeIndexSequence(f,h,d,p){a(e.exports.meshopt_decodeIndexSequence,f,h,d,p)},decodeGltfBuffer(f,h,d,p,v,A){a(e.exports[u[v]],f,h,d,p,e.exports[l[A]])}},Dr};function Co(){var n=Object.create(null);function t(r,e){var s=r.id,o=r.name,a=r.dependencies;a===void 0&&(a=[]);var l=r.init;l===void 0&&(l=function(){});var u=r.getTransferables;if(u===void 0&&(u=null),!n[s])try{a=a.map(function(h){return h&&h.isWorkerModule&&(t(h,function(d){if(d instanceof Error)throw d}),h=n[h.id].value),h}),l=c("<"+o+">.init",l),u&&(u=c("<"+o+">.getTransferables",u));var f=null;typeof l=="function"?f=l.apply(void 0,a):console.error("worker module init function failed to rehydrate"),n[s]={id:s,value:f,getTransferables:u},e(f)}catch(h){h&&h.noLog||console.error(h),e(h)}}function i(r,e){var s,o=r.id,a=r.args;(!n[o]||typeof n[o].value!="function")&&e(new Error("Worker module "+o+": not found or its 'init' did not return a function"));try{var l=(s=n[o]).value.apply(s,a);l&&typeof l.then=="function"?l.then(u,function(f){return e(f instanceof Error?f:new Error(""+f))}):u(l)}catch(f){e(f)}function u(f){try{var h=n[o].getTransferables&&n[o].getTransferables(f);(!h||!Array.isArray(h)||!h.length)&&(h=void 0),e(f,h)}catch(d){console.error(d),e(d)}}}function c(r,e){var s=void 0;self.troikaDefine=function(a){return s=a};var o=URL.createObjectURL(new Blob(["/** "+r.replace(/\*/g,"")+` **/

troikaDefine(
`+e+`
)`],{type:"application/javascript"}));try{importScripts(o)}catch(a){console.error(a)}return URL.revokeObjectURL(o),delete self.troikaDefine,s}self.addEventListener("message",function(r){var e=r.data,s=e.messageId,o=e.action,a=e.data;try{o==="registerModule"&&t(a,function(l){l instanceof Error?postMessage({messageId:s,success:!1,error:l.message}):postMessage({messageId:s,success:!0,result:{isCallable:typeof l=="function"}})}),o==="callModule"&&i(a,function(l,u){l instanceof Error?postMessage({messageId:s,success:!1,error:l.message}):postMessage({messageId:s,success:!0,result:l},u||void 0)})}catch(l){postMessage({messageId:s,success:!1,error:l.stack})}})}function Eo(n){var t=function(){for(var i=[],c=arguments.length;c--;)i[c]=arguments[c];return t._getInitResult().then(function(r){if(typeof r=="function")return r.apply(void 0,i);throw new Error("Worker module function was called but `init` did not return a callable function")})};return t._getInitResult=function(){var i=n.dependencies,c=n.init;i=Array.isArray(i)?i.map(function(e){return e&&(e=e.onMainThread||e,e._getInitResult&&(e=e._getInitResult())),e}):[];var r=Promise.all(i).then(function(e){return c.apply(null,e)});return t._getInitResult=function(){return r},r},t}var mi=function(){var n=!1;if(typeof window<"u"&&typeof window.document<"u")try{var t=new Worker(URL.createObjectURL(new Blob([""],{type:"application/javascript"})));t.terminate(),n=!0}catch(i){console.log("Troika createWorkerModule: web workers not allowed; falling back to main thread execution. Cause: ["+i.message+"]")}return mi=function(){return n},n},yo=0,bo=0,Bn=!1,ur=Object.create(null),fr=Object.create(null),Gn=Object.create(null);function Wt(n){if((!n||typeof n.init!="function")&&!Bn)throw new Error("requires `options.init` function");var t=n.dependencies,i=n.init,c=n.getTransferables,r=n.workerId,e=Eo(n);r==null&&(r="#default");var s="workerModule"+ ++yo,o=n.name||s,a=null;t=t&&t.map(function(u){return typeof u=="function"&&!u.workerModuleData&&(Bn=!0,u=Wt({workerId:r,name:"<"+o+"> function dependency: "+u.name,init:`function(){return (
`+_r(u)+`
)}`}),Bn=!1),u&&u.workerModuleData&&(u=u.workerModuleData),u});function l(){for(var u=[],f=arguments.length;f--;)u[f]=arguments[f];if(!mi())return e.apply(void 0,u);if(!a){a=Ts(r,"registerModule",l.workerModuleData);var h=function(){a=null,fr[r].delete(h)};(fr[r]||(fr[r]=new Set)).add(h)}return a.then(function(d){var p=d.isCallable;if(p)return Ts(r,"callModule",{id:s,args:u});throw new Error("Worker module function was called but `init` did not return a callable function")})}return l.workerModuleData={isWorkerModule:!0,id:s,name:o,dependencies:t,init:_r(i),getTransferables:c&&_r(c)},l.onMainThread=e,l}function To(n){fr[n]&&fr[n].forEach(function(t){t()}),ur[n]&&(ur[n].terminate(),delete ur[n])}function _r(n){var t=n.toString();return!/^function/.test(t)&&/^\w+\s*\(/.test(t)&&(t="function "+t),t}function Mo(n){var t=ur[n];if(!t){var i=_r(Co);t=ur[n]=new Worker(URL.createObjectURL(new Blob(["/** Worker Module Bootstrap: "+n.replace(/\*/g,"")+` **/

;(`+i+")()"],{type:"application/javascript"}))),t.onmessage=function(c){var r=c.data,e=r.messageId,s=Gn[e];if(!s)throw new Error("WorkerModule response with empty or unknown messageId");delete Gn[e],s(r)}}return t}function Ts(n,t,i){return new Promise(function(c,r){var e=++bo;Gn[e]=function(s){s.success?c(s.result):r(new Error("Error in worker "+t+" call: "+s.error))},Mo(n).postMessage({messageId:e,action:t,data:i})})}function gi(){var n=(function(t){function i(P,_,B,x,D,I,R,N){var L=1-R;N.x=L*L*P+2*L*R*B+R*R*D,N.y=L*L*_+2*L*R*x+R*R*I}function c(P,_,B,x,D,I,R,N,L,O){var Y=1-L;O.x=Y*Y*Y*P+3*Y*Y*L*B+3*Y*L*L*D+L*L*L*R,O.y=Y*Y*Y*_+3*Y*Y*L*x+3*Y*L*L*I+L*L*L*N}function r(P,_){for(var B=/([MLQCZ])([^MLQCZ]*)/g,x,D,I,R,N;x=B.exec(P);){var L=x[2].replace(/^\s*|\s*$/g,"").split(/[,\s]+/).map(function(O){return parseFloat(O)});switch(x[1]){case"M":R=D=L[0],N=I=L[1];break;case"L":(L[0]!==R||L[1]!==N)&&_("L",R,N,R=L[0],N=L[1]);break;case"Q":{_("Q",R,N,R=L[2],N=L[3],L[0],L[1]);break}case"C":{_("C",R,N,R=L[4],N=L[5],L[0],L[1],L[2],L[3]);break}case"Z":(R!==D||N!==I)&&_("L",R,N,D,I);break}}}function e(P,_,B){B===void 0&&(B=16);var x={x:0,y:0};r(P,function(D,I,R,N,L,O,Y,re,Q){switch(D){case"L":_(I,R,N,L);break;case"Q":{for(var J=I,me=R,he=1;he<B;he++)i(I,R,O,Y,N,L,he/(B-1),x),_(J,me,x.x,x.y),J=x.x,me=x.y;break}case"C":{for(var ee=I,ne=R,ce=1;ce<B;ce++)c(I,R,O,Y,re,Q,N,L,ce/(B-1),x),_(ee,ne,x.x,x.y),ee=x.x,ne=x.y;break}}})}var s="precision highp float;attribute vec2 aUV;varying vec2 vUV;void main(){vUV=aUV;gl_Position=vec4(mix(vec2(-1.0),vec2(1.0),aUV),0.0,1.0);}",o="precision highp float;uniform sampler2D tex;varying vec2 vUV;void main(){gl_FragColor=texture2D(tex,vUV);}",a=new WeakMap,l={premultipliedAlpha:!1,preserveDrawingBuffer:!0,antialias:!1,depth:!1};function u(P,_){var B=P.getContext?P.getContext("webgl",l):P,x=a.get(B);if(!x){let Y=function(ee){var ne=I[ee];if(!ne&&(ne=I[ee]=B.getExtension(ee),!ne))throw new Error(ee+" not supported");return ne},re=function(ee,ne){var ce=B.createShader(ne);return B.shaderSource(ce,ee),B.compileShader(ce),ce},Q=function(ee,ne,ce,W){if(!R[ee]){var se={},te={},H=B.createProgram();B.attachShader(H,re(ne,B.VERTEX_SHADER)),B.attachShader(H,re(ce,B.FRAGMENT_SHADER)),B.linkProgram(H),R[ee]={program:H,transaction:function($){B.useProgram(H),$({setUniform:function(Z,Me){for(var ie=[],oe=arguments.length-2;oe-- >0;)ie[oe]=arguments[oe+2];var fe=te[Me]||(te[Me]=B.getUniformLocation(H,Me));B["uniform"+Z].apply(B,[fe].concat(ie))},setAttribute:function(Z,Me,ie,oe,fe){var Ae=se[Z];Ae||(Ae=se[Z]={buf:B.createBuffer(),loc:B.getAttribLocation(H,Z),data:null}),B.bindBuffer(B.ARRAY_BUFFER,Ae.buf),B.vertexAttribPointer(Ae.loc,Me,B.FLOAT,!1,0,0),B.enableVertexAttribArray(Ae.loc),D?B.vertexAttribDivisor(Ae.loc,oe):Y("ANGLE_instanced_arrays").vertexAttribDivisorANGLE(Ae.loc,oe),fe!==Ae.data&&(B.bufferData(B.ARRAY_BUFFER,fe,ie),Ae.data=fe)}})}}}R[ee].transaction(W)},J=function(ee,ne){L++;try{B.activeTexture(B.TEXTURE0+L);var ce=N[ee];ce||(ce=N[ee]=B.createTexture(),B.bindTexture(B.TEXTURE_2D,ce),B.texParameteri(B.TEXTURE_2D,B.TEXTURE_MIN_FILTER,B.NEAREST),B.texParameteri(B.TEXTURE_2D,B.TEXTURE_MAG_FILTER,B.NEAREST)),B.bindTexture(B.TEXTURE_2D,ce),ne(ce,L)}finally{L--}},me=function(ee,ne,ce){var W=B.createFramebuffer();O.push(W),B.bindFramebuffer(B.FRAMEBUFFER,W),B.activeTexture(B.TEXTURE0+ne),B.bindTexture(B.TEXTURE_2D,ee),B.framebufferTexture2D(B.FRAMEBUFFER,B.COLOR_ATTACHMENT0,B.TEXTURE_2D,ee,0);try{ce(W)}finally{B.deleteFramebuffer(W),B.bindFramebuffer(B.FRAMEBUFFER,O[--O.length-1]||null)}},he=function(){I={},R={},N={},L=-1,O.length=0};var D=typeof WebGL2RenderingContext<"u"&&B instanceof WebGL2RenderingContext,I={},R={},N={},L=-1,O=[];B.canvas.addEventListener("webglcontextlost",function(ee){he(),ee.preventDefault()},!1),a.set(B,x={gl:B,isWebGL2:D,getExtension:Y,withProgram:Q,withTexture:J,withTextureFramebuffer:me,handleContextLoss:he})}_(x)}function f(P,_,B,x,D,I,R,N){R===void 0&&(R=15),N===void 0&&(N=null),u(P,function(L){var O=L.gl,Y=L.withProgram,re=L.withTexture;re("copy",function(Q,J){O.texImage2D(O.TEXTURE_2D,0,O.RGBA,D,I,0,O.RGBA,O.UNSIGNED_BYTE,_),Y("copy",s,o,function(me){var he=me.setUniform,ee=me.setAttribute;ee("aUV",2,O.STATIC_DRAW,0,new Float32Array([0,0,2,0,0,2])),he("1i","image",J),O.bindFramebuffer(O.FRAMEBUFFER,N||null),O.disable(O.BLEND),O.colorMask(R&8,R&4,R&2,R&1),O.viewport(B,x,D,I),O.scissor(B,x,D,I),O.drawArrays(O.TRIANGLES,0,3)})})})}function h(P,_,B){var x=P.width,D=P.height;u(P,function(I){var R=I.gl,N=new Uint8Array(x*D*4);R.readPixels(0,0,x,D,R.RGBA,R.UNSIGNED_BYTE,N),P.width=_,P.height=B,f(R,N,0,0,x,D)})}var d=Object.freeze({__proto__:null,withWebGLContext:u,renderImageData:f,resizeWebGLCanvasWithoutClearing:h});function p(P,_,B,x,D,I){I===void 0&&(I=1);var R=new Uint8Array(P*_),N=x[2]-x[0],L=x[3]-x[1],O=[];e(B,function(ee,ne,ce,W){O.push({x1:ee,y1:ne,x2:ce,y2:W,minX:Math.min(ee,ce),minY:Math.min(ne,W),maxX:Math.max(ee,ce),maxY:Math.max(ne,W)})}),O.sort(function(ee,ne){return ee.maxX-ne.maxX});for(var Y=0;Y<P;Y++)for(var re=0;re<_;re++){var Q=me(x[0]+N*(Y+.5)/P,x[1]+L*(re+.5)/_),J=Math.pow(1-Math.abs(Q)/D,I)/2;Q<0&&(J=1-J),J=Math.max(0,Math.min(255,Math.round(J*255))),R[re*P+Y]=J}return R;function me(ee,ne){for(var ce=1/0,W=1/0,se=O.length;se--;){var te=O[se];if(te.maxX+W<=ee)break;if(ee+W>te.minX&&ne-W<te.maxY&&ne+W>te.minY){var H=E(ee,ne,te.x1,te.y1,te.x2,te.y2);H<ce&&(ce=H,W=Math.sqrt(ce))}}return he(ee,ne)&&(W=-W),W}function he(ee,ne){for(var ce=0,W=O.length;W--;){var se=O[W];if(se.maxX<=ee)break;var te=se.y1>ne!=se.y2>ne&&ee<(se.x2-se.x1)*(ne-se.y1)/(se.y2-se.y1)+se.x1;te&&(ce+=se.y1<se.y2?1:-1)}return ce!==0}}function v(P,_,B,x,D,I,R,N,L,O){I===void 0&&(I=1),N===void 0&&(N=0),L===void 0&&(L=0),O===void 0&&(O=0),A(P,_,B,x,D,I,R,null,N,L,O)}function A(P,_,B,x,D,I,R,N,L,O,Y){I===void 0&&(I=1),L===void 0&&(L=0),O===void 0&&(O=0),Y===void 0&&(Y=0);for(var re=p(P,_,B,x,D,I),Q=new Uint8Array(re.length*4),J=0;J<re.length;J++)Q[J*4+Y]=re[J];f(R,Q,L,O,P,_,1<<3-Y,N)}function E(P,_,B,x,D,I){var R=D-B,N=I-x,L=R*R+N*N,O=L?Math.max(0,Math.min(1,((P-B)*R+(_-x)*N)/L)):0,Y=P-(B+O*R),re=_-(x+O*N);return Y*Y+re*re}var m=Object.freeze({__proto__:null,generate:p,generateIntoCanvas:v,generateIntoFramebuffer:A}),C="precision highp float;uniform vec4 uGlyphBounds;attribute vec2 aUV;attribute vec4 aLineSegment;varying vec4 vLineSegment;varying vec2 vGlyphXY;void main(){vLineSegment=aLineSegment;vGlyphXY=mix(uGlyphBounds.xy,uGlyphBounds.zw,aUV);gl_Position=vec4(mix(vec2(-1.0),vec2(1.0),aUV),0.0,1.0);}",g="precision highp float;uniform vec4 uGlyphBounds;uniform float uMaxDistance;uniform float uExponent;varying vec4 vLineSegment;varying vec2 vGlyphXY;float absDistToSegment(vec2 point,vec2 lineA,vec2 lineB){vec2 lineDir=lineB-lineA;float lenSq=dot(lineDir,lineDir);float t=lenSq==0.0 ? 0.0 : clamp(dot(point-lineA,lineDir)/lenSq,0.0,1.0);vec2 linePt=lineA+t*lineDir;return distance(point,linePt);}void main(){vec4 seg=vLineSegment;vec2 p=vGlyphXY;float dist=absDistToSegment(p,seg.xy,seg.zw);float val=pow(1.0-clamp(dist/uMaxDistance,0.0,1.0),uExponent)*0.5;bool crossing=(seg.y>p.y!=seg.w>p.y)&&(p.x<(seg.z-seg.x)*(p.y-seg.y)/(seg.w-seg.y)+seg.x);bool crossingUp=crossing&&vLineSegment.y<vLineSegment.w;gl_FragColor=vec4(crossingUp ? 1.0/255.0 : 0.0,crossing&&!crossingUp ? 1.0/255.0 : 0.0,0.0,val);}",T="precision highp float;uniform sampler2D tex;varying vec2 vUV;void main(){vec4 color=texture2D(tex,vUV);bool inside=color.r!=color.g;float val=inside ? 1.0-color.a : color.a;gl_FragColor=vec4(val);}",G=new Float32Array([0,0,2,0,0,2]),M=null,b=!1,U={},S=new WeakMap;function k(P){if(!b&&!j(P))throw new Error("WebGL generation not supported")}function y(P,_,B,x,D,I,R){if(I===void 0&&(I=1),R===void 0&&(R=null),!R&&(R=M,!R)){var N=typeof OffscreenCanvas=="function"?new OffscreenCanvas(1,1):typeof document<"u"?document.createElement("canvas"):null;if(!N)throw new Error("OffscreenCanvas or DOM canvas not supported");R=M=N.getContext("webgl",{depth:!1})}k(R);var L=new Uint8Array(P*_*4);u(R,function(Q){var J=Q.gl,me=Q.withTexture,he=Q.withTextureFramebuffer;me("readable",function(ee,ne){J.texImage2D(J.TEXTURE_2D,0,J.RGBA,P,_,0,J.RGBA,J.UNSIGNED_BYTE,null),he(ee,ne,function(ce){F(P,_,B,x,D,I,J,ce,0,0,0),J.readPixels(0,0,P,_,J.RGBA,J.UNSIGNED_BYTE,L)})})});for(var O=new Uint8Array(P*_),Y=0,re=0;Y<L.length;Y+=4)O[re++]=L[Y];return O}function w(P,_,B,x,D,I,R,N,L,O){I===void 0&&(I=1),N===void 0&&(N=0),L===void 0&&(L=0),O===void 0&&(O=0),F(P,_,B,x,D,I,R,null,N,L,O)}function F(P,_,B,x,D,I,R,N,L,O,Y){I===void 0&&(I=1),L===void 0&&(L=0),O===void 0&&(O=0),Y===void 0&&(Y=0),k(R);var re=[];e(B,function(Q,J,me,he){re.push(Q,J,me,he)}),re=new Float32Array(re),u(R,function(Q){var J=Q.gl,me=Q.isWebGL2,he=Q.getExtension,ee=Q.withProgram,ne=Q.withTexture,ce=Q.withTextureFramebuffer,W=Q.handleContextLoss;if(ne("rawDistances",function(se,te){(P!==se._lastWidth||_!==se._lastHeight)&&J.texImage2D(J.TEXTURE_2D,0,J.RGBA,se._lastWidth=P,se._lastHeight=_,0,J.RGBA,J.UNSIGNED_BYTE,null),ee("main",C,g,function(H){var pe=H.setAttribute,$=H.setUniform,ae=!me&&he("ANGLE_instanced_arrays"),Z=!me&&he("EXT_blend_minmax");pe("aUV",2,J.STATIC_DRAW,0,G),pe("aLineSegment",4,J.DYNAMIC_DRAW,1,re),$.apply(void 0,["4f","uGlyphBounds"].concat(x)),$("1f","uMaxDistance",D),$("1f","uExponent",I),ce(se,te,function(Me){J.enable(J.BLEND),J.colorMask(!0,!0,!0,!0),J.viewport(0,0,P,_),J.scissor(0,0,P,_),J.blendFunc(J.ONE,J.ONE),J.blendEquationSeparate(J.FUNC_ADD,me?J.MAX:Z.MAX_EXT),J.clear(J.COLOR_BUFFER_BIT),me?J.drawArraysInstanced(J.TRIANGLES,0,3,re.length/4):ae.drawArraysInstancedANGLE(J.TRIANGLES,0,3,re.length/4)})}),ee("post",s,T,function(H){H.setAttribute("aUV",2,J.STATIC_DRAW,0,G),H.setUniform("1i","tex",te),J.bindFramebuffer(J.FRAMEBUFFER,N),J.disable(J.BLEND),J.colorMask(Y===0,Y===1,Y===2,Y===3),J.viewport(L,O,P,_),J.scissor(L,O,P,_),J.drawArrays(J.TRIANGLES,0,3)})}),J.isContextLost())throw W(),new Error("webgl context lost")})}function j(P){var _=!P||P===M?U:P.canvas||P,B=S.get(_);if(B===void 0){b=!0;var x=null;try{var D=[97,106,97,61,99,137,118,80,80,118,137,99,61,97,106,97],I=y(4,4,"M8,8L16,8L24,24L16,24Z",[0,0,32,32],24,1,P);B=I&&D.length===I.length&&I.every(function(R,N){return R===D[N]}),B||(x="bad trial run results",console.info(D,I))}catch(R){B=!1,x=R.message}x&&console.warn("WebGL SDF generation not supported:",x),b=!1,S.set(_,B)}return B}var K=Object.freeze({__proto__:null,generate:y,generateIntoCanvas:w,generateIntoFramebuffer:F,isSupported:j});function q(P,_,B,x,D,I){D===void 0&&(D=Math.max(x[2]-x[0],x[3]-x[1])/2),I===void 0&&(I=1);try{return y.apply(K,arguments)}catch(R){return console.info("WebGL SDF generation failed, falling back to JS",R),p.apply(m,arguments)}}function V(P,_,B,x,D,I,R,N,L,O){D===void 0&&(D=Math.max(x[2]-x[0],x[3]-x[1])/2),I===void 0&&(I=1),N===void 0&&(N=0),L===void 0&&(L=0),O===void 0&&(O=0);try{return w.apply(K,arguments)}catch(Y){return console.info("WebGL SDF generation failed, falling back to JS",Y),v.apply(m,arguments)}}return t.forEachPathCommand=r,t.generate=q,t.generateIntoCanvas=V,t.javascript=m,t.pathToLineSegments=e,t.webgl=K,t.webglUtils=d,Object.defineProperty(t,"__esModule",{value:!0}),t})({});return n}function xo(){var n=(function(t){var i={R:"13k,1a,2,3,3,2+1j,ch+16,a+1,5+2,2+n,5,a,4,6+16,4+3,h+1b,4mo,179q,2+9,2+11,2i9+7y,2+68,4,3+4,5+13,4+3,2+4k,3+29,8+cf,1t+7z,w+17,3+3m,1t+3z,16o1+5r,8+30,8+mc,29+1r,29+4v,75+73",EN:"1c+9,3d+1,6,187+9,513,4+5,7+9,sf+j,175h+9,qw+q,161f+1d,4xt+a,25i+9",ES:"17,2,6dp+1,f+1,av,16vr,mx+1,4o,2",ET:"z+2,3h+3,b+1,ym,3e+1,2o,p4+1,8,6u,7c,g6,1wc,1n9+4,30+1b,2n,6d,qhx+1,h0m,a+1,49+2,63+1,4+1,6bb+3,12jj",AN:"16o+5,2j+9,2+1,35,ed,1ff2+9,87+u",CS:"18,2+1,b,2u,12k,55v,l,17v0,2,3,53,2+1,b",B:"a,3,f+2,2v,690",S:"9,2,k",WS:"c,k,4f4,1vk+a,u,1j,335",ON:"x+1,4+4,h+5,r+5,r+3,z,5+3,2+1,2+1,5,2+2,3+4,o,w,ci+1,8+d,3+d,6+8,2+g,39+1,9,6+1,2,33,b8,3+1,3c+1,7+1,5r,b,7h+3,sa+5,2,3i+6,jg+3,ur+9,2v,ij+1,9g+9,7+a,8m,4+1,49+x,14u,2+2,c+2,e+2,e+2,e+1,i+n,e+e,2+p,u+2,e+2,36+1,2+3,2+1,b,2+2,6+5,2,2,2,h+1,5+4,6+3,3+f,16+2,5+3l,3+81,1y+p,2+40,q+a,m+13,2r+ch,2+9e,75+hf,3+v,2+2w,6e+5,f+6,75+2a,1a+p,2+2g,d+5x,r+b,6+3,4+o,g,6+1,6+2,2k+1,4,2j,5h+z,1m+1,1e+f,t+2,1f+e,d+3,4o+3,2s+1,w,535+1r,h3l+1i,93+2,2s,b+1,3l+x,2v,4g+3,21+3,kz+1,g5v+1,5a,j+9,n+v,2,3,2+8,2+1,3+2,2,3,46+1,4+4,h+5,r+5,r+a,3h+2,4+6,b+4,78,1r+24,4+c,4,1hb,ey+6,103+j,16j+c,1ux+7,5+g,fsh,jdq+1t,4,57+2e,p1,1m,1m,1m,1m,4kt+1,7j+17,5+2r,d+e,3+e,2+e,2+10,m+4,w,1n+5,1q,4z+5,4b+rb,9+c,4+c,4+37,d+2g,8+b,l+b,5+1j,9+9,7+13,9+t,3+1,27+3c,2+29,2+3q,d+d,3+4,4+2,6+6,a+o,8+6,a+2,e+6,16+42,2+1i",BN:"0+8,6+d,2s+5,2+p,e,4m9,1kt+2,2b+5,5+5,17q9+v,7k,6p+8,6+1,119d+3,440+7,96s+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+75,6p+2rz,1ben+1,1ekf+1,1ekf+1",NSM:"lc+33,7o+6,7c+18,2,2+1,2+1,2,21+a,1d+k,h,2u+6,3+5,3+1,2+3,10,v+q,2k+a,1n+8,a,p+3,2+8,2+2,2+4,18+2,3c+e,2+v,1k,2,5+7,5,4+6,b+1,u,1n,5+3,9,l+1,r,3+1,1m,5+1,5+1,3+2,4,v+1,4,c+1,1m,5+4,2+1,5,l+1,n+5,2,1n,3,2+3,9,8+1,c+1,v,1q,d,1f,4,1m+2,6+2,2+3,8+1,c+1,u,1n,g+1,l+1,t+1,1m+1,5+3,9,l+1,u,21,8+2,2,2j,3+6,d+7,2r,3+8,c+5,23+1,s,2,2,1k+d,2+4,2+1,6+a,2+z,a,2v+3,2+5,2+1,3+1,q+1,5+2,h+3,e,3+1,7,g,jk+2,qb+2,u+2,u+1,v+1,1t+1,2+6,9,3+a,a,1a+2,3c+1,z,3b+2,5+1,a,7+2,64+1,3,1n,2+6,2,2,3+7,7+9,3,1d+g,1s+3,1d,2+4,2,6,15+8,d+1,x+3,3+1,2+2,1l,2+1,4,2+2,1n+7,3+1,49+2,2+c,2+6,5,7,4+1,5j+1l,2+4,k1+w,2db+2,3y,2p+v,ff+3,30+1,n9x+3,2+9,x+1,29+1,7l,4,5,q+1,6,48+1,r+h,e,13+7,q+a,1b+2,1d,3+3,3+1,14,1w+5,3+1,3+1,d,9,1c,1g,2+2,3+1,6+1,2,17+1,9,6n,3,5,fn5,ki+f,h+f,r2,6b,46+4,1af+2,2+1,6+3,15+2,5,4m+1,fy+3,as+1,4a+a,4x,1j+e,1l+2,1e+3,3+1,1y+2,11+4,2+7,1r,d+1,1h+8,b+3,3,2o+2,3,2+1,7,4h,4+7,m+1,1m+1,4,12+6,4+4,5g+7,3+2,2,o,2d+5,2,5+1,2+1,6n+3,7+1,2+1,s+1,2e+7,3,2+1,2z,2,3+5,2,2u+2,3+3,2+4,78+8,2+1,75+1,2,5,41+3,3+1,5,x+5,3+1,15+5,3+3,9,a+5,3+2,1b+c,2+1,bb+6,2+5,2d+l,3+6,2+1,2+1,3f+5,4,2+1,2+6,2,21+1,4,2,9o+1,f0c+4,1o+6,t5,1s+3,2a,f5l+1,43t+2,i+7,3+6,v+3,45+2,1j0+1i,5+1d,9,f,n+4,2+e,11t+6,2+g,3+6,2+1,2+4,7a+6,c6+3,15t+6,32+6,gzhy+6n",AL:"16w,3,2,e+1b,z+2,2+2s,g+1,8+1,b+m,2+t,s+2i,c+e,4h+f,1d+1e,1bwe+dp,3+3z,x+c,2+1,35+3y,2rm+z,5+7,b+5,dt+l,c+u,17nl+27,1t+27,4x+6n,3+d",LRO:"6ct",RLO:"6cu",LRE:"6cq",RLE:"6cr",PDF:"6cs",LRI:"6ee",RLI:"6ef",FSI:"6eg",PDI:"6eh"},c={},r={};c.L=1,r[1]="L",Object.keys(i).forEach(function(W,se){c[W]=1<<se+1,r[c[W]]=W}),Object.freeze(c);var e=c.LRI|c.RLI|c.FSI,s=c.L|c.R|c.AL,o=c.B|c.S|c.WS|c.ON|c.FSI|c.LRI|c.RLI|c.PDI,a=c.BN|c.RLE|c.LRE|c.RLO|c.LRO|c.PDF,l=c.S|c.WS|c.B|e|c.PDI|a,u=null;function f(){if(!u){u=new Map;var W=function(te){if(i.hasOwnProperty(te)){var H=0;i[te].split(",").forEach(function(pe){var $=pe.split("+"),ae=$[0],Z=$[1];ae=parseInt(ae,36),Z=Z?parseInt(Z,36):0,u.set(H+=ae,c[te]);for(var Me=0;Me<Z;Me++)u.set(++H,c[te])})}};for(var se in i)W(se)}}function h(W){return f(),u.get(W.codePointAt(0))||c.L}function d(W){return r[h(W)]}var p={pairs:"14>1,1e>2,u>2,2wt>1,1>1,1ge>1,1wp>1,1j>1,f>1,hm>1,1>1,u>1,u6>1,1>1,+5,28>1,w>1,1>1,+3,b8>1,1>1,+3,1>3,-1>-1,3>1,1>1,+2,1s>1,1>1,x>1,th>1,1>1,+2,db>1,1>1,+3,3>1,1>1,+2,14qm>1,1>1,+1,4q>1,1e>2,u>2,2>1,+1",canonical:"6f1>-6dx,6dy>-6dx,6ec>-6ed,6ee>-6ed,6ww>2jj,-2ji>2jj,14r4>-1e7l,1e7m>-1e7l,1e7m>-1e5c,1e5d>-1e5b,1e5c>-14qx,14qy>-14qx,14vn>-1ecg,1ech>-1ecg,1edu>-1ecg,1eci>-1ecg,1eda>-1ecg,1eci>-1ecg,1eci>-168q,168r>-168q,168s>-14ye,14yf>-14ye"};function v(W,se){var te=36,H=0,pe=new Map,$=se&&new Map,ae;return W.split(",").forEach(function Z(Me){if(Me.indexOf("+")!==-1)for(var ie=+Me;ie--;)Z(ae);else{ae=Me;var oe=Me.split(">"),fe=oe[0],Ae=oe[1];fe=String.fromCodePoint(H+=parseInt(fe,te)),Ae=String.fromCodePoint(H+=parseInt(Ae,te)),pe.set(fe,Ae),se&&$.set(Ae,fe)}}),{map:pe,reverseMap:$}}var A,E,m;function C(){if(!A){var W=v(p.pairs,!0),se=W.map,te=W.reverseMap;A=se,E=te,m=v(p.canonical,!1).map}}function g(W){return C(),A.get(W)||null}function T(W){return C(),E.get(W)||null}function G(W){return C(),m.get(W)||null}var M=c.L,b=c.R,U=c.EN,S=c.ES,k=c.ET,y=c.AN,w=c.CS,F=c.B,j=c.S,K=c.ON,q=c.BN,V=c.NSM,P=c.AL,_=c.LRO,B=c.RLO,x=c.LRE,D=c.RLE,I=c.PDF,R=c.LRI,N=c.RLI,L=c.FSI,O=c.PDI;function Y(W,se){for(var te=125,H=new Uint32Array(W.length),pe=0;pe<W.length;pe++)H[pe]=h(W[pe]);var $=new Map;function ae(We,tt){var Qe=H[We];H[We]=tt,$.set(Qe,$.get(Qe)-1),Qe&o&&$.set(o,$.get(o)-1),$.set(tt,($.get(tt)||0)+1),tt&o&&$.set(o,($.get(o)||0)+1)}for(var Z=new Uint8Array(W.length),Me=new Map,ie=[],oe=null,fe=0;fe<W.length;fe++)oe||ie.push(oe={start:fe,end:W.length-1,level:se==="rtl"?1:se==="ltr"?0:ds(fe,!1)}),H[fe]&F&&(oe.end=fe,oe=null);for(var Ae=D|x|B|_|e|O|I|F,Fe=function(We){return We+(We&1?1:2)},Ie=function(We){return We+(We&1?2:1)},ge=0;ge<ie.length;ge++){oe=ie[ge];var Be=[{_level:oe.level,_override:0,_isolate:0}],ue=void 0,_e=0,De=0,ze=0;$.clear();for(var Re=oe.start;Re<=oe.end;Re++){var de=H[Re];if(ue=Be[Be.length-1],$.set(de,($.get(de)||0)+1),de&o&&$.set(o,($.get(o)||0)+1),de&Ae)if(de&(D|x)){Z[Re]=ue._level;var xe=(de===D?Ie:Fe)(ue._level);xe<=te&&!_e&&!De?Be.push({_level:xe,_override:0,_isolate:0}):_e||De++}else if(de&(B|_)){Z[Re]=ue._level;var pt=(de===B?Ie:Fe)(ue._level);pt<=te&&!_e&&!De?Be.push({_level:pt,_override:de&B?b:M,_isolate:0}):_e||De++}else if(de&e){de&L&&(de=ds(Re+1,!0)===1?N:R),Z[Re]=ue._level,ue._override&&ae(Re,ue._override);var Se=(de===N?Ie:Fe)(ue._level);Se<=te&&_e===0&&De===0?(ze++,Be.push({_level:Se,_override:0,_isolate:1,_isolInitIndex:Re})):_e++}else if(de&O){if(_e>0)_e--;else if(ze>0){for(De=0;!Be[Be.length-1]._isolate;)Be.pop();var Ee=Be[Be.length-1]._isolInitIndex;Ee!=null&&(Me.set(Ee,Re),Me.set(Re,Ee)),Be.pop(),ze--}ue=Be[Be.length-1],Z[Re]=ue._level,ue._override&&ae(Re,ue._override)}else de&I?(_e===0&&(De>0?De--:!ue._isolate&&Be.length>1&&(Be.pop(),ue=Be[Be.length-1])),Z[Re]=ue._level):de&F&&(Z[Re]=oe.level);else Z[Re]=ue._level,ue._override&&de!==q&&ae(Re,ue._override)}for(var Le=[],Ge=null,ve=oe.start;ve<=oe.end;ve++){var Ue=H[ve];if(!(Ue&a)){var Ke=Z[ve],Oe=Ue&e,Pe=Ue===O;Ge&&Ke===Ge._level?(Ge._end=ve,Ge._endsWithIsolInit=Oe):Le.push(Ge={_start:ve,_end:ve,_level:Ke,_startsWithPDI:Pe,_endsWithIsolInit:Oe})}}for(var $e=[],At=0;At<Le.length;At++){var ct=Le[At];if(!ct._startsWithPDI||ct._startsWithPDI&&!Me.has(ct._start)){for(var vt=[Ge=ct],Tt=void 0;Ge&&Ge._endsWithIsolInit&&(Tt=Me.get(Ge._end))!=null;)for(var ut=At+1;ut<Le.length;ut++)if(Le[ut]._start===Tt){vt.push(Ge=Le[ut]);break}for(var je=[],Mt=0;Mt<vt.length;Mt++)for(var Qn=vt[Mt],Wr=Qn._start;Wr<=Qn._end;Wr++)je.push(Wr);for(var Pi=Z[je[0]],Xn=oe.level,vr=je[0]-1;vr>=0;vr--)if(!(H[vr]&a)){Xn=Z[vr];break}var Qr=je[je.length-1],Hi=Z[Qr],Vn=oe.level;if(!(H[Qr]&e)){for(var mr=Qr+1;mr<=oe.end;mr++)if(!(H[mr]&a)){Vn=Z[mr];break}}$e.push({_seqIndices:je,_sosType:Math.max(Xn,Pi)%2?b:M,_eosType:Math.max(Vn,Hi)%2?b:M})}}for(var Xr=0;Xr<$e.length;Xr++){var Vr=$e[Xr],le=Vr._seqIndices,Qt=Vr._sosType,Oi=Vr._eosType,Lt=Z[le[0]]&1?b:M;if($.get(V))for(var gr=0;gr<le.length;gr++){var Yn=le[gr];if(H[Yn]&V){for(var Yr=Qt,Br=gr-1;Br>=0;Br--)if(!(H[le[Br]]&a)){Yr=H[le[Br]];break}ae(Yn,Yr&(e|O)?K:Yr)}}if($.get(U))for(var Cr=0;Cr<le.length;Cr++){var Zn=le[Cr];if(H[Zn]&U)for(var Er=Cr-1;Er>=-1;Er--){var qn=Er===-1?Qt:H[le[Er]];if(qn&s){qn===P&&ae(Zn,y);break}}}if($.get(P))for(var Zr=0;Zr<le.length;Zr++){var $n=le[Zr];H[$n]&P&&ae($n,b)}if($.get(S)||$.get(w))for(var Xt=1;Xt<le.length-1;Xt++){var qr=le[Xt];if(H[qr]&(S|w)){for(var Pt=0,$r=0,en=Xt-1;en>=0&&(Pt=H[le[en]],!!(Pt&a));en--);for(var tn=Xt+1;tn<le.length&&($r=H[le[tn]],!!($r&a));tn++);Pt===$r&&(H[qr]===S?Pt===U:Pt&(U|y))&&ae(qr,Pt)}}if($.get(U))for(var at=0;at<le.length;at++){var ki=le[at];if(H[ki]&U){for(var yr=at-1;yr>=0&&H[le[yr]]&(k|a);yr--)ae(le[yr],U);for(at++;at<le.length&&H[le[at]]&(k|a|U);at++)H[le[at]]!==U&&ae(le[at],U)}}if($.get(k)||$.get(S)||$.get(w))for(var Vt=0;Vt<le.length;Vt++){var es=le[Vt];if(H[es]&(k|S|w)){ae(es,K);for(var br=Vt-1;br>=0&&H[le[br]]&a;br--)ae(le[br],K);for(var Tr=Vt+1;Tr<le.length&&H[le[Tr]]&a;Tr++)ae(le[Tr],K)}}if($.get(U))for(var rn=0,ts=Qt;rn<le.length;rn++){var rs=le[rn],nn=H[rs];nn&U?ts===M&&ae(rs,M):nn&s&&(ts=nn)}if($.get(o)){var Yt=b|U|y,ns=Yt|M,Mr=[];{for(var Ht=[],Ot=0;Ot<le.length;Ot++)if(H[le[Ot]]&o){var Zt=W[le[Ot]],ss=void 0;if(g(Zt)!==null)if(Ht.length<63)Ht.push({char:Zt,seqIndex:Ot});else break;else if((ss=T(Zt))!==null)for(var qt=Ht.length-1;qt>=0;qt--){var sn=Ht[qt].char;if(sn===ss||sn===T(G(Zt))||g(G(sn))===Zt){Mr.push([Ht[qt].seqIndex,Ot]),Ht.length=qt;break}}}Mr.sort(function(We,tt){return We[0]-tt[0]})}for(var an=0;an<Mr.length;an++){for(var is=Mr[an],xr=is[0],on=is[1],as=!1,et=0,ln=xr+1;ln<on;ln++){var os=le[ln];if(H[os]&ns){as=!0;var ls=H[os]&Yt?b:M;if(ls===Lt){et=ls;break}}}if(as&&!et){et=Qt;for(var cn=xr-1;cn>=0;cn--){var cs=le[cn];if(H[cs]&ns){var us=H[cs]&Yt?b:M;us!==Lt?et=us:et=Lt;break}}}if(et){if(H[le[xr]]=H[le[on]]=et,et!==Lt){for(var $t=xr+1;$t<le.length;$t++)if(!(H[le[$t]]&a)){h(W[le[$t]])&V&&(H[le[$t]]=et);break}}if(et!==Lt){for(var er=on+1;er<le.length;er++)if(!(H[le[er]]&a)){h(W[le[er]])&V&&(H[le[er]]=et);break}}}}for(var mt=0;mt<le.length;mt++)if(H[le[mt]]&o){for(var fs=mt,un=mt,fn=Qt,tr=mt-1;tr>=0;tr--)if(H[le[tr]]&a)fs=tr;else{fn=H[le[tr]]&Yt?b:M;break}for(var hs=Oi,rr=mt+1;rr<le.length;rr++)if(H[le[rr]]&(o|a))un=rr;else{hs=H[le[rr]]&Yt?b:M;break}for(var hn=fs;hn<=un;hn++)H[le[hn]]=fn===hs?fn:Lt;mt=un}}}for(var Ve=oe.start;Ve<=oe.end;Ve++){var Ni=Z[Ve],Sr=H[Ve];if(Ni&1?Sr&(M|U|y)&&Z[Ve]++:Sr&b?Z[Ve]++:Sr&(y|U)&&(Z[Ve]+=2),Sr&a&&(Z[Ve]=Ve===0?oe.level:Z[Ve-1]),Ve===oe.end||h(W[Ve])&(j|F))for(var Fr=Ve;Fr>=0&&h(W[Fr])&l;Fr--)Z[Fr]=oe.level}}return{levels:Z,paragraphs:ie};function ds(We,tt){for(var Qe=We;Qe<W.length;Qe++){var gt=H[Qe];if(gt&(b|P))return 1;if(gt&(F|M)||tt&&gt===O)return 0;if(gt&e){var ps=Ji(Qe);Qe=ps===-1?W.length:ps}}return 0}function Ji(We){for(var tt=1,Qe=We+1;Qe<W.length;Qe++){var gt=H[Qe];if(gt&F)break;if(gt&O){if(--tt===0)return Qe}else gt&e&&tt++}return-1}}var re="14>1,j>2,t>2,u>2,1a>g,2v3>1,1>1,1ge>1,1wd>1,b>1,1j>1,f>1,ai>3,-2>3,+1,8>1k0,-1jq>1y7,-1y6>1hf,-1he>1h6,-1h5>1ha,-1h8>1qi,-1pu>1,6>3u,-3s>7,6>1,1>1,f>1,1>1,+2,3>1,1>1,+13,4>1,1>1,6>1eo,-1ee>1,3>1mg,-1me>1mk,-1mj>1mi,-1mg>1mi,-1md>1,1>1,+2,1>10k,-103>1,1>1,4>1,5>1,1>1,+10,3>1,1>8,-7>8,+1,-6>7,+1,a>1,1>1,u>1,u6>1,1>1,+5,26>1,1>1,2>1,2>2,8>1,7>1,4>1,1>1,+5,b8>1,1>1,+3,1>3,-2>1,2>1,1>1,+2,c>1,3>1,1>1,+2,h>1,3>1,a>1,1>1,2>1,3>1,1>1,d>1,f>1,3>1,1a>1,1>1,6>1,7>1,13>1,k>1,1>1,+19,4>1,1>1,+2,2>1,1>1,+18,m>1,a>1,1>1,lk>1,1>1,4>1,2>1,f>1,3>1,1>1,+3,db>1,1>1,+3,3>1,1>1,+2,14qm>1,1>1,+1,6>1,4j>1,j>2,t>2,u>2,2>1,+1",Q;function J(){if(!Q){var W=v(re,!0),se=W.map,te=W.reverseMap;te.forEach(function(H,pe){se.set(pe,H)}),Q=se}}function me(W){return J(),Q.get(W)||null}function he(W,se,te,H){var pe=W.length;te=Math.max(0,te==null?0:+te),H=Math.min(pe-1,H==null?pe-1:+H);for(var $=new Map,ae=te;ae<=H;ae++)if(se[ae]&1){var Z=me(W[ae]);Z!==null&&$.set(ae,Z)}return $}function ee(W,se,te,H){var pe=W.length;te=Math.max(0,te==null?0:+te),H=Math.min(pe-1,H==null?pe-1:+H);var $=[];return se.paragraphs.forEach(function(ae){var Z=Math.max(te,ae.start),Me=Math.min(H,ae.end);if(Z<Me){for(var ie=se.levels.slice(Z,Me+1),oe=Me;oe>=Z&&h(W[oe])&l;oe--)ie[oe]=ae.level;for(var fe=ae.level,Ae=1/0,Fe=0;Fe<ie.length;Fe++){var Ie=ie[Fe];Ie>fe&&(fe=Ie),Ie<Ae&&(Ae=Ie|1)}for(var ge=fe;ge>=Ae;ge--)for(var Be=0;Be<ie.length;Be++)if(ie[Be]>=ge){for(var ue=Be;Be+1<ie.length&&ie[Be+1]>=ge;)Be++;Be>ue&&$.push([ue+Z,Be+Z])}}}),$}function ne(W,se,te,H){var pe=ce(W,se,te,H),$=[].concat(W);return pe.forEach(function(ae,Z){$[Z]=(se.levels[ae]&1?me(W[ae]):null)||W[ae]}),$.join("")}function ce(W,se,te,H){for(var pe=ee(W,se,te,H),$=[],ae=0;ae<W.length;ae++)$[ae]=ae;return pe.forEach(function(Z){for(var Me=Z[0],ie=Z[1],oe=$.slice(Me,ie+1),fe=oe.length;fe--;)$[ie-fe]=oe[fe]}),$}return t.closingToOpeningBracket=T,t.getBidiCharType=h,t.getBidiCharTypeName=d,t.getCanonicalBracket=G,t.getEmbeddingLevels=Y,t.getMirroredCharacter=me,t.getMirroredCharactersMap=he,t.getReorderSegments=ee,t.getReorderedIndices=ce,t.getReorderedString=ne,t.openingToClosingBracket=g,Object.defineProperty(t,"__esModule",{value:!0}),t})({});return n}const Bi=/\bvoid\s+main\s*\(\s*\)\s*{/g;function Un(n){const t=/^[ \t]*#include +<([\w\d./]+)>/gm;function i(c,r){let e=Ca[r];return e?Un(e):c}return n.replace(t,i)}const He=[];for(let n=0;n<256;n++)He[n]=(n<16?"0":"")+n.toString(16);function So(){const n=Math.random()*4294967295|0,t=Math.random()*4294967295|0,i=Math.random()*4294967295|0,c=Math.random()*4294967295|0;return(He[n&255]+He[n>>8&255]+He[n>>16&255]+He[n>>24&255]+"-"+He[t&255]+He[t>>8&255]+"-"+He[t>>16&15|64]+He[t>>24&255]+"-"+He[i&63|128]+He[i>>8&255]+"-"+He[i>>16&255]+He[i>>24&255]+He[c&255]+He[c>>8&255]+He[c>>16&255]+He[c>>24&255]).toUpperCase()}const St=Object.assign||function(){let n=arguments[0];for(let t=1,i=arguments.length;t<i;t++){let c=arguments[t];if(c)for(let r in c)Object.prototype.hasOwnProperty.call(c,r)&&(n[r]=c[r])}return n},Fo=Date.now(),Ms=new WeakMap,xs=new Map;let Ro=1e10;function In(n,t){const i=Io(t);let c=Ms.get(n);if(c||Ms.set(n,c=Object.create(null)),c[i])return new c[i];const r=`_onBeforeCompile${i}`,e=function(l,u){n.onBeforeCompile.call(this,l,u);const f=this.customProgramCacheKey()+"|"+l.vertexShader+"|"+l.fragmentShader;let h=xs[f];if(!h){const d=Do(this,l,t,i);h=xs[f]=d}l.vertexShader=h.vertexShader,l.fragmentShader=h.fragmentShader,St(l.uniforms,this.uniforms),t.timeUniform&&(l.uniforms[t.timeUniform]={get value(){return Date.now()-Fo}}),this[r]&&this[r](l)},s=function(){return o(t.chained?n:n.clone())},o=function(l){const u=Object.create(l,a);return Object.defineProperty(u,"baseMaterial",{value:n}),Object.defineProperty(u,"id",{value:Ro++}),u.uuid=So(),u.uniforms=St({},l.uniforms,t.uniforms),u.defines=St({},l.defines,t.defines),u.defines[`TROIKA_DERIVED_MATERIAL_${i}`]="",u.extensions=St({},l.extensions,t.extensions),u._listeners=void 0,u},a={constructor:{value:s},isDerivedMaterial:{value:!0},type:{get:()=>n.type,set:l=>{n.type=l}},isDerivedFrom:{writable:!0,configurable:!0,value:function(l){const u=this.baseMaterial;return l===u||u.isDerivedMaterial&&u.isDerivedFrom(l)||!1}},customProgramCacheKey:{writable:!0,configurable:!0,value:function(){return n.customProgramCacheKey()+"|"+i}},onBeforeCompile:{get(){return e},set(l){this[r]=l}},copy:{writable:!0,configurable:!0,value:function(l){return n.copy.call(this,l),!n.isShaderMaterial&&!n.isDerivedMaterial&&(St(this.extensions,l.extensions),St(this.defines,l.defines),St(this.uniforms,Ba.clone(l.uniforms))),this}},clone:{writable:!0,configurable:!0,value:function(){const l=new n.constructor;return o(l).copy(this)}},getDepthMaterial:{writable:!0,configurable:!0,value:function(){let l=this._depthMaterial;return l||(l=this._depthMaterial=In(n.isDerivedMaterial?n.getDepthMaterial():new ma({depthPacking:ga}),t),l.defines.IS_DEPTH_MATERIAL="",l.uniforms=this.uniforms),l}},getDistanceMaterial:{writable:!0,configurable:!0,value:function(){let l=this._distanceMaterial;return l||(l=this._distanceMaterial=In(n.isDerivedMaterial?n.getDistanceMaterial():new va,t),l.defines.IS_DISTANCE_MATERIAL="",l.uniforms=this.uniforms),l}},dispose:{writable:!0,configurable:!0,value(){const{_depthMaterial:l,_distanceMaterial:u}=this;l&&l.dispose(),u&&u.dispose(),n.dispose.call(this)}}};return c[i]=s,new s}function Do(n,{vertexShader:t,fragmentShader:i},c,r){let{vertexDefs:e,vertexMainIntro:s,vertexMainOutro:o,vertexTransform:a,fragmentDefs:l,fragmentMainIntro:u,fragmentMainOutro:f,fragmentColorTransform:h,customRewriter:d,timeUniform:p}=c;if(e=e||"",s=s||"",o=o||"",l=l||"",u=u||"",f=f||"",(a||d)&&(t=Un(t)),(h||d)&&(i=i.replace(/^[ \t]*#include <((?:tonemapping|encodings|colorspace|fog|premultiplied_alpha|dithering)_fragment)>/gm,`
//!BEGIN_POST_CHUNK $1
$&
//!END_POST_CHUNK
`),i=Un(i)),d){let v=d({vertexShader:t,fragmentShader:i});t=v.vertexShader,i=v.fragmentShader}if(h){let v=[];i=i.replace(/^\/\/!BEGIN_POST_CHUNK[^]+?^\/\/!END_POST_CHUNK/gm,A=>(v.push(A),"")),f=`${h}
${v.join(`
`)}
${f}`}if(p){const v=`
uniform float ${p};
`;e=v+e,l=v+l}return a&&(t=`vec3 troika_position_${r};
vec3 troika_normal_${r};
vec2 troika_uv_${r};
${t}
`,e=`${e}
void troikaVertexTransform${r}(inout vec3 position, inout vec3 normal, inout vec2 uv) {
  ${a}
}
`,s=`
troika_position_${r} = vec3(position);
troika_normal_${r} = vec3(normal);
troika_uv_${r} = vec2(uv);
troikaVertexTransform${r}(troika_position_${r}, troika_normal_${r}, troika_uv_${r});
${s}
`,t=t.replace(/\b(position|normal|uv)\b/g,(v,A,E,m)=>/\battribute\s+vec[23]\s+$/.test(m.substr(0,E))?A:`troika_${A}_${r}`),n.map&&n.map.channel>0||(t=t.replace(/\bMAP_UV\b/g,`troika_uv_${r}`))),t=Ss(t,r,e,s,o),i=Ss(i,r,l,u,f),{vertexShader:t,fragmentShader:i}}function Ss(n,t,i,c,r){return(c||r||i)&&(n=n.replace(Bi,`
${i}
void troikaOrigMain${t}() {`),n+=`
void main() {
  ${c}
  troikaOrigMain${t}();
  ${r}
}`),n}function Go(n,t){return n==="uniforms"?void 0:typeof t=="function"?t.toString():t}let Uo=0;const Fs=new Map;function Io(n){const t=JSON.stringify(n,Go);let i=Fs.get(t);return i==null&&Fs.set(t,i=++Uo),i}function wo(){return typeof window>"u"&&(self.window=self),(function(n){var t={parse:function(r){var e=t._bin,s=new Uint8Array(r);if(e.readASCII(s,0,4)=="ttcf"){var o=4;e.readUshort(s,o),o+=2,e.readUshort(s,o),o+=2;var a=e.readUint(s,o);o+=4;for(var l=[],u=0;u<a;u++){var f=e.readUint(s,o);o+=4,l.push(t._readFont(s,f))}return l}return[t._readFont(s,0)]},_readFont:function(r,e){var s=t._bin,o=e;s.readFixed(r,e),e+=4;var a=s.readUshort(r,e);e+=2,s.readUshort(r,e),e+=2,s.readUshort(r,e),e+=2,s.readUshort(r,e),e+=2;for(var l=["cmap","head","hhea","maxp","hmtx","name","OS/2","post","loca","glyf","kern","CFF ","GDEF","GPOS","GSUB","SVG "],u={_data:r,_offset:o},f={},h=0;h<a;h++){var d=s.readASCII(r,e,4);e+=4,s.readUint(r,e),e+=4;var p=s.readUint(r,e);e+=4;var v=s.readUint(r,e);e+=4,f[d]={offset:p,length:v}}for(h=0;h<l.length;h++){var A=l[h];f[A]&&(u[A.trim()]=t[A.trim()].parse(r,f[A].offset,f[A].length,u))}return u},_tabOffset:function(r,e,s){for(var o=t._bin,a=o.readUshort(r,s+4),l=s+12,u=0;u<a;u++){var f=o.readASCII(r,l,4);l+=4,o.readUint(r,l),l+=4;var h=o.readUint(r,l);if(l+=4,o.readUint(r,l),l+=4,f==e)return h}return 0}};t._bin={readFixed:function(r,e){return(r[e]<<8|r[e+1])+(r[e+2]<<8|r[e+3])/65540},readF2dot14:function(r,e){return t._bin.readShort(r,e)/16384},readInt:function(r,e){return t._bin._view(r).getInt32(e)},readInt8:function(r,e){return t._bin._view(r).getInt8(e)},readShort:function(r,e){return t._bin._view(r).getInt16(e)},readUshort:function(r,e){return t._bin._view(r).getUint16(e)},readUshorts:function(r,e,s){for(var o=[],a=0;a<s;a++)o.push(t._bin.readUshort(r,e+2*a));return o},readUint:function(r,e){return t._bin._view(r).getUint32(e)},readUint64:function(r,e){return 4294967296*t._bin.readUint(r,e)+t._bin.readUint(r,e+4)},readASCII:function(r,e,s){for(var o="",a=0;a<s;a++)o+=String.fromCharCode(r[e+a]);return o},readUnicode:function(r,e,s){for(var o="",a=0;a<s;a++){var l=r[e++]<<8|r[e++];o+=String.fromCharCode(l)}return o},_tdec:typeof window<"u"&&window.TextDecoder?new window.TextDecoder:null,readUTF8:function(r,e,s){var o=t._bin._tdec;return o&&e==0&&s==r.length?o.decode(r):t._bin.readASCII(r,e,s)},readBytes:function(r,e,s){for(var o=[],a=0;a<s;a++)o.push(r[e+a]);return o},readASCIIArray:function(r,e,s){for(var o=[],a=0;a<s;a++)o.push(String.fromCharCode(r[e+a]));return o},_view:function(r){return r._dataView||(r._dataView=r.buffer?new DataView(r.buffer,r.byteOffset,r.byteLength):new DataView(new Uint8Array(r).buffer))}},t._lctf={},t._lctf.parse=function(r,e,s,o,a){var l=t._bin,u={},f=e;l.readFixed(r,e),e+=4;var h=l.readUshort(r,e);e+=2;var d=l.readUshort(r,e);e+=2;var p=l.readUshort(r,e);return e+=2,u.scriptList=t._lctf.readScriptList(r,f+h),u.featureList=t._lctf.readFeatureList(r,f+d),u.lookupList=t._lctf.readLookupList(r,f+p,a),u},t._lctf.readLookupList=function(r,e,s){var o=t._bin,a=e,l=[],u=o.readUshort(r,e);e+=2;for(var f=0;f<u;f++){var h=o.readUshort(r,e);e+=2;var d=t._lctf.readLookupTable(r,a+h,s);l.push(d)}return l},t._lctf.readLookupTable=function(r,e,s){var o=t._bin,a=e,l={tabs:[]};l.ltype=o.readUshort(r,e),e+=2,l.flag=o.readUshort(r,e),e+=2;var u=o.readUshort(r,e);e+=2;for(var f=l.ltype,h=0;h<u;h++){var d=o.readUshort(r,e);e+=2;var p=s(r,f,a+d,l);l.tabs.push(p)}return l},t._lctf.numOfOnes=function(r){for(var e=0,s=0;s<32;s++)(r>>>s&1)!=0&&e++;return e},t._lctf.readClassDef=function(r,e){var s=t._bin,o=[],a=s.readUshort(r,e);if(e+=2,a==1){var l=s.readUshort(r,e);e+=2;var u=s.readUshort(r,e);e+=2;for(var f=0;f<u;f++)o.push(l+f),o.push(l+f),o.push(s.readUshort(r,e)),e+=2}if(a==2){var h=s.readUshort(r,e);for(e+=2,f=0;f<h;f++)o.push(s.readUshort(r,e)),e+=2,o.push(s.readUshort(r,e)),e+=2,o.push(s.readUshort(r,e)),e+=2}return o},t._lctf.getInterval=function(r,e){for(var s=0;s<r.length;s+=3){var o=r[s],a=r[s+1];if(r[s+2],o<=e&&e<=a)return s}return-1},t._lctf.readCoverage=function(r,e){var s=t._bin,o={};o.fmt=s.readUshort(r,e),e+=2;var a=s.readUshort(r,e);return e+=2,o.fmt==1&&(o.tab=s.readUshorts(r,e,a)),o.fmt==2&&(o.tab=s.readUshorts(r,e,3*a)),o},t._lctf.coverageIndex=function(r,e){var s=r.tab;if(r.fmt==1)return s.indexOf(e);if(r.fmt==2){var o=t._lctf.getInterval(s,e);if(o!=-1)return s[o+2]+(e-s[o])}return-1},t._lctf.readFeatureList=function(r,e){var s=t._bin,o=e,a=[],l=s.readUshort(r,e);e+=2;for(var u=0;u<l;u++){var f=s.readASCII(r,e,4);e+=4;var h=s.readUshort(r,e);e+=2;var d=t._lctf.readFeatureTable(r,o+h);d.tag=f.trim(),a.push(d)}return a},t._lctf.readFeatureTable=function(r,e){var s=t._bin,o=e,a={},l=s.readUshort(r,e);e+=2,l>0&&(a.featureParams=o+l);var u=s.readUshort(r,e);e+=2,a.tab=[];for(var f=0;f<u;f++)a.tab.push(s.readUshort(r,e+2*f));return a},t._lctf.readScriptList=function(r,e){var s=t._bin,o=e,a={},l=s.readUshort(r,e);e+=2;for(var u=0;u<l;u++){var f=s.readASCII(r,e,4);e+=4;var h=s.readUshort(r,e);e+=2,a[f.trim()]=t._lctf.readScriptTable(r,o+h)}return a},t._lctf.readScriptTable=function(r,e){var s=t._bin,o=e,a={},l=s.readUshort(r,e);e+=2,l>0&&(a.default=t._lctf.readLangSysTable(r,o+l));var u=s.readUshort(r,e);e+=2;for(var f=0;f<u;f++){var h=s.readASCII(r,e,4);e+=4;var d=s.readUshort(r,e);e+=2,a[h.trim()]=t._lctf.readLangSysTable(r,o+d)}return a},t._lctf.readLangSysTable=function(r,e){var s=t._bin,o={};s.readUshort(r,e),e+=2,o.reqFeature=s.readUshort(r,e),e+=2;var a=s.readUshort(r,e);return e+=2,o.features=s.readUshorts(r,e,a),o},t.CFF={},t.CFF.parse=function(r,e,s){var o=t._bin;(r=new Uint8Array(r.buffer,e,s))[e=0],r[++e],r[++e],r[++e],e++;var a=[];e=t.CFF.readIndex(r,e,a);for(var l=[],u=0;u<a.length-1;u++)l.push(o.readASCII(r,e+a[u],a[u+1]-a[u]));e+=a[a.length-1];var f=[];e=t.CFF.readIndex(r,e,f);var h=[];for(u=0;u<f.length-1;u++)h.push(t.CFF.readDict(r,e+f[u],e+f[u+1]));e+=f[f.length-1];var d=h[0],p=[];e=t.CFF.readIndex(r,e,p);var v=[];for(u=0;u<p.length-1;u++)v.push(o.readASCII(r,e+p[u],p[u+1]-p[u]));if(e+=p[p.length-1],t.CFF.readSubrs(r,e,d),d.CharStrings){e=d.CharStrings,p=[],e=t.CFF.readIndex(r,e,p);var A=[];for(u=0;u<p.length-1;u++)A.push(o.readBytes(r,e+p[u],p[u+1]-p[u]));d.CharStrings=A}if(d.ROS){e=d.FDArray;var E=[];for(e=t.CFF.readIndex(r,e,E),d.FDArray=[],u=0;u<E.length-1;u++){var m=t.CFF.readDict(r,e+E[u],e+E[u+1]);t.CFF._readFDict(r,m,v),d.FDArray.push(m)}e+=E[E.length-1],e=d.FDSelect,d.FDSelect=[];var C=r[e];if(e++,C!=3)throw C;var g=o.readUshort(r,e);for(e+=2,u=0;u<g+1;u++)d.FDSelect.push(o.readUshort(r,e),r[e+2]),e+=3}return d.Encoding&&(d.Encoding=t.CFF.readEncoding(r,d.Encoding,d.CharStrings.length)),d.charset&&(d.charset=t.CFF.readCharset(r,d.charset,d.CharStrings.length)),t.CFF._readFDict(r,d,v),d},t.CFF._readFDict=function(r,e,s){var o;for(var a in e.Private&&(o=e.Private[1],e.Private=t.CFF.readDict(r,o,o+e.Private[0]),e.Private.Subrs&&t.CFF.readSubrs(r,o+e.Private.Subrs,e.Private)),e)["FamilyName","FontName","FullName","Notice","version","Copyright"].indexOf(a)!=-1&&(e[a]=s[e[a]-426+35])},t.CFF.readSubrs=function(r,e,s){var o=t._bin,a=[];e=t.CFF.readIndex(r,e,a);var l,u=a.length;l=u<1240?107:u<33900?1131:32768,s.Bias=l,s.Subrs=[];for(var f=0;f<a.length-1;f++)s.Subrs.push(o.readBytes(r,e+a[f],a[f+1]-a[f]))},t.CFF.tableSE=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,0,111,112,113,114,0,115,116,117,118,119,120,121,122,0,123,0,124,125,126,127,128,129,130,131,0,132,133,0,134,135,136,137,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,138,0,139,0,0,0,0,140,141,142,143,0,0,0,0,0,144,0,0,0,145,0,0,146,147,148,149,0,0,0,0],t.CFF.glyphByUnicode=function(r,e){for(var s=0;s<r.charset.length;s++)if(r.charset[s]==e)return s;return-1},t.CFF.glyphBySE=function(r,e){return e<0||e>255?-1:t.CFF.glyphByUnicode(r,t.CFF.tableSE[e])},t.CFF.readEncoding=function(r,e,s){t._bin;var o=[".notdef"],a=r[e];if(e++,a!=0)throw"error: unknown encoding format: "+a;var l=r[e];e++;for(var u=0;u<l;u++)o.push(r[e+u]);return o},t.CFF.readCharset=function(r,e,s){var o=t._bin,a=[".notdef"],l=r[e];if(e++,l==0)for(var u=0;u<s;u++){var f=o.readUshort(r,e);e+=2,a.push(f)}else{if(l!=1&&l!=2)throw"error: format: "+l;for(;a.length<s;){f=o.readUshort(r,e),e+=2;var h=0;for(l==1?(h=r[e],e++):(h=o.readUshort(r,e),e+=2),u=0;u<=h;u++)a.push(f),f++}}return a},t.CFF.readIndex=function(r,e,s){var o=t._bin,a=o.readUshort(r,e)+1,l=r[e+=2];if(e++,l==1)for(var u=0;u<a;u++)s.push(r[e+u]);else if(l==2)for(u=0;u<a;u++)s.push(o.readUshort(r,e+2*u));else if(l==3)for(u=0;u<a;u++)s.push(16777215&o.readUint(r,e+3*u-1));else if(a!=1)throw"unsupported offset size: "+l+", count: "+a;return(e+=a*l)-1},t.CFF.getCharString=function(r,e,s){var o=t._bin,a=r[e],l=r[e+1];r[e+2],r[e+3],r[e+4];var u=1,f=null,h=null;a<=20&&(f=a,u=1),a==12&&(f=100*a+l,u=2),21<=a&&a<=27&&(f=a,u=1),a==28&&(h=o.readShort(r,e+1),u=3),29<=a&&a<=31&&(f=a,u=1),32<=a&&a<=246&&(h=a-139,u=1),247<=a&&a<=250&&(h=256*(a-247)+l+108,u=2),251<=a&&a<=254&&(h=256*-(a-251)-l-108,u=2),a==255&&(h=o.readInt(r,e+1)/65535,u=5),s.val=h??"o"+f,s.size=u},t.CFF.readCharString=function(r,e,s){for(var o=e+s,a=t._bin,l=[];e<o;){var u=r[e],f=r[e+1];r[e+2],r[e+3],r[e+4];var h=1,d=null,p=null;u<=20&&(d=u,h=1),u==12&&(d=100*u+f,h=2),u!=19&&u!=20||(d=u,h=2),21<=u&&u<=27&&(d=u,h=1),u==28&&(p=a.readShort(r,e+1),h=3),29<=u&&u<=31&&(d=u,h=1),32<=u&&u<=246&&(p=u-139,h=1),247<=u&&u<=250&&(p=256*(u-247)+f+108,h=2),251<=u&&u<=254&&(p=256*-(u-251)-f-108,h=2),u==255&&(p=a.readInt(r,e+1)/65535,h=5),l.push(p??"o"+d),e+=h}return l},t.CFF.readDict=function(r,e,s){for(var o=t._bin,a={},l=[];e<s;){var u=r[e],f=r[e+1];r[e+2],r[e+3],r[e+4];var h=1,d=null,p=null;if(u==28&&(p=o.readShort(r,e+1),h=3),u==29&&(p=o.readInt(r,e+1),h=5),32<=u&&u<=246&&(p=u-139,h=1),247<=u&&u<=250&&(p=256*(u-247)+f+108,h=2),251<=u&&u<=254&&(p=256*-(u-251)-f-108,h=2),u==255)throw p=o.readInt(r,e+1)/65535,h=5,"unknown number";if(u==30){var v=[];for(h=1;;){var A=r[e+h];h++;var E=A>>4,m=15&A;if(E!=15&&v.push(E),m!=15&&v.push(m),m==15)break}for(var C="",g=[0,1,2,3,4,5,6,7,8,9,".","e","e-","reserved","-","endOfNumber"],T=0;T<v.length;T++)C+=g[v[T]];p=parseFloat(C)}u<=21&&(d=["version","Notice","FullName","FamilyName","Weight","FontBBox","BlueValues","OtherBlues","FamilyBlues","FamilyOtherBlues","StdHW","StdVW","escape","UniqueID","XUID","charset","Encoding","CharStrings","Private","Subrs","defaultWidthX","nominalWidthX"][u],h=1,u==12&&(d=["Copyright","isFixedPitch","ItalicAngle","UnderlinePosition","UnderlineThickness","PaintType","CharstringType","FontMatrix","StrokeWidth","BlueScale","BlueShift","BlueFuzz","StemSnapH","StemSnapV","ForceBold",0,0,"LanguageGroup","ExpansionFactor","initialRandomSeed","SyntheticBase","PostScript","BaseFontName","BaseFontBlend",0,0,0,0,0,0,"ROS","CIDFontVersion","CIDFontRevision","CIDFontType","CIDCount","UIDBase","FDArray","FDSelect","FontName"][f],h=2)),d!=null?(a[d]=l.length==1?l[0]:l,l=[]):l.push(p),e+=h}return a},t.cmap={},t.cmap.parse=function(r,e,s){r=new Uint8Array(r.buffer,e,s),e=0;var o=t._bin,a={};o.readUshort(r,e),e+=2;var l=o.readUshort(r,e);e+=2;var u=[];a.tables=[];for(var f=0;f<l;f++){var h=o.readUshort(r,e);e+=2;var d=o.readUshort(r,e);e+=2;var p=o.readUint(r,e);e+=4;var v="p"+h+"e"+d,A=u.indexOf(p);if(A==-1){var E;A=a.tables.length,u.push(p);var m=o.readUshort(r,p);m==0?E=t.cmap.parse0(r,p):m==4?E=t.cmap.parse4(r,p):m==6?E=t.cmap.parse6(r,p):m==12?E=t.cmap.parse12(r,p):console.debug("unknown format: "+m,h,d,p),a.tables.push(E)}if(a[v]!=null)throw"multiple tables for one platform+encoding";a[v]=A}return a},t.cmap.parse0=function(r,e){var s=t._bin,o={};o.format=s.readUshort(r,e),e+=2;var a=s.readUshort(r,e);e+=2,s.readUshort(r,e),e+=2,o.map=[];for(var l=0;l<a-6;l++)o.map.push(r[e+l]);return o},t.cmap.parse4=function(r,e){var s=t._bin,o=e,a={};a.format=s.readUshort(r,e),e+=2;var l=s.readUshort(r,e);e+=2,s.readUshort(r,e),e+=2;var u=s.readUshort(r,e);e+=2;var f=u/2;a.searchRange=s.readUshort(r,e),e+=2,a.entrySelector=s.readUshort(r,e),e+=2,a.rangeShift=s.readUshort(r,e),e+=2,a.endCount=s.readUshorts(r,e,f),e+=2*f,e+=2,a.startCount=s.readUshorts(r,e,f),e+=2*f,a.idDelta=[];for(var h=0;h<f;h++)a.idDelta.push(s.readShort(r,e)),e+=2;for(a.idRangeOffset=s.readUshorts(r,e,f),e+=2*f,a.glyphIdArray=[];e<o+l;)a.glyphIdArray.push(s.readUshort(r,e)),e+=2;return a},t.cmap.parse6=function(r,e){var s=t._bin,o={};o.format=s.readUshort(r,e),e+=2,s.readUshort(r,e),e+=2,s.readUshort(r,e),e+=2,o.firstCode=s.readUshort(r,e),e+=2;var a=s.readUshort(r,e);e+=2,o.glyphIdArray=[];for(var l=0;l<a;l++)o.glyphIdArray.push(s.readUshort(r,e)),e+=2;return o},t.cmap.parse12=function(r,e){var s=t._bin,o={};o.format=s.readUshort(r,e),e+=2,e+=2,s.readUint(r,e),e+=4,s.readUint(r,e),e+=4;var a=s.readUint(r,e);e+=4,o.groups=[];for(var l=0;l<a;l++){var u=e+12*l,f=s.readUint(r,u+0),h=s.readUint(r,u+4),d=s.readUint(r,u+8);o.groups.push([f,h,d])}return o},t.glyf={},t.glyf.parse=function(r,e,s,o){for(var a=[],l=0;l<o.maxp.numGlyphs;l++)a.push(null);return a},t.glyf._parseGlyf=function(r,e){var s=t._bin,o=r._data,a=t._tabOffset(o,"glyf",r._offset)+r.loca[e];if(r.loca[e]==r.loca[e+1])return null;var l={};if(l.noc=s.readShort(o,a),a+=2,l.xMin=s.readShort(o,a),a+=2,l.yMin=s.readShort(o,a),a+=2,l.xMax=s.readShort(o,a),a+=2,l.yMax=s.readShort(o,a),a+=2,l.xMin>=l.xMax||l.yMin>=l.yMax)return null;if(l.noc>0){l.endPts=[];for(var u=0;u<l.noc;u++)l.endPts.push(s.readUshort(o,a)),a+=2;var f=s.readUshort(o,a);if(a+=2,o.length-a<f)return null;l.instructions=s.readBytes(o,a,f),a+=f;var h=l.endPts[l.noc-1]+1;for(l.flags=[],u=0;u<h;u++){var d=o[a];if(a++,l.flags.push(d),(8&d)!=0){var p=o[a];a++;for(var v=0;v<p;v++)l.flags.push(d),u++}}for(l.xs=[],u=0;u<h;u++){var A=(2&l.flags[u])!=0,E=(16&l.flags[u])!=0;A?(l.xs.push(E?o[a]:-o[a]),a++):E?l.xs.push(0):(l.xs.push(s.readShort(o,a)),a+=2)}for(l.ys=[],u=0;u<h;u++)A=(4&l.flags[u])!=0,E=(32&l.flags[u])!=0,A?(l.ys.push(E?o[a]:-o[a]),a++):E?l.ys.push(0):(l.ys.push(s.readShort(o,a)),a+=2);var m=0,C=0;for(u=0;u<h;u++)m+=l.xs[u],C+=l.ys[u],l.xs[u]=m,l.ys[u]=C}else{var g;l.parts=[];do{g=s.readUshort(o,a),a+=2;var T={m:{a:1,b:0,c:0,d:1,tx:0,ty:0},p1:-1,p2:-1};if(l.parts.push(T),T.glyphIndex=s.readUshort(o,a),a+=2,1&g){var G=s.readShort(o,a);a+=2;var M=s.readShort(o,a);a+=2}else G=s.readInt8(o,a),a++,M=s.readInt8(o,a),a++;2&g?(T.m.tx=G,T.m.ty=M):(T.p1=G,T.p2=M),8&g?(T.m.a=T.m.d=s.readF2dot14(o,a),a+=2):64&g?(T.m.a=s.readF2dot14(o,a),a+=2,T.m.d=s.readF2dot14(o,a),a+=2):128&g&&(T.m.a=s.readF2dot14(o,a),a+=2,T.m.b=s.readF2dot14(o,a),a+=2,T.m.c=s.readF2dot14(o,a),a+=2,T.m.d=s.readF2dot14(o,a),a+=2)}while(32&g);if(256&g){var b=s.readUshort(o,a);for(a+=2,l.instr=[],u=0;u<b;u++)l.instr.push(o[a]),a++}}return l},t.GDEF={},t.GDEF.parse=function(r,e,s,o){var a=e;e+=4;var l=t._bin.readUshort(r,e);return{glyphClassDef:l===0?null:t._lctf.readClassDef(r,a+l)}},t.GPOS={},t.GPOS.parse=function(r,e,s,o){return t._lctf.parse(r,e,s,o,t.GPOS.subt)},t.GPOS.subt=function(r,e,s,o){var a=t._bin,l=s,u={};if(u.fmt=a.readUshort(r,s),s+=2,e==1||e==2||e==3||e==7||e==8&&u.fmt<=2){var f=a.readUshort(r,s);s+=2,u.coverage=t._lctf.readCoverage(r,f+l)}if(e==1&&u.fmt==1){var h=a.readUshort(r,s);s+=2,h!=0&&(u.pos=t.GPOS.readValueRecord(r,s,h))}else if(e==2&&u.fmt>=1&&u.fmt<=2){h=a.readUshort(r,s),s+=2;var d=a.readUshort(r,s);s+=2;var p=t._lctf.numOfOnes(h),v=t._lctf.numOfOnes(d);if(u.fmt==1){u.pairsets=[];var A=a.readUshort(r,s);s+=2;for(var E=0;E<A;E++){var m=l+a.readUshort(r,s);s+=2;var C=a.readUshort(r,m);m+=2;for(var g=[],T=0;T<C;T++){var G=a.readUshort(r,m);m+=2,h!=0&&(y=t.GPOS.readValueRecord(r,m,h),m+=2*p),d!=0&&(w=t.GPOS.readValueRecord(r,m,d),m+=2*v),g.push({gid2:G,val1:y,val2:w})}u.pairsets.push(g)}}if(u.fmt==2){var M=a.readUshort(r,s);s+=2;var b=a.readUshort(r,s);s+=2;var U=a.readUshort(r,s);s+=2;var S=a.readUshort(r,s);for(s+=2,u.classDef1=t._lctf.readClassDef(r,l+M),u.classDef2=t._lctf.readClassDef(r,l+b),u.matrix=[],E=0;E<U;E++){var k=[];for(T=0;T<S;T++){var y=null,w=null;h!=0&&(y=t.GPOS.readValueRecord(r,s,h),s+=2*p),d!=0&&(w=t.GPOS.readValueRecord(r,s,d),s+=2*v),k.push({val1:y,val2:w})}u.matrix.push(k)}}}else if(e==4&&u.fmt==1)u.markCoverage=t._lctf.readCoverage(r,a.readUshort(r,s)+l),u.baseCoverage=t._lctf.readCoverage(r,a.readUshort(r,s+2)+l),u.markClassCount=a.readUshort(r,s+4),u.markArray=t.GPOS.readMarkArray(r,a.readUshort(r,s+6)+l),u.baseArray=t.GPOS.readBaseArray(r,a.readUshort(r,s+8)+l,u.markClassCount);else if(e==6&&u.fmt==1)u.mark1Coverage=t._lctf.readCoverage(r,a.readUshort(r,s)+l),u.mark2Coverage=t._lctf.readCoverage(r,a.readUshort(r,s+2)+l),u.markClassCount=a.readUshort(r,s+4),u.mark1Array=t.GPOS.readMarkArray(r,a.readUshort(r,s+6)+l),u.mark2Array=t.GPOS.readBaseArray(r,a.readUshort(r,s+8)+l,u.markClassCount);else{if(e==9&&u.fmt==1){var F=a.readUshort(r,s);s+=2;var j=a.readUint(r,s);if(s+=4,o.ltype==9)o.ltype=F;else if(o.ltype!=F)throw"invalid extension substitution";return t.GPOS.subt(r,o.ltype,l+j)}console.debug("unsupported GPOS table LookupType",e,"format",u.fmt)}return u},t.GPOS.readValueRecord=function(r,e,s){var o=t._bin,a=[];return a.push(1&s?o.readShort(r,e):0),e+=1&s?2:0,a.push(2&s?o.readShort(r,e):0),e+=2&s?2:0,a.push(4&s?o.readShort(r,e):0),e+=4&s?2:0,a.push(8&s?o.readShort(r,e):0),e+=8&s?2:0,a},t.GPOS.readBaseArray=function(r,e,s){var o=t._bin,a=[],l=e,u=o.readUshort(r,e);e+=2;for(var f=0;f<u;f++){for(var h=[],d=0;d<s;d++)h.push(t.GPOS.readAnchorRecord(r,l+o.readUshort(r,e))),e+=2;a.push(h)}return a},t.GPOS.readMarkArray=function(r,e){var s=t._bin,o=[],a=e,l=s.readUshort(r,e);e+=2;for(var u=0;u<l;u++){var f=t.GPOS.readAnchorRecord(r,s.readUshort(r,e+2)+a);f.markClass=s.readUshort(r,e),o.push(f),e+=4}return o},t.GPOS.readAnchorRecord=function(r,e){var s=t._bin,o={};return o.fmt=s.readUshort(r,e),o.x=s.readShort(r,e+2),o.y=s.readShort(r,e+4),o},t.GSUB={},t.GSUB.parse=function(r,e,s,o){return t._lctf.parse(r,e,s,o,t.GSUB.subt)},t.GSUB.subt=function(r,e,s,o){var a=t._bin,l=s,u={};if(u.fmt=a.readUshort(r,s),s+=2,e!=1&&e!=2&&e!=4&&e!=5&&e!=6)return null;if(e==1||e==2||e==4||e==5&&u.fmt<=2||e==6&&u.fmt<=2){var f=a.readUshort(r,s);s+=2,u.coverage=t._lctf.readCoverage(r,l+f)}if(e==1&&u.fmt>=1&&u.fmt<=2){if(u.fmt==1)u.delta=a.readShort(r,s),s+=2;else if(u.fmt==2){var h=a.readUshort(r,s);s+=2,u.newg=a.readUshorts(r,s,h),s+=2*u.newg.length}}else if(e==2&&u.fmt==1){h=a.readUshort(r,s),s+=2,u.seqs=[];for(var d=0;d<h;d++){var p=a.readUshort(r,s)+l;s+=2;var v=a.readUshort(r,p);u.seqs.push(a.readUshorts(r,p+2,v))}}else if(e==4)for(u.vals=[],h=a.readUshort(r,s),s+=2,d=0;d<h;d++){var A=a.readUshort(r,s);s+=2,u.vals.push(t.GSUB.readLigatureSet(r,l+A))}else if(e==5&&u.fmt==2){if(u.fmt==2){var E=a.readUshort(r,s);s+=2,u.cDef=t._lctf.readClassDef(r,l+E),u.scset=[];var m=a.readUshort(r,s);for(s+=2,d=0;d<m;d++){var C=a.readUshort(r,s);s+=2,u.scset.push(C==0?null:t.GSUB.readSubClassSet(r,l+C))}}}else if(e==6&&u.fmt==3){if(u.fmt==3){for(d=0;d<3;d++){h=a.readUshort(r,s),s+=2;for(var g=[],T=0;T<h;T++)g.push(t._lctf.readCoverage(r,l+a.readUshort(r,s+2*T)));s+=2*h,d==0&&(u.backCvg=g),d==1&&(u.inptCvg=g),d==2&&(u.ahedCvg=g)}h=a.readUshort(r,s),s+=2,u.lookupRec=t.GSUB.readSubstLookupRecords(r,s,h)}}else{if(e==7&&u.fmt==1){var G=a.readUshort(r,s);s+=2;var M=a.readUint(r,s);if(s+=4,o.ltype==9)o.ltype=G;else if(o.ltype!=G)throw"invalid extension substitution";return t.GSUB.subt(r,o.ltype,l+M)}console.debug("unsupported GSUB table LookupType",e,"format",u.fmt)}return u},t.GSUB.readSubClassSet=function(r,e){var s=t._bin.readUshort,o=e,a=[],l=s(r,e);e+=2;for(var u=0;u<l;u++){var f=s(r,e);e+=2,a.push(t.GSUB.readSubClassRule(r,o+f))}return a},t.GSUB.readSubClassRule=function(r,e){var s=t._bin.readUshort,o={},a=s(r,e),l=s(r,e+=2);e+=2,o.input=[];for(var u=0;u<a-1;u++)o.input.push(s(r,e)),e+=2;return o.substLookupRecords=t.GSUB.readSubstLookupRecords(r,e,l),o},t.GSUB.readSubstLookupRecords=function(r,e,s){for(var o=t._bin.readUshort,a=[],l=0;l<s;l++)a.push(o(r,e),o(r,e+2)),e+=4;return a},t.GSUB.readChainSubClassSet=function(r,e){var s=t._bin,o=e,a=[],l=s.readUshort(r,e);e+=2;for(var u=0;u<l;u++){var f=s.readUshort(r,e);e+=2,a.push(t.GSUB.readChainSubClassRule(r,o+f))}return a},t.GSUB.readChainSubClassRule=function(r,e){for(var s=t._bin,o={},a=["backtrack","input","lookahead"],l=0;l<a.length;l++){var u=s.readUshort(r,e);e+=2,l==1&&u--,o[a[l]]=s.readUshorts(r,e,u),e+=2*o[a[l]].length}return u=s.readUshort(r,e),e+=2,o.subst=s.readUshorts(r,e,2*u),e+=2*o.subst.length,o},t.GSUB.readLigatureSet=function(r,e){var s=t._bin,o=e,a=[],l=s.readUshort(r,e);e+=2;for(var u=0;u<l;u++){var f=s.readUshort(r,e);e+=2,a.push(t.GSUB.readLigature(r,o+f))}return a},t.GSUB.readLigature=function(r,e){var s=t._bin,o={chain:[]};o.nglyph=s.readUshort(r,e),e+=2;var a=s.readUshort(r,e);e+=2;for(var l=0;l<a-1;l++)o.chain.push(s.readUshort(r,e)),e+=2;return o},t.head={},t.head.parse=function(r,e,s){var o=t._bin,a={};return o.readFixed(r,e),e+=4,a.fontRevision=o.readFixed(r,e),e+=4,o.readUint(r,e),e+=4,o.readUint(r,e),e+=4,a.flags=o.readUshort(r,e),e+=2,a.unitsPerEm=o.readUshort(r,e),e+=2,a.created=o.readUint64(r,e),e+=8,a.modified=o.readUint64(r,e),e+=8,a.xMin=o.readShort(r,e),e+=2,a.yMin=o.readShort(r,e),e+=2,a.xMax=o.readShort(r,e),e+=2,a.yMax=o.readShort(r,e),e+=2,a.macStyle=o.readUshort(r,e),e+=2,a.lowestRecPPEM=o.readUshort(r,e),e+=2,a.fontDirectionHint=o.readShort(r,e),e+=2,a.indexToLocFormat=o.readShort(r,e),e+=2,a.glyphDataFormat=o.readShort(r,e),e+=2,a},t.hhea={},t.hhea.parse=function(r,e,s){var o=t._bin,a={};return o.readFixed(r,e),e+=4,a.ascender=o.readShort(r,e),e+=2,a.descender=o.readShort(r,e),e+=2,a.lineGap=o.readShort(r,e),e+=2,a.advanceWidthMax=o.readUshort(r,e),e+=2,a.minLeftSideBearing=o.readShort(r,e),e+=2,a.minRightSideBearing=o.readShort(r,e),e+=2,a.xMaxExtent=o.readShort(r,e),e+=2,a.caretSlopeRise=o.readShort(r,e),e+=2,a.caretSlopeRun=o.readShort(r,e),e+=2,a.caretOffset=o.readShort(r,e),e+=2,e+=8,a.metricDataFormat=o.readShort(r,e),e+=2,a.numberOfHMetrics=o.readUshort(r,e),e+=2,a},t.hmtx={},t.hmtx.parse=function(r,e,s,o){for(var a=t._bin,l={aWidth:[],lsBearing:[]},u=0,f=0,h=0;h<o.maxp.numGlyphs;h++)h<o.hhea.numberOfHMetrics&&(u=a.readUshort(r,e),e+=2,f=a.readShort(r,e),e+=2),l.aWidth.push(u),l.lsBearing.push(f);return l},t.kern={},t.kern.parse=function(r,e,s,o){var a=t._bin,l=a.readUshort(r,e);if(e+=2,l==1)return t.kern.parseV1(r,e-2,s,o);var u=a.readUshort(r,e);e+=2;for(var f={glyph1:[],rval:[]},h=0;h<u;h++){e+=2,s=a.readUshort(r,e),e+=2;var d=a.readUshort(r,e);e+=2;var p=d>>>8;if((p&=15)!=0)throw"unknown kern table format: "+p;e=t.kern.readFormat0(r,e,f)}return f},t.kern.parseV1=function(r,e,s,o){var a=t._bin;a.readFixed(r,e),e+=4;var l=a.readUint(r,e);e+=4;for(var u={glyph1:[],rval:[]},f=0;f<l;f++){a.readUint(r,e),e+=4;var h=a.readUshort(r,e);e+=2,a.readUshort(r,e),e+=2;var d=h>>>8;if((d&=15)!=0)throw"unknown kern table format: "+d;e=t.kern.readFormat0(r,e,u)}return u},t.kern.readFormat0=function(r,e,s){var o=t._bin,a=-1,l=o.readUshort(r,e);e+=2,o.readUshort(r,e),e+=2,o.readUshort(r,e),e+=2,o.readUshort(r,e),e+=2;for(var u=0;u<l;u++){var f=o.readUshort(r,e);e+=2;var h=o.readUshort(r,e);e+=2;var d=o.readShort(r,e);e+=2,f!=a&&(s.glyph1.push(f),s.rval.push({glyph2:[],vals:[]}));var p=s.rval[s.rval.length-1];p.glyph2.push(h),p.vals.push(d),a=f}return e},t.loca={},t.loca.parse=function(r,e,s,o){var a=t._bin,l=[],u=o.head.indexToLocFormat,f=o.maxp.numGlyphs+1;if(u==0)for(var h=0;h<f;h++)l.push(a.readUshort(r,e+(h<<1))<<1);if(u==1)for(h=0;h<f;h++)l.push(a.readUint(r,e+(h<<2)));return l},t.maxp={},t.maxp.parse=function(r,e,s){var o=t._bin,a={},l=o.readUint(r,e);return e+=4,a.numGlyphs=o.readUshort(r,e),e+=2,l==65536&&(a.maxPoints=o.readUshort(r,e),e+=2,a.maxContours=o.readUshort(r,e),e+=2,a.maxCompositePoints=o.readUshort(r,e),e+=2,a.maxCompositeContours=o.readUshort(r,e),e+=2,a.maxZones=o.readUshort(r,e),e+=2,a.maxTwilightPoints=o.readUshort(r,e),e+=2,a.maxStorage=o.readUshort(r,e),e+=2,a.maxFunctionDefs=o.readUshort(r,e),e+=2,a.maxInstructionDefs=o.readUshort(r,e),e+=2,a.maxStackElements=o.readUshort(r,e),e+=2,a.maxSizeOfInstructions=o.readUshort(r,e),e+=2,a.maxComponentElements=o.readUshort(r,e),e+=2,a.maxComponentDepth=o.readUshort(r,e),e+=2),a},t.name={},t.name.parse=function(r,e,s){var o=t._bin,a={};o.readUshort(r,e),e+=2;var l=o.readUshort(r,e);e+=2,o.readUshort(r,e);for(var u,f=["copyright","fontFamily","fontSubfamily","ID","fullName","version","postScriptName","trademark","manufacturer","designer","description","urlVendor","urlDesigner","licence","licenceURL","---","typoFamilyName","typoSubfamilyName","compatibleFull","sampleText","postScriptCID","wwsFamilyName","wwsSubfamilyName","lightPalette","darkPalette"],h=e+=2,d=0;d<l;d++){var p=o.readUshort(r,e);e+=2;var v=o.readUshort(r,e);e+=2;var A=o.readUshort(r,e);e+=2;var E=o.readUshort(r,e);e+=2;var m=o.readUshort(r,e);e+=2;var C=o.readUshort(r,e);e+=2;var g,T=f[E],G=h+12*l+C;if(p==0)g=o.readUnicode(r,G,m/2);else if(p==3&&v==0)g=o.readUnicode(r,G,m/2);else if(v==0)g=o.readASCII(r,G,m);else if(v==1)g=o.readUnicode(r,G,m/2);else if(v==3)g=o.readUnicode(r,G,m/2);else{if(p!=1)throw"unknown encoding "+v+", platformID: "+p;g=o.readASCII(r,G,m),console.debug("reading unknown MAC encoding "+v+" as ASCII")}var M="p"+p+","+A.toString(16);a[M]==null&&(a[M]={}),a[M][T!==void 0?T:E]=g,a[M]._lang=A}for(var b in a)if(a[b].postScriptName!=null&&a[b]._lang==1033)return a[b];for(var b in a)if(a[b].postScriptName!=null&&a[b]._lang==0)return a[b];for(var b in a)if(a[b].postScriptName!=null&&a[b]._lang==3084)return a[b];for(var b in a)if(a[b].postScriptName!=null)return a[b];for(var b in a){u=b;break}return console.debug("returning name table with languageID "+a[u]._lang),a[u]},t["OS/2"]={},t["OS/2"].parse=function(r,e,s){var o=t._bin.readUshort(r,e);e+=2;var a={};if(o==0)t["OS/2"].version0(r,e,a);else if(o==1)t["OS/2"].version1(r,e,a);else if(o==2||o==3||o==4)t["OS/2"].version2(r,e,a);else{if(o!=5)throw"unknown OS/2 table version: "+o;t["OS/2"].version5(r,e,a)}return a},t["OS/2"].version0=function(r,e,s){var o=t._bin;return s.xAvgCharWidth=o.readShort(r,e),e+=2,s.usWeightClass=o.readUshort(r,e),e+=2,s.usWidthClass=o.readUshort(r,e),e+=2,s.fsType=o.readUshort(r,e),e+=2,s.ySubscriptXSize=o.readShort(r,e),e+=2,s.ySubscriptYSize=o.readShort(r,e),e+=2,s.ySubscriptXOffset=o.readShort(r,e),e+=2,s.ySubscriptYOffset=o.readShort(r,e),e+=2,s.ySuperscriptXSize=o.readShort(r,e),e+=2,s.ySuperscriptYSize=o.readShort(r,e),e+=2,s.ySuperscriptXOffset=o.readShort(r,e),e+=2,s.ySuperscriptYOffset=o.readShort(r,e),e+=2,s.yStrikeoutSize=o.readShort(r,e),e+=2,s.yStrikeoutPosition=o.readShort(r,e),e+=2,s.sFamilyClass=o.readShort(r,e),e+=2,s.panose=o.readBytes(r,e,10),e+=10,s.ulUnicodeRange1=o.readUint(r,e),e+=4,s.ulUnicodeRange2=o.readUint(r,e),e+=4,s.ulUnicodeRange3=o.readUint(r,e),e+=4,s.ulUnicodeRange4=o.readUint(r,e),e+=4,s.achVendID=[o.readInt8(r,e),o.readInt8(r,e+1),o.readInt8(r,e+2),o.readInt8(r,e+3)],e+=4,s.fsSelection=o.readUshort(r,e),e+=2,s.usFirstCharIndex=o.readUshort(r,e),e+=2,s.usLastCharIndex=o.readUshort(r,e),e+=2,s.sTypoAscender=o.readShort(r,e),e+=2,s.sTypoDescender=o.readShort(r,e),e+=2,s.sTypoLineGap=o.readShort(r,e),e+=2,s.usWinAscent=o.readUshort(r,e),e+=2,s.usWinDescent=o.readUshort(r,e),e+=2},t["OS/2"].version1=function(r,e,s){var o=t._bin;return e=t["OS/2"].version0(r,e,s),s.ulCodePageRange1=o.readUint(r,e),e+=4,s.ulCodePageRange2=o.readUint(r,e),e+=4},t["OS/2"].version2=function(r,e,s){var o=t._bin;return e=t["OS/2"].version1(r,e,s),s.sxHeight=o.readShort(r,e),e+=2,s.sCapHeight=o.readShort(r,e),e+=2,s.usDefault=o.readUshort(r,e),e+=2,s.usBreak=o.readUshort(r,e),e+=2,s.usMaxContext=o.readUshort(r,e),e+=2},t["OS/2"].version5=function(r,e,s){var o=t._bin;return e=t["OS/2"].version2(r,e,s),s.usLowerOpticalPointSize=o.readUshort(r,e),e+=2,s.usUpperOpticalPointSize=o.readUshort(r,e),e+=2},t.post={},t.post.parse=function(r,e,s){var o=t._bin,a={};return a.version=o.readFixed(r,e),e+=4,a.italicAngle=o.readFixed(r,e),e+=4,a.underlinePosition=o.readShort(r,e),e+=2,a.underlineThickness=o.readShort(r,e),e+=2,a},t==null&&(t={}),t.U==null&&(t.U={}),t.U.codeToGlyph=function(r,e){var s=r.cmap,o=-1;if(s.p0e4!=null?o=s.p0e4:s.p3e1!=null?o=s.p3e1:s.p1e0!=null?o=s.p1e0:s.p0e3!=null&&(o=s.p0e3),o==-1)throw"no familiar platform and encoding!";var a=s.tables[o];if(a.format==0)return e>=a.map.length?0:a.map[e];if(a.format==4){for(var l=-1,u=0;u<a.endCount.length;u++)if(e<=a.endCount[u]){l=u;break}return l==-1||a.startCount[l]>e?0:65535&(a.idRangeOffset[l]!=0?a.glyphIdArray[e-a.startCount[l]+(a.idRangeOffset[l]>>1)-(a.idRangeOffset.length-l)]:e+a.idDelta[l])}if(a.format==12){if(e>a.groups[a.groups.length-1][1])return 0;for(u=0;u<a.groups.length;u++){var f=a.groups[u];if(f[0]<=e&&e<=f[1])return f[2]+(e-f[0])}return 0}throw"unknown cmap table format "+a.format},t.U.glyphToPath=function(r,e){var s={cmds:[],crds:[]};if(r.SVG&&r.SVG.entries[e]){var o=r.SVG.entries[e];return o==null?s:(typeof o=="string"&&(o=t.SVG.toPath(o),r.SVG.entries[e]=o),o)}if(r.CFF){var a={x:0,y:0,stack:[],nStems:0,haveWidth:!1,width:r.CFF.Private?r.CFF.Private.defaultWidthX:0,open:!1},l=r.CFF,u=r.CFF.Private;if(l.ROS){for(var f=0;l.FDSelect[f+2]<=e;)f+=2;u=l.FDArray[l.FDSelect[f+1]].Private}t.U._drawCFF(r.CFF.CharStrings[e],a,l,u,s)}else r.glyf&&t.U._drawGlyf(e,r,s);return s},t.U._drawGlyf=function(r,e,s){var o=e.glyf[r];o==null&&(o=e.glyf[r]=t.glyf._parseGlyf(e,r)),o!=null&&(o.noc>-1?t.U._simpleGlyph(o,s):t.U._compoGlyph(o,e,s))},t.U._simpleGlyph=function(r,e){for(var s=0;s<r.noc;s++){for(var o=s==0?0:r.endPts[s-1]+1,a=r.endPts[s],l=o;l<=a;l++){var u=l==o?a:l-1,f=l==a?o:l+1,h=1&r.flags[l],d=1&r.flags[u],p=1&r.flags[f],v=r.xs[l],A=r.ys[l];if(l==o)if(h){if(!d){t.U.P.moveTo(e,v,A);continue}t.U.P.moveTo(e,r.xs[u],r.ys[u])}else d?t.U.P.moveTo(e,r.xs[u],r.ys[u]):t.U.P.moveTo(e,(r.xs[u]+v)/2,(r.ys[u]+A)/2);h?d&&t.U.P.lineTo(e,v,A):p?t.U.P.qcurveTo(e,v,A,r.xs[f],r.ys[f]):t.U.P.qcurveTo(e,v,A,(v+r.xs[f])/2,(A+r.ys[f])/2)}t.U.P.closePath(e)}},t.U._compoGlyph=function(r,e,s){for(var o=0;o<r.parts.length;o++){var a={cmds:[],crds:[]},l=r.parts[o];t.U._drawGlyf(l.glyphIndex,e,a);for(var u=l.m,f=0;f<a.crds.length;f+=2){var h=a.crds[f],d=a.crds[f+1];s.crds.push(h*u.a+d*u.b+u.tx),s.crds.push(h*u.c+d*u.d+u.ty)}for(f=0;f<a.cmds.length;f++)s.cmds.push(a.cmds[f])}},t.U._getGlyphClass=function(r,e){var s=t._lctf.getInterval(e,r);return s==-1?0:e[s+2]},t.U._applySubs=function(r,e,s,o){for(var a=r.length-e-1,l=0;l<s.tabs.length;l++)if(s.tabs[l]!=null){var u,f=s.tabs[l];if(!f.coverage||(u=t._lctf.coverageIndex(f.coverage,r[e]))!=-1){if(s.ltype==1)r[e],f.fmt==1?r[e]=r[e]+f.delta:r[e]=f.newg[u];else if(s.ltype==4)for(var h=f.vals[u],d=0;d<h.length;d++){var p=h[d],v=p.chain.length;if(!(v>a)){for(var A=!0,E=0,m=0;m<v;m++){for(;r[e+E+(1+m)]==-1;)E++;p.chain[m]!=r[e+E+(1+m)]&&(A=!1)}if(A){for(r[e]=p.nglyph,m=0;m<v+E;m++)r[e+m+1]=-1;break}}}else if(s.ltype==5&&f.fmt==2)for(var C=t._lctf.getInterval(f.cDef,r[e]),g=f.cDef[C+2],T=f.scset[g],G=0;G<T.length;G++){var M=T[G],b=M.input;if(!(b.length>a)){for(A=!0,m=0;m<b.length;m++){var U=t._lctf.getInterval(f.cDef,r[e+1+m]);if(C==-1&&f.cDef[U+2]!=b[m]){A=!1;break}}if(A){var S=M.substLookupRecords;for(d=0;d<S.length;d+=2)S[d],S[d+1]}}}else if(s.ltype==6&&f.fmt==3){if(!t.U._glsCovered(r,f.backCvg,e-f.backCvg.length)||!t.U._glsCovered(r,f.inptCvg,e)||!t.U._glsCovered(r,f.ahedCvg,e+f.inptCvg.length))continue;var k=f.lookupRec;for(G=0;G<k.length;G+=2){C=k[G];var y=o[k[G+1]];t.U._applySubs(r,e+C,y,o)}}}}},t.U._glsCovered=function(r,e,s){for(var o=0;o<e.length;o++)if(t._lctf.coverageIndex(e[o],r[s+o])==-1)return!1;return!0},t.U.glyphsToPath=function(r,e,s){for(var o={cmds:[],crds:[]},a=0,l=0;l<e.length;l++){var u=e[l];if(u!=-1){for(var f=l<e.length-1&&e[l+1]!=-1?e[l+1]:0,h=t.U.glyphToPath(r,u),d=0;d<h.crds.length;d+=2)o.crds.push(h.crds[d]+a),o.crds.push(h.crds[d+1]);for(s&&o.cmds.push(s),d=0;d<h.cmds.length;d++)o.cmds.push(h.cmds[d]);s&&o.cmds.push("X"),a+=r.hmtx.aWidth[u],l<e.length-1&&(a+=t.U.getPairAdjustment(r,u,f))}}return o},t.U.P={},t.U.P.moveTo=function(r,e,s){r.cmds.push("M"),r.crds.push(e,s)},t.U.P.lineTo=function(r,e,s){r.cmds.push("L"),r.crds.push(e,s)},t.U.P.curveTo=function(r,e,s,o,a,l,u){r.cmds.push("C"),r.crds.push(e,s,o,a,l,u)},t.U.P.qcurveTo=function(r,e,s,o,a){r.cmds.push("Q"),r.crds.push(e,s,o,a)},t.U.P.closePath=function(r){r.cmds.push("Z")},t.U._drawCFF=function(r,e,s,o,a){for(var l=e.stack,u=e.nStems,f=e.haveWidth,h=e.width,d=e.open,p=0,v=e.x,A=e.y,E=0,m=0,C=0,g=0,T=0,G=0,M=0,b=0,U=0,S=0,k={val:0,size:0};p<r.length;){t.CFF.getCharString(r,p,k);var y=k.val;if(p+=k.size,y=="o1"||y=="o18")l.length%2!=0&&!f&&(h=l.shift()+o.nominalWidthX),u+=l.length>>1,l.length=0,f=!0;else if(y=="o3"||y=="o23")l.length%2!=0&&!f&&(h=l.shift()+o.nominalWidthX),u+=l.length>>1,l.length=0,f=!0;else if(y=="o4")l.length>1&&!f&&(h=l.shift()+o.nominalWidthX,f=!0),d&&t.U.P.closePath(a),A+=l.pop(),t.U.P.moveTo(a,v,A),d=!0;else if(y=="o5")for(;l.length>0;)v+=l.shift(),A+=l.shift(),t.U.P.lineTo(a,v,A);else if(y=="o6"||y=="o7")for(var w=l.length,F=y=="o6",j=0;j<w;j++){var K=l.shift();F?v+=K:A+=K,F=!F,t.U.P.lineTo(a,v,A)}else if(y=="o8"||y=="o24"){w=l.length;for(var q=0;q+6<=w;)E=v+l.shift(),m=A+l.shift(),C=E+l.shift(),g=m+l.shift(),v=C+l.shift(),A=g+l.shift(),t.U.P.curveTo(a,E,m,C,g,v,A),q+=6;y=="o24"&&(v+=l.shift(),A+=l.shift(),t.U.P.lineTo(a,v,A))}else{if(y=="o11")break;if(y=="o1234"||y=="o1235"||y=="o1236"||y=="o1237")y=="o1234"&&(m=A,C=(E=v+l.shift())+l.shift(),S=g=m+l.shift(),G=g,b=A,v=(M=(T=(U=C+l.shift())+l.shift())+l.shift())+l.shift(),t.U.P.curveTo(a,E,m,C,g,U,S),t.U.P.curveTo(a,T,G,M,b,v,A)),y=="o1235"&&(E=v+l.shift(),m=A+l.shift(),C=E+l.shift(),g=m+l.shift(),U=C+l.shift(),S=g+l.shift(),T=U+l.shift(),G=S+l.shift(),M=T+l.shift(),b=G+l.shift(),v=M+l.shift(),A=b+l.shift(),l.shift(),t.U.P.curveTo(a,E,m,C,g,U,S),t.U.P.curveTo(a,T,G,M,b,v,A)),y=="o1236"&&(E=v+l.shift(),m=A+l.shift(),C=E+l.shift(),S=g=m+l.shift(),G=g,M=(T=(U=C+l.shift())+l.shift())+l.shift(),b=G+l.shift(),v=M+l.shift(),t.U.P.curveTo(a,E,m,C,g,U,S),t.U.P.curveTo(a,T,G,M,b,v,A)),y=="o1237"&&(E=v+l.shift(),m=A+l.shift(),C=E+l.shift(),g=m+l.shift(),U=C+l.shift(),S=g+l.shift(),T=U+l.shift(),G=S+l.shift(),M=T+l.shift(),b=G+l.shift(),Math.abs(M-v)>Math.abs(b-A)?v=M+l.shift():A=b+l.shift(),t.U.P.curveTo(a,E,m,C,g,U,S),t.U.P.curveTo(a,T,G,M,b,v,A));else if(y=="o14"){if(l.length>0&&!f&&(h=l.shift()+s.nominalWidthX,f=!0),l.length==4){var V=l.shift(),P=l.shift(),_=l.shift(),B=l.shift(),x=t.CFF.glyphBySE(s,_),D=t.CFF.glyphBySE(s,B);t.U._drawCFF(s.CharStrings[x],e,s,o,a),e.x=V,e.y=P,t.U._drawCFF(s.CharStrings[D],e,s,o,a)}d&&(t.U.P.closePath(a),d=!1)}else if(y=="o19"||y=="o20")l.length%2!=0&&!f&&(h=l.shift()+o.nominalWidthX),u+=l.length>>1,l.length=0,f=!0,p+=u+7>>3;else if(y=="o21")l.length>2&&!f&&(h=l.shift()+o.nominalWidthX,f=!0),A+=l.pop(),v+=l.pop(),d&&t.U.P.closePath(a),t.U.P.moveTo(a,v,A),d=!0;else if(y=="o22")l.length>1&&!f&&(h=l.shift()+o.nominalWidthX,f=!0),v+=l.pop(),d&&t.U.P.closePath(a),t.U.P.moveTo(a,v,A),d=!0;else if(y=="o25"){for(;l.length>6;)v+=l.shift(),A+=l.shift(),t.U.P.lineTo(a,v,A);E=v+l.shift(),m=A+l.shift(),C=E+l.shift(),g=m+l.shift(),v=C+l.shift(),A=g+l.shift(),t.U.P.curveTo(a,E,m,C,g,v,A)}else if(y=="o26")for(l.length%2&&(v+=l.shift());l.length>0;)E=v,m=A+l.shift(),v=C=E+l.shift(),A=(g=m+l.shift())+l.shift(),t.U.P.curveTo(a,E,m,C,g,v,A);else if(y=="o27")for(l.length%2&&(A+=l.shift());l.length>0;)m=A,C=(E=v+l.shift())+l.shift(),g=m+l.shift(),v=C+l.shift(),A=g,t.U.P.curveTo(a,E,m,C,g,v,A);else if(y=="o10"||y=="o29"){var I=y=="o10"?o:s;if(l.length==0)console.debug("error: empty stack");else{var R=l.pop(),N=I.Subrs[R+I.Bias];e.x=v,e.y=A,e.nStems=u,e.haveWidth=f,e.width=h,e.open=d,t.U._drawCFF(N,e,s,o,a),v=e.x,A=e.y,u=e.nStems,f=e.haveWidth,h=e.width,d=e.open}}else if(y=="o30"||y=="o31"){var L=l.length,O=(q=0,y=="o31");for(q+=L-(w=-3&L);q<w;)O?(m=A,C=(E=v+l.shift())+l.shift(),A=(g=m+l.shift())+l.shift(),w-q==5?(v=C+l.shift(),q++):v=C,O=!1):(E=v,m=A+l.shift(),C=E+l.shift(),g=m+l.shift(),v=C+l.shift(),w-q==5?(A=g+l.shift(),q++):A=g,O=!0),t.U.P.curveTo(a,E,m,C,g,v,A),q+=4}else{if((y+"").charAt(0)=="o")throw console.debug("Unknown operation: "+y,r),y;l.push(y)}}}e.x=v,e.y=A,e.nStems=u,e.haveWidth=f,e.width=h,e.open=d};var i=t,c={Typr:i};return n.Typr=i,n.default=c,Object.defineProperty(n,"__esModule",{value:!0}),n})({}).Typr}function _o(){return(function(n){var t=Uint8Array,i=Uint16Array,c=Uint32Array,r=new t([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),e=new t([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),s=new t([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),o=function(y,w){for(var F=new i(31),j=0;j<31;++j)F[j]=w+=1<<y[j-1];var K=new c(F[30]);for(j=1;j<30;++j)for(var q=F[j];q<F[j+1];++q)K[q]=q-F[j]<<5|j;return[F,K]},a=o(r,2),l=a[0],u=a[1];l[28]=258,u[258]=28;for(var f=o(e,0)[0],h=new i(32768),d=0;d<32768;++d){var p=(43690&d)>>>1|(21845&d)<<1;p=(61680&(p=(52428&p)>>>2|(13107&p)<<2))>>>4|(3855&p)<<4,h[d]=((65280&p)>>>8|(255&p)<<8)>>>1}var v=function(y,w,F){for(var j=y.length,K=0,q=new i(w);K<j;++K)++q[y[K]-1];var V,P=new i(w);for(K=0;K<w;++K)P[K]=P[K-1]+q[K-1]<<1;{V=new i(1<<w);var _=15-w;for(K=0;K<j;++K)if(y[K])for(var B=K<<4|y[K],x=w-y[K],D=P[y[K]-1]++<<x,I=D|(1<<x)-1;D<=I;++D)V[h[D]>>>_]=B}return V},A=new t(288);for(d=0;d<144;++d)A[d]=8;for(d=144;d<256;++d)A[d]=9;for(d=256;d<280;++d)A[d]=7;for(d=280;d<288;++d)A[d]=8;var E=new t(32);for(d=0;d<32;++d)E[d]=5;var m=v(A,9),C=v(E,5),g=function(y){for(var w=y[0],F=1;F<y.length;++F)y[F]>w&&(w=y[F]);return w},T=function(y,w,F){var j=w/8|0;return(y[j]|y[j+1]<<8)>>(7&w)&F},G=function(y,w){var F=w/8|0;return(y[F]|y[F+1]<<8|y[F+2]<<16)>>(7&w)},M=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],b=function(y,w,F){var j=new Error(w||M[y]);if(j.code=y,Error.captureStackTrace&&Error.captureStackTrace(j,b),!F)throw j;return j},U=function(y,w,F){var j=y.length;if(!j||F&&!F.l&&j<5)return w||new t(0);var K=!w||F,q=!F||F.i;F||(F={}),w||(w=new t(3*j));var V,P=function(ue){var _e=w.length;if(ue>_e){var De=new t(Math.max(2*_e,ue));De.set(w),w=De}},_=F.f||0,B=F.p||0,x=F.b||0,D=F.l,I=F.d,R=F.m,N=F.n,L=8*j;do{if(!D){F.f=_=T(y,B,1);var O=T(y,B+1,3);if(B+=3,!O){var Y=y[(te=((V=B)/8|0)+(7&V&&1)+4)-4]|y[te-3]<<8,re=te+Y;if(re>j){q&&b(0);break}K&&P(x+Y),w.set(y.subarray(te,re),x),F.b=x+=Y,F.p=B=8*re;continue}if(O==1)D=m,I=C,R=9,N=5;else if(O==2){var Q=T(y,B,31)+257,J=T(y,B+10,15)+4,me=Q+T(y,B+5,31)+1;B+=14;for(var he=new t(me),ee=new t(19),ne=0;ne<J;++ne)ee[s[ne]]=T(y,B+3*ne,7);B+=3*J;var ce=g(ee),W=(1<<ce)-1,se=v(ee,ce);for(ne=0;ne<me;){var te,H=se[T(y,B,W)];if(B+=15&H,(te=H>>>4)<16)he[ne++]=te;else{var pe=0,$=0;for(te==16?($=3+T(y,B,3),B+=2,pe=he[ne-1]):te==17?($=3+T(y,B,7),B+=3):te==18&&($=11+T(y,B,127),B+=7);$--;)he[ne++]=pe}}var ae=he.subarray(0,Q),Z=he.subarray(Q);R=g(ae),N=g(Z),D=v(ae,R),I=v(Z,N)}else b(1);if(B>L){q&&b(0);break}}K&&P(x+131072);for(var Me=(1<<R)-1,ie=(1<<N)-1,oe=B;;oe=B){var fe=(pe=D[G(y,B)&Me])>>>4;if((B+=15&pe)>L){q&&b(0);break}if(pe||b(2),fe<256)w[x++]=fe;else{if(fe==256){oe=B,D=null;break}var Ae=fe-254;if(fe>264){var Fe=r[ne=fe-257];Ae=T(y,B,(1<<Fe)-1)+l[ne],B+=Fe}var Ie=I[G(y,B)&ie],ge=Ie>>>4;if(Ie||b(3),B+=15&Ie,Z=f[ge],ge>3&&(Fe=e[ge],Z+=G(y,B)&(1<<Fe)-1,B+=Fe),B>L){q&&b(0);break}K&&P(x+131072);for(var Be=x+Ae;x<Be;x+=4)w[x]=w[x-Z],w[x+1]=w[x+1-Z],w[x+2]=w[x+2-Z],w[x+3]=w[x+3-Z];x=Be}}F.l=D,F.p=oe,F.b=x,D&&(_=1,F.m=R,F.d=I,F.n=N)}while(!_);return x==w.length?w:(function(ue,_e,De){(De==null||De>ue.length)&&(De=ue.length);var ze=new(ue instanceof i?i:ue instanceof c?c:t)(De-_e);return ze.set(ue.subarray(_e,De)),ze})(w,0,x)},S=new t(0),k=typeof TextDecoder<"u"&&new TextDecoder;try{k.decode(S,{stream:!0})}catch{}return n.convert_streams=function(y){var w=new DataView(y),F=0;function j(){var Q=w.getUint16(F);return F+=2,Q}function K(){var Q=w.getUint32(F);return F+=4,Q}function q(Q){Y.setUint16(re,Q),re+=2}function V(Q){Y.setUint32(re,Q),re+=4}for(var P={signature:K(),flavor:K(),length:K(),numTables:j(),reserved:j(),totalSfntSize:K(),majorVersion:j(),minorVersion:j(),metaOffset:K(),metaLength:K(),metaOrigLength:K(),privOffset:K(),privLength:K()},_=0;Math.pow(2,_)<=P.numTables;)_++;_--;for(var B=16*Math.pow(2,_),x=16*P.numTables-B,D=12,I=[],R=0;R<P.numTables;R++)I.push({tag:K(),offset:K(),compLength:K(),origLength:K(),origChecksum:K()}),D+=16;var N,L=new Uint8Array(12+16*I.length+I.reduce((function(Q,J){return Q+J.origLength+4}),0)),O=L.buffer,Y=new DataView(O),re=0;return V(P.flavor),q(P.numTables),q(B),q(_),q(x),I.forEach((function(Q){V(Q.tag),V(Q.origChecksum),V(D),V(Q.origLength),Q.outOffset=D,(D+=Q.origLength)%4!=0&&(D+=4-D%4)})),I.forEach((function(Q){var J,me=y.slice(Q.offset,Q.offset+Q.compLength);if(Q.compLength!=Q.origLength){var he=new Uint8Array(Q.origLength);J=new Uint8Array(me,2),U(J,he)}else he=new Uint8Array(me);L.set(he,Q.outOffset);var ee=0;(D=Q.outOffset+Q.origLength)%4!=0&&(ee=4-D%4),L.set(new Uint8Array(ee).buffer,Q.outOffset+Q.origLength),N=D+ee})),O.slice(0,N)},Object.defineProperty(n,"__esModule",{value:!0}),n})({}).convert_streams}function Lo(n,t){const i={M:2,L:2,Q:4,C:6,Z:0},c={C:"18g,ca,368,1kz",D:"17k,6,2,2+4,5+c,2+6,2+1,10+1,9+f,j+11,2+1,a,2,2+1,15+2,3,j+2,6+3,2+8,2,2,2+1,w+a,4+e,3+3,2,3+2,3+5,23+w,2f+4,3,2+9,2,b,2+3,3,1k+9,6+1,3+1,2+2,2+d,30g,p+y,1,1+1g,f+x,2,sd2+1d,jf3+4,f+3,2+4,2+2,b+3,42,2,4+2,2+1,2,3,t+1,9f+w,2,el+2,2+g,d+2,2l,2+1,5,3+1,2+1,2,3,6,16wm+1v",R:"17m+3,2,2,6+3,m,15+2,2+2,h+h,13,3+8,2,2,3+1,2,p+1,x,5+4,5,a,2,2,3,u,c+2,g+1,5,2+1,4+1,5j,6+1,2,b,2+2,f,2+1,1s+2,2,3+1,7,1ez0,2,2+1,4+4,b,4,3,b,42,2+2,4,3,2+1,2,o+3,ae,ep,x,2o+2,3+1,3,5+1,6",L:"x9u,jff,a,fd,jv",T:"4t,gj+33,7o+4,1+1,7c+18,2,2+1,2+1,2,21+a,2,1b+k,h,2u+6,3+5,3+1,2+3,y,2,v+q,2k+a,1n+8,a,p+3,2+8,2+2,2+4,18+2,3c+e,2+v,1k,2,5+7,5,4+6,b+1,u,1n,5+3,9,l+1,r,3+1,1m,5+1,5+1,3+2,4,v+1,4,c+1,1m,5+4,2+1,5,l+1,n+5,2,1n,3,2+3,9,8+1,c+1,v,1q,d,1f,4,1m+2,6+2,2+3,8+1,c+1,u,1n,3,7,6+1,l+1,t+1,1m+1,5+3,9,l+1,u,21,8+2,2,2j,3+6,d+7,2r,3+8,c+5,23+1,s,2,2,1k+d,2+4,2+1,6+a,2+z,a,2v+3,2+5,2+1,3+1,q+1,5+2,h+3,e,3+1,7,g,jk+2,qb+2,u+2,u+1,v+1,1t+1,2+6,9,3+a,a,1a+2,3c+1,z,3b+2,5+1,a,7+2,64+1,3,1n,2+6,2,2,3+7,7+9,3,1d+d,1,1+1,1s+3,1d,2+4,2,6,15+8,d+1,x+3,3+1,2+2,1l,2+1,4,2+2,1n+7,3+1,49+2,2+c,2+6,5,7,4+1,5j+1l,2+4,ek,3+1,r+4,1e+4,6+5,2p+c,1+3,1,1+2,1+b,2db+2,3y,2p+v,ff+3,30+1,n9x,1+2,2+9,x+1,29+1,7l,4,5,q+1,6,48+1,r+h,e,13+7,q+a,1b+2,1d,3+3,3+1,14,1w+5,3+1,3+1,d,9,1c,1g,2+2,3+1,6+1,2,17+1,9,6n,3,5,fn5,ki+f,h+f,5s,6y+2,ea,6b,46+4,1af+2,2+1,6+3,15+2,5,4m+1,fy+3,as+1,4a+a,4x,1j+e,1l+2,1e+3,3+1,1y+2,11+4,2+7,1r,d+1,1h+8,b+3,3,2o+2,3,2+1,7,4h,4+7,m+1,1m+1,4,12+6,4+4,5g+7,3+2,2,o,2d+5,2,5+1,2+1,6n+3,7+1,2+1,s+1,2e+7,3,2+1,2z,2,3+5,2,2u+2,3+3,2+4,78+8,2+1,75+1,2,5,41+3,3+1,5,x+9,15+5,3+3,9,a+5,3+2,1b+c,2+1,bb+6,2+5,2,2b+l,3+6,2+1,2+1,3f+5,4,2+1,2+6,2,21+1,4,2,9o+1,470+8,at4+4,1o+6,t5,1s+3,2a,f5l+1,2+3,43o+2,a+7,1+7,3+6,v+3,45+2,1j0+1i,5+1d,9,f,n+4,2+e,11t+6,2+g,3+6,2+1,2+4,7a+6,c6+3,15t+6,32+6,1,gzau,v+2n,3l+6n"},r=1,e=2,s=4,o=8,a=16,l=32;let u;function f(M){if(!u){const b={R:e,L:r,D:s,C:a,U:l,T:o};u=new Map;for(let U in c){let S=0;c[U].split(",").forEach(k=>{let[y,w]=k.split("+");y=parseInt(y,36),w=w?parseInt(w,36):0,u.set(S+=y,b[U]);for(let F=w;F--;)u.set(++S,b[U])})}}return u.get(M)||l}const h=1,d=2,p=3,v=4,A=[null,"isol","init","fina","medi"];function E(M){const b=new Uint8Array(M.length);let U=l,S=h,k=-1;for(let y=0;y<M.length;y++){const w=M.codePointAt(y);let F=f(w)|0,j=h;F&o||(U&(r|s|a)?F&(e|s|a)?(j=p,(S===h||S===p)&&b[k]++):F&(r|l)&&(S===d||S===v)&&b[k]--:U&(e|l)&&(S===d||S===v)&&b[k]--,S=b[y]=j,U=F,k=y,w>65535&&y++)}return b}function m(M,b){const U=[];for(let k=0;k<b.length;k++){const y=b.codePointAt(k);y>65535&&k++,U.push(n.U.codeToGlyph(M,y))}const S=M.GSUB;if(S){const{lookupList:k,featureList:y}=S;let w;const F=/^(rlig|liga|mset|isol|init|fina|medi|half|pres|blws|ccmp)$/,j=[];y.forEach(K=>{if(F.test(K.tag))for(let q=0;q<K.tab.length;q++){if(j[K.tab[q]])continue;j[K.tab[q]]=!0;const V=k[K.tab[q]],P=/^(isol|init|fina|medi)$/.test(K.tag);P&&!w&&(w=E(b));for(let _=0;_<U.length;_++)(!w||!P||A[w[_]]===K.tag)&&n.U._applySubs(U,_,V,k)}})}return U}function C(M,b){const U=new Int16Array(b.length*3);let S=0;for(;S<b.length;S++){const F=b[S];if(F===-1)continue;U[S*3+2]=M.hmtx.aWidth[F];const j=M.GPOS;if(j){const K=j.lookupList;for(let q=0;q<K.length;q++){const V=K[q];for(let P=0;P<V.tabs.length;P++){const _=V.tabs[P];if(V.ltype===1){if(n._lctf.coverageIndex(_.coverage,F)!==-1&&_.pos){w(_.pos,S);break}}else if(V.ltype===2){let B=null,x=k();if(x!==-1){const D=n._lctf.coverageIndex(_.coverage,b[x]);if(D!==-1){if(_.fmt===1){const I=_.pairsets[D];for(let R=0;R<I.length;R++)I[R].gid2===F&&(B=I[R])}else if(_.fmt===2){const I=n.U._getGlyphClass(b[x],_.classDef1),R=n.U._getGlyphClass(F,_.classDef2);B=_.matrix[I][R]}if(B){B.val1&&w(B.val1,x),B.val2&&w(B.val2,S);break}}}}else if(V.ltype===4){const B=n._lctf.coverageIndex(_.markCoverage,F);if(B!==-1){const x=k(y),D=x===-1?-1:n._lctf.coverageIndex(_.baseCoverage,b[x]);if(D!==-1){const I=_.markArray[B],R=_.baseArray[D][I.markClass];U[S*3]=R.x-I.x+U[x*3]-U[x*3+2],U[S*3+1]=R.y-I.y+U[x*3+1];break}}}else if(V.ltype===6){const B=n._lctf.coverageIndex(_.mark1Coverage,F);if(B!==-1){const x=k();if(x!==-1){const D=b[x];if(g(M,D)===3){const I=n._lctf.coverageIndex(_.mark2Coverage,D);if(I!==-1){const R=_.mark1Array[B],N=_.mark2Array[I][R.markClass];U[S*3]=N.x-R.x+U[x*3]-U[x*3+2],U[S*3+1]=N.y-R.y+U[x*3+1];break}}}}}}}}else if(M.kern&&!M.cff){const K=k();if(K!==-1){const q=M.kern.glyph1.indexOf(b[K]);if(q!==-1){const V=M.kern.rval[q].glyph2.indexOf(F);V!==-1&&(U[K*3+2]+=M.kern.rval[q].vals[V])}}}}return U;function k(F){for(let j=S-1;j>=0;j--)if(b[j]!==-1&&(!F||F(b[j])))return j;return-1}function y(F){return g(M,F)===1}function w(F,j){for(let K=0;K<3;K++)U[j*3+K]+=F[K]||0}}function g(M,b){const U=M.GDEF&&M.GDEF.glyphClassDef;return U?n.U._getGlyphClass(b,U):0}function T(...M){for(let b=0;b<M.length;b++)if(typeof M[b]=="number")return M[b]}function G(M){const b=Object.create(null),U=M["OS/2"],S=M.hhea,k=M.head.unitsPerEm,y=T(U&&U.sTypoAscender,S&&S.ascender,k),w={unitsPerEm:k,ascender:y,descender:T(U&&U.sTypoDescender,S&&S.descender,0),capHeight:T(U&&U.sCapHeight,y),xHeight:T(U&&U.sxHeight,y),lineGap:T(U&&U.sTypoLineGap,S&&S.lineGap),supportsCodePoint(F){return n.U.codeToGlyph(M,F)>0},forEachGlyph(F,j,K,q){let V=0;const P=1/w.unitsPerEm*j,_=m(M,F);let B=0;const x=C(M,_);return _.forEach((D,I)=>{if(D!==-1){let R=b[D];if(!R){const{cmds:N,crds:L}=n.U.glyphToPath(M,D);let O="",Y=0;for(let he=0,ee=N.length;he<ee;he++){const ne=i[N[he]];O+=N[he];for(let ce=1;ce<=ne;ce++)O+=(ce>1?",":"")+L[Y++]}let re,Q,J,me;if(L.length){re=Q=1/0,J=me=-1/0;for(let he=0,ee=L.length;he<ee;he+=2){let ne=L[he],ce=L[he+1];ne<re&&(re=ne),ce<Q&&(Q=ce),ne>J&&(J=ne),ce>me&&(me=ce)}}else re=J=Q=me=0;R=b[D]={index:D,advanceWidth:M.hmtx.aWidth[D],xMin:re,yMin:Q,xMax:J,yMax:me,path:O}}q.call(null,R,V+x[I*3]*P,x[I*3+1]*P,B),V+=x[I*3+2]*P,K&&(V+=K*j)}B+=F.codePointAt(B)>65535?2:1}),V}};return w}return function(b){const U=new Uint8Array(b,0,4),S=n._bin.readASCII(U,0,4);if(S==="wOFF")b=t(b);else if(S==="wOF2")throw new Error("woff2 fonts not supported");return G(n.parse(b)[0])}}const Po=Wt({name:"Typr Font Parser",dependencies:[wo,_o,Lo],init(n,t,i){const c=n(),r=t();return i(c,r)}});function Ho(){return(function(n){var t=function(){this.buckets=new Map};t.prototype.add=function(C){var g=C>>5;this.buckets.set(g,(this.buckets.get(g)||0)|1<<(31&C))},t.prototype.has=function(C){var g=this.buckets.get(C>>5);return g!==void 0&&(g&1<<(31&C))!=0},t.prototype.serialize=function(){var C=[];return this.buckets.forEach((function(g,T){C.push((+T).toString(36)+":"+g.toString(36))})),C.join(",")},t.prototype.deserialize=function(C){var g=this;this.buckets.clear(),C.split(",").forEach((function(T){var G=T.split(":");g.buckets.set(parseInt(G[0],36),parseInt(G[1],36))}))};var i=Math.pow(2,8),c=i-1,r=~c;function e(C){var g=(function(G){return G&r})(C).toString(16),T=(function(G){return(G&r)+i-1})(C).toString(16);return"codepoint-index/plane"+(C>>16)+"/"+g+"-"+T+".json"}function s(C,g){var T=C&c,G=g.codePointAt(T/6|0);return((G=(G||48)-48)&1<<T%6)!=0}function o(C,g){var T;(T=C,T.replace(/U\+/gi,"").replace(/^,+|,+$/g,"").split(/,+/).map((function(G){return G.split("-").map((function(M){return parseInt(M.trim(),16)}))}))).forEach((function(G){var M=G[0],b=G[1];b===void 0&&(b=M),g(M,b)}))}function a(C,g){o(C,(function(T,G){for(var M=T;M<=G;M++)g(M)}))}var l={},u={},f=new WeakMap,h="https://cdn.jsdelivr.net/gh/lojjic/unicode-font-resolver@v1.0.1/packages/data";function d(C){var g=f.get(C);return g||(g=new t,a(C.ranges,(function(T){return g.add(T)})),f.set(C,g)),g}var p,v=new Map;function A(C,g,T){return C[g]?g:C[T]?T:(function(G){for(var M in G)return M})(C)}function E(C,g){var T=g;if(!C.includes(T)){T=1/0;for(var G=0;G<C.length;G++)Math.abs(C[G]-g)<Math.abs(T-g)&&(T=C[G])}return T}function m(C){return p||(p=new Set,a("9-D,20,85,A0,1680,2000-200A,2028-202F,205F,3000",(function(g){p.add(g)}))),p.has(C)}return n.CodePointSet=t,n.clearCache=function(){l={},u={}},n.getFontsForString=function(C,g){g===void 0&&(g={});var T,G=g.lang;G===void 0&&(G=new RegExp("\\p{Script=Hangul}","u").test(T=C)?"ko":new RegExp("\\p{Script=Hiragana}|\\p{Script=Katakana}","u").test(T)?"ja":"en");var M=g.category;M===void 0&&(M="sans-serif");var b=g.style;b===void 0&&(b="normal");var U=g.weight;U===void 0&&(U=400);var S=(g.dataUrl||h).replace(/\/$/g,""),k=new Map,y=new Uint8Array(C.length),w={},F={},j=new Array(C.length),K=new Map,q=!1;function V(B){var x=v.get(B);return x||(x=fetch(S+"/"+B).then((function(D){if(!D.ok)throw new Error(D.statusText);return D.json().then((function(I){if(!Array.isArray(I)||I[0]!==1)throw new Error("Incorrect schema version; need 1, got "+I[0]);return I[1]}))})).catch((function(D){if(S!==h)return q||(console.error('unicode-font-resolver: Failed loading from dataUrl "'+S+'", trying default CDN. '+D.message),q=!0),S=h,v.delete(B),V(B);throw D})),v.set(B,x)),x}for(var P=function(B){var x=C.codePointAt(B),D=e(x);j[B]=D,l[D]||K.has(D)||K.set(D,V(D).then((function(I){l[D]=I}))),x>65535&&(B++,_=B)},_=0;_<C.length;_++)P(_);return Promise.all(K.values()).then((function(){K.clear();for(var B=function(D){var I=C.codePointAt(D),R=null,N=l[j[D]],L=void 0;for(var O in N){var Y=F[O];if(Y===void 0&&(Y=F[O]=new RegExp(O).test(G||"en")),Y){for(var re in L=O,N[O])if(s(I,N[O][re])){R=re;break}break}}if(!R){e:for(var Q in N)if(Q!==L){for(var J in N[Q])if(s(I,N[Q][J])){R=J;break e}}}R||(console.debug("No font coverage for U+"+I.toString(16)),R="latin"),j[D]=R,u[R]||K.has(R)||K.set(R,V("font-meta/"+R+".json").then((function(me){u[R]=me}))),I>65535&&(D++,x=D)},x=0;x<C.length;x++)B(x);return Promise.all(K.values())})).then((function(){for(var B,x=null,D=0;D<C.length;D++){var I=C.codePointAt(D);if(x&&(m(I)||d(x).has(I)))y[D]=y[D-1];else{x=u[j[D]];var R=w[x.id];if(!R){var N=x.typeforms,L=A(N,M,"sans-serif"),O=A(N[L],b,"normal"),Y=E((B=N[L])===null||B===void 0?void 0:B[O],U);R=w[x.id]=S+"/font-files/"+x.id+"/"+L+"."+O+"."+Y+".woff"}var re=k.get(R);re==null&&(re=k.size,k.set(R,re)),y[D]=re}I>65535&&(D++,y[D]=y[D-1])}return{fontUrls:Array.from(k.keys()),chars:y}}))},Object.defineProperty(n,"__esModule",{value:!0}),n})({})}function Oo(n,t){const i=Object.create(null),c=Object.create(null);function r(s,o){const a=l=>{console.error(`Failure loading font ${s}`,l)};try{const l=new XMLHttpRequest;l.open("get",s,!0),l.responseType="arraybuffer",l.onload=function(){if(l.status>=400)a(new Error(l.statusText));else if(l.status>0)try{const u=n(l.response);u.src=s,o(u)}catch(u){a(u)}},l.onerror=a,l.send()}catch(l){a(l)}}function e(s,o){let a=i[s];a?o(a):c[s]?c[s].push(o):(c[s]=[o],r(s,l=>{l.src=s,i[s]=l,c[s].forEach(u=>u(l)),delete c[s]}))}return function(s,o,{lang:a,fonts:l=[],style:u="normal",weight:f="normal",unicodeFontsURL:h}={}){const d=new Uint8Array(s.length),p=[];s.length||m();const v=new Map,A=[];if(u!=="italic"&&(u="normal"),typeof f!="number"&&(f=f==="bold"?700:400),l&&!Array.isArray(l)&&(l=[l]),l=l.slice().filter(g=>!g.lang||g.lang.test(a)).reverse(),l.length){let M=0;(function b(U=0){for(let S=U,k=s.length;S<k;S++){const y=s.codePointAt(S);if(M===1&&p[d[S-1]].supportsCodePoint(y)||S>0&&/\s/.test(s[S]))d[S]=d[S-1],M===2&&(A[A.length-1][1]=S);else for(let w=d[S],F=l.length;w<=F;w++)if(w===F){const j=M===2?A[A.length-1]:A[A.length]=[S,S];j[1]=S,M=2}else{d[S]=w;const{src:j,unicodeRange:K}=l[w];if(!K||C(y,K)){const q=i[j];if(!q){e(j,()=>{b(S)});return}if(q.supportsCodePoint(y)){let V=v.get(q);typeof V!="number"&&(V=p.length,p.push(q),v.set(q,V)),d[S]=V,M=1;break}}}y>65535&&S+1<k&&(d[S+1]=d[S],S++,M===2&&(A[A.length-1][1]=S))}E()})()}else A.push([0,s.length-1]),E();function E(){if(A.length){const g=A.map(T=>s.substring(T[0],T[1]+1)).join(`
`);t.getFontsForString(g,{lang:a||void 0,style:u,weight:f,dataUrl:h}).then(({fontUrls:T,chars:G})=>{const M=p.length;let b=0;A.forEach(S=>{for(let k=0,y=S[1]-S[0];k<=y;k++)d[S[0]+k]=G[b++]+M;b++});let U=0;T.forEach((S,k)=>{e(S,y=>{p[k+M]=y,++U===T.length&&m()})})})}else m()}function m(){o({chars:d,fonts:p})}function C(g,T){for(let G=0;G<T.length;G++){const[M,b=M]=T[G];if(M<=g&&g<=b)return!0}return!1}}}const ko=Wt({name:"FontResolver",dependencies:[Oo,Po,Ho],init(n,t,i){return n(t,i())}});function No(n,t){const c=/[\u00AD\u034F\u061C\u115F-\u1160\u17B4-\u17B5\u180B-\u180E\u200B-\u200F\u202A-\u202E\u2060-\u206F\u3164\uFE00-\uFE0F\uFEFF\uFFA0\uFFF0-\uFFF8]/,r="[^\\S\\u00A0]",e=new RegExp(`${r}|[\\-\\u007C\\u00AD\\u2010\\u2012-\\u2014\\u2027\\u2056\\u2E17\\u2E40]`);function s({text:p,lang:v,fonts:A,style:E,weight:m,preResolvedFonts:C,unicodeFontsURL:g},T){const G=({chars:M,fonts:b})=>{let U,S;const k=[];for(let y=0;y<M.length;y++)M[y]!==S?(S=M[y],k.push(U={start:y,end:y,fontObj:b[M[y]]})):U.end=y;T(k)};C?G(C):n(p,G,{lang:v,fonts:A,style:E,weight:m,unicodeFontsURL:g})}function o({text:p="",font:v,lang:A,sdfGlyphSize:E=64,fontSize:m=400,fontWeight:C=1,fontStyle:g="normal",letterSpacing:T=0,lineHeight:G="normal",maxWidth:M=1/0,direction:b,textAlign:U="left",textIndent:S=0,whiteSpace:k="normal",overflowWrap:y="normal",anchorX:w=0,anchorY:F=0,metricsOnly:j=!1,unicodeFontsURL:K,preResolvedFonts:q=null,includeCaretPositions:V=!1,chunkedBoundsSize:P=8192,colorRanges:_=null},B){const x=f(),D={fontLoad:0,typesetting:0};p.indexOf("\r")>-1&&(console.info("Typesetter: got text with \\r chars; normalizing to \\n"),p=p.replace(/\r\n/g,`
`).replace(/\r/g,`
`)),m=+m,T=+T,M=+M,G=G||"normal",S=+S,s({text:p,lang:A,style:g,weight:C,fonts:typeof v=="string"?[{src:v}]:v,unicodeFontsURL:K,preResolvedFonts:q},I=>{D.fontLoad=f()-x;const R=isFinite(M);let N=null,L=null,O=null,Y=null,re=null,Q=null,J=null,me=null,he=0,ee=0,ne=k!=="nowrap";const ce=new Map,W=f();let se=S,te=0,H=new h;const pe=[H];I.forEach(ie=>{const{fontObj:oe}=ie,{ascender:fe,descender:Ae,unitsPerEm:Fe,lineGap:Ie,capHeight:ge,xHeight:Be}=oe;let ue=ce.get(oe);if(!ue){const de=m/Fe,xe=G==="normal"?(fe-Ae+Ie)*de:G*m,pt=(xe-(fe-Ae)*de)/2,Se=Math.min(xe,(fe-Ae)*de),Ee=(fe+Ae)/2*de+Se/2;ue={index:ce.size,src:oe.src,fontObj:oe,fontSizeMult:de,unitsPerEm:Fe,ascender:fe*de,descender:Ae*de,capHeight:ge*de,xHeight:Be*de,lineHeight:xe,baseline:-pt-fe*de,caretTop:Ee,caretBottom:Ee-Se},ce.set(oe,ue)}const{fontSizeMult:_e}=ue,De=p.slice(ie.start,ie.end+1);let ze,Re;oe.forEachGlyph(De,m,T,(de,xe,pt,Se)=>{xe+=te,Se+=ie.start,ze=xe,Re=de;const Ee=p.charAt(Se),Le=de.advanceWidth*_e,Ge=H.count;let ve;if("isEmpty"in de||(de.isWhitespace=!!Ee&&new RegExp(r).test(Ee),de.canBreakAfter=!!Ee&&e.test(Ee),de.isEmpty=de.xMin===de.xMax||de.yMin===de.yMax||c.test(Ee)),!de.isWhitespace&&!de.isEmpty&&ee++,ne&&R&&!de.isWhitespace&&xe+Le+se>M&&Ge){if(H.glyphAt(Ge-1).glyphObj.canBreakAfter)ve=new h,se=-xe;else for(let Ke=Ge;Ke--;)if(Ke===0&&y==="break-word"){ve=new h,se=-xe;break}else if(H.glyphAt(Ke).glyphObj.canBreakAfter){ve=H.splitAt(Ke+1);const Oe=ve.glyphAt(0).x;se-=Oe;for(let Pe=ve.count;Pe--;)ve.glyphAt(Pe).x-=Oe;break}ve&&(H.isSoftWrapped=!0,H=ve,pe.push(H),he=M)}let Ue=H.glyphAt(H.count);Ue.glyphObj=de,Ue.x=xe+se,Ue.y=pt,Ue.width=Le,Ue.charIndex=Se,Ue.fontData=ue,Ee===`
`&&(H=new h,pe.push(H),se=-(xe+Le+T*m)+S)}),te=ze+Re.advanceWidth*_e+T*m});let $=0;pe.forEach(ie=>{let oe=!0;for(let fe=ie.count;fe--;){const Ae=ie.glyphAt(fe);oe&&!Ae.glyphObj.isWhitespace&&(ie.width=Ae.x+Ae.width,ie.width>he&&(he=ie.width),oe=!1);let{lineHeight:Fe,capHeight:Ie,xHeight:ge,baseline:Be}=Ae.fontData;Fe>ie.lineHeight&&(ie.lineHeight=Fe);const ue=Be-ie.baseline;ue<0&&(ie.baseline+=ue,ie.cap+=ue,ie.ex+=ue),ie.cap=Math.max(ie.cap,ie.baseline+Ie),ie.ex=Math.max(ie.ex,ie.baseline+ge)}ie.baseline-=$,ie.cap-=$,ie.ex-=$,$+=ie.lineHeight});let ae=0,Z=0;if(w&&(typeof w=="number"?ae=-w:typeof w=="string"&&(ae=-he*(w==="left"?0:w==="center"?.5:w==="right"?1:l(w)))),F&&(typeof F=="number"?Z=-F:typeof F=="string"&&(Z=F==="top"?0:F==="top-baseline"?-pe[0].baseline:F==="top-cap"?-pe[0].cap:F==="top-ex"?-pe[0].ex:F==="middle"?$/2:F==="bottom"?$:F==="bottom-baseline"?-pe[pe.length-1].baseline:l(F)*$)),!j){const ie=t.getEmbeddingLevels(p,b);N=new Uint16Array(ee),L=new Uint8Array(ee),O=new Float32Array(ee*2),Y={},J=[1/0,1/0,-1/0,-1/0],me=[],V&&(Q=new Float32Array(p.length*4)),_&&(re=new Uint8Array(ee*3));let oe=0,fe=-1,Ae=-1,Fe,Ie;if(pe.forEach((ge,Be)=>{let{count:ue,width:_e}=ge;if(ue>0){let De=0;for(let Se=ue;Se--&&ge.glyphAt(Se).glyphObj.isWhitespace;)De++;let ze=0,Re=0;if(U==="center")ze=(he-_e)/2;else if(U==="right")ze=he-_e;else if(U==="justify"&&ge.isSoftWrapped){let Se=0;for(let Ee=ue-De;Ee--;)ge.glyphAt(Ee).glyphObj.isWhitespace&&Se++;Re=(he-_e)/Se}if(Re||ze){let Se=0;for(let Ee=0;Ee<ue;Ee++){let Le=ge.glyphAt(Ee);const Ge=Le.glyphObj;Le.x+=ze+Se,Re!==0&&Ge.isWhitespace&&Ee<ue-De&&(Se+=Re,Le.width+=Re)}}const de=t.getReorderSegments(p,ie,ge.glyphAt(0).charIndex,ge.glyphAt(ge.count-1).charIndex);for(let Se=0;Se<de.length;Se++){const[Ee,Le]=de[Se];let Ge=1/0,ve=-1/0;for(let Ue=0;Ue<ue;Ue++)if(ge.glyphAt(Ue).charIndex>=Ee){let Ke=Ue,Oe=Ue;for(;Oe<ue;Oe++){let Pe=ge.glyphAt(Oe);if(Pe.charIndex>Le)break;Oe<ue-De&&(Ge=Math.min(Ge,Pe.x),ve=Math.max(ve,Pe.x+Pe.width))}for(let Pe=Ke;Pe<Oe;Pe++){const $e=ge.glyphAt(Pe);$e.x=ve-($e.x+$e.width-Ge)}break}}let xe;const pt=Se=>xe=Se;for(let Se=0;Se<ue;Se++){const Ee=ge.glyphAt(Se);xe=Ee.glyphObj;const Le=xe.index,Ge=ie.levels[Ee.charIndex]&1;if(Ge){const ve=t.getMirroredCharacter(p[Ee.charIndex]);ve&&Ee.fontData.fontObj.forEachGlyph(ve,0,0,pt)}if(V){const{charIndex:ve,fontData:Ue}=Ee,Ke=Ee.x+ae,Oe=Ee.x+Ee.width+ae;Q[ve*4]=Ge?Oe:Ke,Q[ve*4+1]=Ge?Ke:Oe,Q[ve*4+2]=ge.baseline+Ue.caretBottom+Z,Q[ve*4+3]=ge.baseline+Ue.caretTop+Z;const Pe=ve-fe;Pe>1&&u(Q,fe,Pe),fe=ve}if(_){const{charIndex:ve}=Ee;for(;ve>Ae;)Ae++,_.hasOwnProperty(Ae)&&(Ie=_[Ae])}if(!xe.isWhitespace&&!xe.isEmpty){const ve=oe++,{fontSizeMult:Ue,src:Ke,index:Oe}=Ee.fontData,Pe=Y[Ke]||(Y[Ke]={});Pe[Le]||(Pe[Le]={path:xe.path,pathBounds:[xe.xMin,xe.yMin,xe.xMax,xe.yMax]});const $e=Ee.x+ae,At=Ee.y+ge.baseline+Z;O[ve*2]=$e,O[ve*2+1]=At;const ct=$e+xe.xMin*Ue,vt=At+xe.yMin*Ue,Tt=$e+xe.xMax*Ue,ut=At+xe.yMax*Ue;ct<J[0]&&(J[0]=ct),vt<J[1]&&(J[1]=vt),Tt>J[2]&&(J[2]=Tt),ut>J[3]&&(J[3]=ut),ve%P===0&&(Fe={start:ve,end:ve,rect:[1/0,1/0,-1/0,-1/0]},me.push(Fe)),Fe.end++;const je=Fe.rect;if(ct<je[0]&&(je[0]=ct),vt<je[1]&&(je[1]=vt),Tt>je[2]&&(je[2]=Tt),ut>je[3]&&(je[3]=ut),N[ve]=Le,L[ve]=Oe,_){const Mt=ve*3;re[Mt]=Ie>>16&255,re[Mt+1]=Ie>>8&255,re[Mt+2]=Ie&255}}}}}),Q){const ge=p.length-fe;ge>1&&u(Q,fe,ge)}}const Me=[];ce.forEach(({index:ie,src:oe,unitsPerEm:fe,ascender:Ae,descender:Fe,lineHeight:Ie,capHeight:ge,xHeight:Be})=>{Me[ie]={src:oe,unitsPerEm:fe,ascender:Ae,descender:Fe,lineHeight:Ie,capHeight:ge,xHeight:Be}}),D.typesetting=f()-W,B({glyphIds:N,glyphFontIndices:L,glyphPositions:O,glyphData:Y,fontData:Me,caretPositions:Q,glyphColors:re,chunkedBounds:me,fontSize:m,topBaseline:Z+pe[0].baseline,blockBounds:[ae,Z-$,ae+he,Z],visibleBounds:J,timings:D})})}function a(p,v){o({...p,metricsOnly:!0},A=>{const[E,m,C,g]=A.blockBounds;v({width:C-E,height:g-m})})}function l(p){let v=p.match(/^([\d.]+)%$/),A=v?parseFloat(v[1]):NaN;return isNaN(A)?0:A/100}function u(p,v,A){const E=p[v*4],m=p[v*4+1],C=p[v*4+2],g=p[v*4+3],T=(m-E)/A;for(let G=0;G<A;G++){const M=(v+G)*4;p[M]=E+T*G,p[M+1]=E+T*(G+1),p[M+2]=C,p[M+3]=g}}function f(){return(self.performance||Date).now()}function h(){this.data=[]}const d=["glyphObj","x","y","width","charIndex","fontData"];return h.prototype={width:0,lineHeight:0,baseline:0,cap:0,ex:0,isSoftWrapped:!1,get count(){return Math.ceil(this.data.length/d.length)},glyphAt(p){let v=h.flyweight;return v.data=this.data,v.index=p,v},splitAt(p){let v=new h;return v.data=this.data.splice(p*d.length),v}},h.flyweight=d.reduce((p,v,A,E)=>(Object.defineProperty(p,v,{get(){return this.data[this.index*d.length+A]},set(m){this.data[this.index*d.length+A]=m}}),p),{data:null,index:0}),{typeset:o,measure:a}}const Gt=()=>(self.performance||Date).now(),zr=gi();let Rs;function Jo(n,t,i,c,r,e,s,o,a,l,u=!0){return u?jo(n,t,i,c,r,e,s,o,a,l).then(null,f=>(Rs||(console.warn("WebGL SDF generation failed, falling back to JS",f),Rs=!0),Gs(n,t,i,c,r,e,s,o,a,l))):Gs(n,t,i,c,r,e,s,o,a,l)}const Lr=[],Ko=5;let wn=0;function Ci(){const n=Gt();for(;Lr.length&&Gt()-n<Ko;)Lr.shift()();wn=Lr.length?setTimeout(Ci,0):0}const jo=(...n)=>new Promise((t,i)=>{Lr.push(()=>{const c=Gt();try{zr.webgl.generateIntoCanvas(...n),t({timing:Gt()-c})}catch(r){i(r)}}),wn||(wn=setTimeout(Ci,0))}),zo=4,Wo=2e3,Ds={};let Qo=0;function Gs(n,t,i,c,r,e,s,o,a,l){const u="TroikaTextSDFGenerator_JS_"+Qo++%zo;let f=Ds[u];return f||(f=Ds[u]={workerModule:Wt({name:u,workerId:u,dependencies:[gi,Gt],init(h,d){const p=h().javascript.generate;return function(...v){const A=d();return{textureData:p(...v),timing:d()-A}}},getTransferables(h){return[h.textureData.buffer]}}),requests:0,idleTimer:null}),f.requests++,clearTimeout(f.idleTimer),f.workerModule(n,t,i,c,r,e).then(({textureData:h,timing:d})=>{const p=Gt(),v=new Uint8Array(h.length*4);for(let A=0;A<h.length;A++)v[A*4+l]=h[A];return zr.webglUtils.renderImageData(s,v,o,a,n,t,1<<3-l),d+=Gt()-p,--f.requests===0&&(f.idleTimer=setTimeout(()=>{To(u)},Wo)),{timing:d}})}function Xo(n){n._warm||(zr.webgl.isSupported(n),n._warm=!0)}const Vo=zr.webglUtils.resizeWebGLCanvasWithoutClearing,or={unicodeFontsURL:null,sdfGlyphSize:64,sdfMargin:1/16,sdfExponent:9,textureWidth:2048},Yo=new Ye;function kt(){return(self.performance||Date).now()}const Us=Object.create(null);function Ei(n,t){n=$o({},n);const i=kt(),c=[];if(n.font&&c.push({label:"user",src:el(n.font)}),n.font=c,n.text=""+n.text,n.sdfGlyphSize=n.sdfGlyphSize||or.sdfGlyphSize,n.unicodeFontsURL=n.unicodeFontsURL||or.unicodeFontsURL,n.colorRanges!=null){let h={};for(let d in n.colorRanges)if(n.colorRanges.hasOwnProperty(d)){let p=n.colorRanges[d];typeof p!="number"&&(p=Yo.set(p).getHex()),h[d]=p}n.colorRanges=h}Object.freeze(n);const{textureWidth:r,sdfExponent:e}=or,{sdfGlyphSize:s}=n,o=r/s*4;let a=Us[s];if(!a){const h=document.createElement("canvas");h.width=r,h.height=s*256/o,a=Us[s]={glyphCount:0,sdfGlyphSize:s,sdfCanvas:h,sdfTexture:new It(h,void 0,void 0,void 0,ot,ot),contextLost:!1,glyphsByFont:new Map},a.sdfTexture.generateMipmaps=!1,Zo(a)}const{sdfTexture:l,sdfCanvas:u}=a;Ti(n).then(h=>{const{glyphIds:d,glyphFontIndices:p,fontData:v,glyphPositions:A,fontSize:E,timings:m}=h,C=[],g=new Float32Array(d.length*4);let T=0,G=0;const M=kt(),b=v.map(w=>{let F=a.glyphsByFont.get(w.src);return F||a.glyphsByFont.set(w.src,F=new Map),F});d.forEach((w,F)=>{const j=p[F],{src:K,unitsPerEm:q}=v[j];let V=b[j].get(w);if(!V){const{path:D,pathBounds:I}=h.glyphData[K][w],R=Math.max(I[2]-I[0],I[3]-I[1])/s*(or.sdfMargin*s+.5),N=a.glyphCount++,L=[I[0]-R,I[1]-R,I[2]+R,I[3]+R];b[j].set(w,V={path:D,atlasIndex:N,sdfViewBox:L}),C.push(V)}const{sdfViewBox:P}=V,_=A[G++],B=A[G++],x=E/q;g[T++]=_+P[0]*x,g[T++]=B+P[1]*x,g[T++]=_+P[2]*x,g[T++]=B+P[3]*x,d[F]=V.atlasIndex}),m.quads=(m.quads||0)+(kt()-M);const U=kt();m.sdf={};const S=u.height,k=Math.ceil(a.glyphCount/o),y=Math.pow(2,Math.ceil(Math.log2(k*s)));y>S&&(console.info(`Increasing SDF texture size ${S}->${y}`),Vo(u,r,y),l.dispose()),Promise.all(C.map(w=>yi(w,a,n.gpuAccelerateSDF).then(({timing:F})=>{m.sdf[w.atlasIndex]=F}))).then(()=>{C.length&&!a.contextLost&&(bi(a),l.needsUpdate=!0),m.sdfTotal=kt()-U,m.total=kt()-i,t(Object.freeze({parameters:n,sdfTexture:l,sdfGlyphSize:s,sdfExponent:e,glyphBounds:g,glyphAtlasIndices:d,glyphColors:h.glyphColors,caretPositions:h.caretPositions,chunkedBounds:h.chunkedBounds,ascender:h.ascender,descender:h.descender,lineHeight:h.lineHeight,capHeight:h.capHeight,xHeight:h.xHeight,topBaseline:h.topBaseline,blockBounds:h.blockBounds,visibleBounds:h.visibleBounds,timings:h.timings}))})}),Promise.resolve().then(()=>{a.contextLost||Xo(u)})}function yi({path:n,atlasIndex:t,sdfViewBox:i},{sdfGlyphSize:c,sdfCanvas:r,contextLost:e},s){if(e)return Promise.resolve({timing:-1});const{textureWidth:o,sdfExponent:a}=or,l=Math.max(i[2]-i[0],i[3]-i[1]),u=Math.floor(t/4),f=u%(o/c)*c,h=Math.floor(u/(o/c))*c,d=t%4;return Jo(c,c,n,i,l,a,r,f,h,d,s)}function Zo(n){const t=n.sdfCanvas;t.addEventListener("webglcontextlost",i=>{console.log("Context Lost",i),i.preventDefault(),n.contextLost=!0}),t.addEventListener("webglcontextrestored",i=>{console.log("Context Restored",i),n.contextLost=!1;const c=[];n.glyphsByFont.forEach(r=>{r.forEach(e=>{c.push(yi(e,n,!0))})}),Promise.all(c).then(()=>{bi(n),n.sdfTexture.needsUpdate=!0})})}function qo({font:n,characters:t,sdfGlyphSize:i},c){let r=Array.isArray(t)?t.join(`
`):""+t;Ei({font:n,sdfGlyphSize:i,text:r},c)}function $o(n,t){for(let i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);return n}let Gr;function el(n){return Gr||(Gr=typeof document>"u"?{}:document.createElement("a")),Gr.href=n,Gr.href}function bi(n){if(typeof createImageBitmap!="function"){console.info("Safari<15: applying SDF canvas workaround");const{sdfCanvas:t,sdfTexture:i}=n,{width:c,height:r}=t,e=n.sdfCanvas.getContext("webgl");let s=i.image.data;(!s||s.length!==c*r*4)&&(s=new Uint8Array(c*r*4),i.image={width:c,height:r,data:s},i.flipY=!1,i.isDataTexture=!0),e.readPixels(0,0,c,r,e.RGBA,e.UNSIGNED_BYTE,s)}}const tl=Wt({name:"Typesetter",dependencies:[No,ko,xo],init(n,t,i){return n(t,i())}}),Ti=Wt({name:"Typesetter",dependencies:[tl],init(n){return function(t){return new Promise(i=>{n.typeset(t,i)})}},getTransferables(n){const t=[];for(let i in n)n[i]&&n[i].buffer&&t.push(n[i].buffer);return t}});Ti.onMainThread;const Is={};function rl(n){let t=Is[n];return t||(t=Is[n]=new Nn(1,1,n,n).translate(.5,.5,0)),t}const nl="aTroikaGlyphBounds",ws="aTroikaGlyphIndex",sl="aTroikaGlyphColor";class il extends Ea{constructor(){super(),this.detail=1,this.curveRadius=0,this.groups=[{start:0,count:1/0,materialIndex:0},{start:0,count:1/0,materialIndex:1}],this.boundingSphere=new ii,this.boundingBox=new kn}computeBoundingSphere(){}computeBoundingBox(){}set detail(t){if(t!==this._detail){this._detail=t,(typeof t!="number"||t<1)&&(t=1);let i=rl(t);["position","normal","uv"].forEach(c=>{this.attributes[c]=i.attributes[c].clone()}),this.setIndex(i.getIndex().clone())}}get detail(){return this._detail}set curveRadius(t){t!==this._curveRadius&&(this._curveRadius=t,this._updateBounds())}get curveRadius(){return this._curveRadius}updateGlyphs(t,i,c,r,e){this.updateAttributeData(nl,t,4),this.updateAttributeData(ws,i,1),this.updateAttributeData(sl,e,3),this._blockBounds=c,this._chunkedBounds=r,this.instanceCount=i.length,this._updateBounds()}_updateBounds(){const t=this._blockBounds;if(t){const{curveRadius:i,boundingBox:c}=this;if(i){const{PI:r,floor:e,min:s,max:o,sin:a,cos:l}=Math,u=r/2,f=r*2,h=Math.abs(i),d=t[0]/h,p=t[2]/h,v=e((d+u)/f)!==e((p+u)/f)?-h:s(a(d)*h,a(p)*h),A=e((d-u)/f)!==e((p-u)/f)?h:o(a(d)*h,a(p)*h),E=e((d+r)/f)!==e((p+r)/f)?h*2:o(h-l(d)*h,h-l(p)*h);c.min.set(v,t[1],i<0?-E:0),c.max.set(A,t[3],i<0?0:E)}else c.min.set(t[0],t[1],0),c.max.set(t[2],t[3],0);c.getBoundingSphere(this.boundingSphere)}}applyClipRect(t){let i=this.getAttribute(ws).count,c=this._chunkedBounds;if(c)for(let r=c.length;r--;){i=c[r].end;let e=c[r].rect;if(e[1]<t.w&&e[3]>t.y&&e[0]<t.z&&e[2]>t.x)break}this.instanceCount=i}updateAttributeData(t,i,c){const r=this.getAttribute(t);i?r&&r.array.length===i.length?(r.array.set(i),r.needsUpdate=!0):(this.setAttribute(t,new qs(i,c)),delete this._maxInstanceCount,this.dispose()):r&&this.deleteAttribute(t)}}const al=`
uniform vec2 uTroikaSDFTextureSize;
uniform float uTroikaSDFGlyphSize;
uniform vec4 uTroikaTotalBounds;
uniform vec4 uTroikaClipRect;
uniform mat3 uTroikaOrient;
uniform bool uTroikaUseGlyphColors;
uniform float uTroikaEdgeOffset;
uniform float uTroikaBlurRadius;
uniform vec2 uTroikaPositionOffset;
uniform float uTroikaCurveRadius;
attribute vec4 aTroikaGlyphBounds;
attribute float aTroikaGlyphIndex;
attribute vec3 aTroikaGlyphColor;
varying vec2 vTroikaGlyphUV;
varying vec4 vTroikaTextureUVBounds;
varying float vTroikaTextureChannel;
varying vec3 vTroikaGlyphColor;
varying vec2 vTroikaGlyphDimensions;
`,ol=`
vec4 bounds = aTroikaGlyphBounds;
bounds.xz += uTroikaPositionOffset.x;
bounds.yw -= uTroikaPositionOffset.y;

vec4 outlineBounds = vec4(
  bounds.xy - uTroikaEdgeOffset - uTroikaBlurRadius,
  bounds.zw + uTroikaEdgeOffset + uTroikaBlurRadius
);
vec4 clippedBounds = vec4(
  clamp(outlineBounds.xy, uTroikaClipRect.xy, uTroikaClipRect.zw),
  clamp(outlineBounds.zw, uTroikaClipRect.xy, uTroikaClipRect.zw)
);

vec2 clippedXY = (mix(clippedBounds.xy, clippedBounds.zw, position.xy) - bounds.xy) / (bounds.zw - bounds.xy);

position.xy = mix(bounds.xy, bounds.zw, clippedXY);

uv = (position.xy - uTroikaTotalBounds.xy) / (uTroikaTotalBounds.zw - uTroikaTotalBounds.xy);

float rad = uTroikaCurveRadius;
if (rad != 0.0) {
  float angle = position.x / rad;
  position.xz = vec2(sin(angle) * rad, rad - cos(angle) * rad);
  normal.xz = vec2(sin(angle), cos(angle));
}
  
position = uTroikaOrient * position;
normal = uTroikaOrient * normal;

vTroikaGlyphUV = clippedXY.xy;
vTroikaGlyphDimensions = vec2(bounds[2] - bounds[0], bounds[3] - bounds[1]);


float txCols = uTroikaSDFTextureSize.x / uTroikaSDFGlyphSize;
vec2 txUvPerSquare = uTroikaSDFGlyphSize / uTroikaSDFTextureSize;
vec2 txStartUV = txUvPerSquare * vec2(
  mod(floor(aTroikaGlyphIndex / 4.0), txCols),
  floor(floor(aTroikaGlyphIndex / 4.0) / txCols)
);
vTroikaTextureUVBounds = vec4(txStartUV, vec2(txStartUV) + txUvPerSquare);
vTroikaTextureChannel = mod(aTroikaGlyphIndex, 4.0);
`,ll=`
uniform sampler2D uTroikaSDFTexture;
uniform vec2 uTroikaSDFTextureSize;
uniform float uTroikaSDFGlyphSize;
uniform float uTroikaSDFExponent;
uniform float uTroikaEdgeOffset;
uniform float uTroikaFillOpacity;
uniform float uTroikaBlurRadius;
uniform vec3 uTroikaStrokeColor;
uniform float uTroikaStrokeWidth;
uniform float uTroikaStrokeOpacity;
uniform bool uTroikaSDFDebug;
varying vec2 vTroikaGlyphUV;
varying vec4 vTroikaTextureUVBounds;
varying float vTroikaTextureChannel;
varying vec2 vTroikaGlyphDimensions;

float troikaSdfValueToSignedDistance(float alpha) {
  // Inverse of exponential encoding in webgl-sdf-generator
  
  float maxDimension = max(vTroikaGlyphDimensions.x, vTroikaGlyphDimensions.y);
  float absDist = (1.0 - pow(2.0 * (alpha > 0.5 ? 1.0 - alpha : alpha), 1.0 / uTroikaSDFExponent)) * maxDimension;
  float signedDist = absDist * (alpha > 0.5 ? -1.0 : 1.0);
  return signedDist;
}

float troikaGlyphUvToSdfValue(vec2 glyphUV) {
  vec2 textureUV = mix(vTroikaTextureUVBounds.xy, vTroikaTextureUVBounds.zw, glyphUV);
  vec4 rgba = texture2D(uTroikaSDFTexture, textureUV);
  float ch = floor(vTroikaTextureChannel + 0.5); //NOTE: can't use round() in WebGL1
  return ch == 0.0 ? rgba.r : ch == 1.0 ? rgba.g : ch == 2.0 ? rgba.b : rgba.a;
}

float troikaGlyphUvToDistance(vec2 uv) {
  return troikaSdfValueToSignedDistance(troikaGlyphUvToSdfValue(uv));
}

float troikaGetAADist() {
  
  #if defined(GL_OES_standard_derivatives) || __VERSION__ >= 300
  return length(fwidth(vTroikaGlyphUV * vTroikaGlyphDimensions)) * 0.5;
  #else
  return vTroikaGlyphDimensions.x / 64.0;
  #endif
}

float troikaGetFragDistValue() {
  vec2 clampedGlyphUV = clamp(vTroikaGlyphUV, 0.5 / uTroikaSDFGlyphSize, 1.0 - 0.5 / uTroikaSDFGlyphSize);
  float distance = troikaGlyphUvToDistance(clampedGlyphUV);
 
  // Extrapolate distance when outside bounds:
  distance += clampedGlyphUV == vTroikaGlyphUV ? 0.0 : 
    length((vTroikaGlyphUV - clampedGlyphUV) * vTroikaGlyphDimensions);

  

  return distance;
}

float troikaGetEdgeAlpha(float distance, float distanceOffset, float aaDist) {
  #if defined(IS_DEPTH_MATERIAL) || defined(IS_DISTANCE_MATERIAL)
  float alpha = step(-distanceOffset, -distance);
  #else

  float alpha = smoothstep(
    distanceOffset + aaDist,
    distanceOffset - aaDist,
    distance
  );
  #endif

  return alpha;
}
`,cl=`
float aaDist = troikaGetAADist();
float fragDistance = troikaGetFragDistValue();
float edgeAlpha = uTroikaSDFDebug ?
  troikaGlyphUvToSdfValue(vTroikaGlyphUV) :
  troikaGetEdgeAlpha(fragDistance, uTroikaEdgeOffset, max(aaDist, uTroikaBlurRadius));

#if !defined(IS_DEPTH_MATERIAL) && !defined(IS_DISTANCE_MATERIAL)
vec4 fillRGBA = gl_FragColor;
fillRGBA.a *= uTroikaFillOpacity;
vec4 strokeRGBA = uTroikaStrokeWidth == 0.0 ? fillRGBA : vec4(uTroikaStrokeColor, uTroikaStrokeOpacity);
if (fillRGBA.a == 0.0) fillRGBA.rgb = strokeRGBA.rgb;
gl_FragColor = mix(fillRGBA, strokeRGBA, smoothstep(
  -uTroikaStrokeWidth - aaDist,
  -uTroikaStrokeWidth + aaDist,
  fragDistance
));
gl_FragColor.a *= edgeAlpha;
#endif

if (edgeAlpha == 0.0) {
  discard;
}
`;function ul(n){const t=In(n,{chained:!0,extensions:{derivatives:!0},uniforms:{uTroikaSDFTexture:{value:null},uTroikaSDFTextureSize:{value:new we},uTroikaSDFGlyphSize:{value:0},uTroikaSDFExponent:{value:0},uTroikaTotalBounds:{value:new Or(0,0,0,0)},uTroikaClipRect:{value:new Or(0,0,0,0)},uTroikaEdgeOffset:{value:0},uTroikaFillOpacity:{value:1},uTroikaPositionOffset:{value:new we},uTroikaCurveRadius:{value:0},uTroikaBlurRadius:{value:0},uTroikaStrokeWidth:{value:0},uTroikaStrokeColor:{value:new Ye},uTroikaStrokeOpacity:{value:1},uTroikaOrient:{value:new ya},uTroikaUseGlyphColors:{value:!0},uTroikaSDFDebug:{value:!1}},vertexDefs:al,vertexTransform:ol,fragmentDefs:ll,fragmentColorTransform:cl,customRewriter({vertexShader:i,fragmentShader:c}){let r=/\buniform\s+vec3\s+diffuse\b/;return r.test(c)&&(c=c.replace(r,"varying vec3 vTroikaGlyphColor").replace(/\bdiffuse\b/g,"vTroikaGlyphColor"),r.test(i)||(i=i.replace(Bi,`uniform vec3 diffuse;
$&
vTroikaGlyphColor = uTroikaUseGlyphColors ? aTroikaGlyphColor / 255.0 : diffuse;
`))),{vertexShader:i,fragmentShader:c}}});return t.transparent=!0,t.forceSinglePass=!0,Object.defineProperties(t,{isTroikaTextMaterial:{value:!0},shadowSide:{get(){return this.side},set(){}}}),t}const jn=new Nt({color:16777215,side:Ft,transparent:!0}),_s=8421504,Ls=new Et,Ur=new Ne,Cn=new Ne,sr=[],fl=new Ne,En="+x+y";function Ps(n){return Array.isArray(n)?n[0]:n}let Mi=()=>{const n=new Ar(new Nn(1,1),jn);return Mi=()=>n,n},xi=()=>{const n=new Ar(new Nn(1,1,32,1),jn);return xi=()=>n,n};const hl={type:"syncstart"},dl={type:"synccomplete"},Si=["font","fontSize","fontStyle","fontWeight","lang","letterSpacing","lineHeight","maxWidth","overflowWrap","text","direction","textAlign","textIndent","whiteSpace","anchorX","anchorY","colorRanges","sdfGlyphSize"],pl=Si.concat("material","color","depthOffset","clipRect","curveRadius","orientation","glyphGeometryDetail");let Fi=class extends Ar{constructor(){const t=new il;super(t,null),this.text="",this.anchorX=0,this.anchorY=0,this.curveRadius=0,this.direction="auto",this.font=null,this.unicodeFontsURL=null,this.fontSize=.1,this.fontWeight="normal",this.fontStyle="normal",this.lang=null,this.letterSpacing=0,this.lineHeight="normal",this.maxWidth=1/0,this.overflowWrap="normal",this.textAlign="left",this.textIndent=0,this.whiteSpace="normal",this.material=null,this.color=null,this.colorRanges=null,this.outlineWidth=0,this.outlineColor=0,this.outlineOpacity=1,this.outlineBlur=0,this.outlineOffsetX=0,this.outlineOffsetY=0,this.strokeWidth=0,this.strokeColor=_s,this.strokeOpacity=1,this.fillOpacity=1,this.depthOffset=0,this.clipRect=null,this.orientation=En,this.glyphGeometryDetail=1,this.sdfGlyphSize=null,this.gpuAccelerateSDF=!0,this.debugSDF=!1}sync(t){this._needsSync&&(this._needsSync=!1,this._isSyncing?(this._queuedSyncs||(this._queuedSyncs=[])).push(t):(this._isSyncing=!0,this.dispatchEvent(hl),Ei({text:this.text,font:this.font,lang:this.lang,fontSize:this.fontSize||.1,fontWeight:this.fontWeight||"normal",fontStyle:this.fontStyle||"normal",letterSpacing:this.letterSpacing||0,lineHeight:this.lineHeight||"normal",maxWidth:this.maxWidth,direction:this.direction||"auto",textAlign:this.textAlign,textIndent:this.textIndent,whiteSpace:this.whiteSpace,overflowWrap:this.overflowWrap,anchorX:this.anchorX,anchorY:this.anchorY,colorRanges:this.colorRanges,includeCaretPositions:!0,sdfGlyphSize:this.sdfGlyphSize,gpuAccelerateSDF:this.gpuAccelerateSDF,unicodeFontsURL:this.unicodeFontsURL},i=>{this._isSyncing=!1,this._textRenderInfo=i,this.geometry.updateGlyphs(i.glyphBounds,i.glyphAtlasIndices,i.blockBounds,i.chunkedBounds,i.glyphColors);const c=this._queuedSyncs;c&&(this._queuedSyncs=null,this._needsSync=!0,this.sync(()=>{c.forEach(r=>r&&r())})),this.dispatchEvent(dl),t&&t()})))}onBeforeRender(t,i,c,r,e,s){this.sync(),e.isTroikaTextMaterial&&this._prepareForRender(e)}dispose(){this.geometry.dispose()}get textRenderInfo(){return this._textRenderInfo||null}createDerivedMaterial(t){return ul(t)}get material(){let t=this._derivedMaterial;const i=this._baseMaterial||this._defaultMaterial||(this._defaultMaterial=jn.clone());if((!t||!t.isDerivedFrom(i))&&(t=this._derivedMaterial=this.createDerivedMaterial(i),i.addEventListener("dispose",function c(){i.removeEventListener("dispose",c),t.dispose()})),this.hasOutline()){let c=t._outlineMtl;return c||(c=t._outlineMtl=Object.create(t,{id:{value:t.id+.1}}),c.isTextOutlineMaterial=!0,c.depthWrite=!1,c.map=null,t.addEventListener("dispose",function r(){t.removeEventListener("dispose",r),c.dispose()})),[c,t]}else return t}set material(t){t&&t.isTroikaTextMaterial?(this._derivedMaterial=t,this._baseMaterial=t.baseMaterial):this._baseMaterial=t}hasOutline(){return!!(this.outlineWidth||this.outlineBlur||this.outlineOffsetX||this.outlineOffsetY)}get glyphGeometryDetail(){return this.geometry.detail}set glyphGeometryDetail(t){this.geometry.detail=t}get curveRadius(){return this.geometry.curveRadius}set curveRadius(t){this.geometry.curveRadius=t}get customDepthMaterial(){return Ps(this.material).getDepthMaterial()}set customDepthMaterial(t){}get customDistanceMaterial(){return Ps(this.material).getDistanceMaterial()}set customDistanceMaterial(t){}_prepareForRender(t){const i=t.isTextOutlineMaterial,c=t.uniforms,r=this.textRenderInfo;if(r){const{sdfTexture:o,blockBounds:a}=r;c.uTroikaSDFTexture.value=o,c.uTroikaSDFTextureSize.value.set(o.image.width,o.image.height),c.uTroikaSDFGlyphSize.value=r.sdfGlyphSize,c.uTroikaSDFExponent.value=r.sdfExponent,c.uTroikaTotalBounds.value.fromArray(a),c.uTroikaUseGlyphColors.value=!i&&!!r.glyphColors;let l=0,u=0,f=0,h,d,p,v=0,A=0;if(i){let{outlineWidth:m,outlineOffsetX:C,outlineOffsetY:g,outlineBlur:T,outlineOpacity:G}=this;l=this._parsePercent(m)||0,u=Math.max(0,this._parsePercent(T)||0),h=G,v=this._parsePercent(C)||0,A=this._parsePercent(g)||0}else f=Math.max(0,this._parsePercent(this.strokeWidth)||0),f&&(p=this.strokeColor,c.uTroikaStrokeColor.value.set(p??_s),d=this.strokeOpacity,d==null&&(d=1)),h=this.fillOpacity;c.uTroikaEdgeOffset.value=l,c.uTroikaPositionOffset.value.set(v,A),c.uTroikaBlurRadius.value=u,c.uTroikaStrokeWidth.value=f,c.uTroikaStrokeOpacity.value=d,c.uTroikaFillOpacity.value=h??1,c.uTroikaCurveRadius.value=this.curveRadius||0;let E=this.clipRect;if(E&&Array.isArray(E)&&E.length===4)c.uTroikaClipRect.value.fromArray(E);else{const m=(this.fontSize||.1)*100;c.uTroikaClipRect.value.set(a[0]-m,a[1]-m,a[2]+m,a[3]+m)}this.geometry.applyClipRect(c.uTroikaClipRect.value)}c.uTroikaSDFDebug.value=!!this.debugSDF,t.polygonOffset=!!this.depthOffset,t.polygonOffsetFactor=t.polygonOffsetUnits=this.depthOffset||0;const e=i?this.outlineColor||0:this.color;if(e==null)delete t.color;else{const o=t.hasOwnProperty("color")?t.color:t.color=new Ye;(e!==o._input||typeof e=="object")&&o.set(o._input=e)}let s=this.orientation||En;if(s!==t._orientation){let o=c.uTroikaOrient.value;s=s.replace(/[^-+xyz]/g,"");let a=s!==En&&s.match(/^([-+])([xyz])([-+])([xyz])$/);if(a){let[,l,u,f,h]=a;Ur.set(0,0,0)[u]=l==="-"?1:-1,Cn.set(0,0,0)[h]=f==="-"?-1:1,Ls.lookAt(fl,Ur.cross(Cn),Cn),o.setFromMatrix4(Ls)}else o.identity();t._orientation=s}}_parsePercent(t){if(typeof t=="string"){let i=t.match(/^(-?[\d.]+)%$/),c=i?parseFloat(i[1]):NaN;t=(isNaN(c)?0:c/100)*this.fontSize}return t}localPositionToTextCoords(t,i=new we){i.copy(t);const c=this.curveRadius;return c&&(i.x=Math.atan2(t.x,Math.abs(c)-Math.abs(t.z))*Math.abs(c)),i}worldPositionToTextCoords(t,i=new we){return Ur.copy(t),this.localPositionToTextCoords(this.worldToLocal(Ur),i)}raycast(t,i){const{textRenderInfo:c,curveRadius:r}=this;if(c){const e=c.blockBounds,s=r?xi():Mi(),o=s.geometry,{position:a,uv:l}=o.attributes;for(let u=0;u<l.count;u++){let f=e[0]+l.getX(u)*(e[2]-e[0]);const h=e[1]+l.getY(u)*(e[3]-e[1]);let d=0;r&&(d=r-Math.cos(f/r)*r,f=Math.sin(f/r)*r),a.setXYZ(u,f,h,d)}o.boundingSphere=this.geometry.boundingSphere,o.boundingBox=this.geometry.boundingBox,s.matrixWorld=this.matrixWorld,s.material.side=this.material.side,sr.length=0,s.raycast(t,sr);for(let u=0;u<sr.length;u++)sr[u].object=this,i.push(sr[u])}}copy(t){const i=this.geometry;return super.copy(t),this.geometry=i,pl.forEach(c=>{this[c]=t[c]}),this}clone(){return new this.constructor().copy(this)}};Si.forEach(n=>{const t="_private_"+n;Object.defineProperty(Fi.prototype,n,{get(){return this[t]},set(i){i!==this[t]&&(this[t]=i,this._needsSync=!0)}})});new kn;new Ye;const Hs=X.forwardRef(({sdfGlyphSize:n=64,anchorX:t="center",anchorY:i="middle",font:c,fontSize:r=1,children:e,characters:s,onSync:o,...a},l)=>{const u=st(({invalidate:p})=>p),[f]=X.useState(()=>new Fi),[h,d]=X.useMemo(()=>{const p=[];let v="";return X.Children.forEach(e,A=>{typeof A=="string"||typeof A=="number"?v+=A:p.push(A)}),[p,v]},[e]);return Da(()=>new Promise(p=>qo({font:c,characters:s},p)),["troika-text",c,s]),X.useLayoutEffect(()=>void f.sync(()=>{u(),o&&o(f)})),X.useEffect(()=>()=>f.dispose(),[f]),X.createElement("primitive",fi({object:f,ref:l,font:c,text:d,anchorX:t,anchorY:i,fontSize:r,sdfGlyphSize:n},a),h)}),yn=n=>n===Object(n)&&!Array.isArray(n)&&typeof n!="function";function zn(n,t){const i=st(e=>e.gl),c=zt(jr,yn(n)?Object.values(n):n);return X.useLayoutEffect(()=>{t?.(c)},[t]),X.useEffect(()=>{if("initTexture"in i){let e=[];Array.isArray(c)?e=c:c instanceof It?e=[c]:yn(c)&&(e=Object.values(c)),e.forEach(s=>{s instanceof It&&i.initTexture(s)})}},[i,c]),X.useMemo(()=>{if(yn(n)){const e={};let s=0;for(const o in n)e[o]=c[s++];return e}else return c},[n,c])}zn.preload=n=>zt.preload(jr,n);zn.clear=n=>zt.clear(jr,n);let Ir=null,Ri="https://www.gstatic.com/draco/versioned/decoders/1.5.5/";function Di(n=!0,t=!0,i){return c=>{i&&i(c),n&&(Ir||(Ir=new go),Ir.setDecoderPath(typeof n=="string"?n:Ri),c.setDRACOLoader(Ir)),t&&c.setMeshoptDecoder(typeof gn=="function"?gn():gn)}}const dt=(n,t,i,c)=>zt(Kn,n,Di(t,i,c));dt.preload=(n,t,i,c)=>zt.preload(Kn,n,Di(t,i,c));dt.clear=n=>zt.clear(Kn,n);dt.setDecoderPath=n=>{Ri=n};function Al(n,t,i){const c=st(d=>d.size),r=st(d=>d.viewport),e=typeof n=="number"?n:c.width*r.dpr,s=c.height*r.dpr,o=(typeof n=="number"?i:n)||{},{samples:a=0,depth:l,...u}=o,f=l??o.depthBuffer,h=X.useMemo(()=>{const d=new it(e,s,{minFilter:ot,magFilter:ot,type:ai,...u});return f&&(d.depthTexture=new oi(e,s,li)),d.samples=a,d},[]);return X.useLayoutEffect(()=>{h.setSize(e,s),a&&(h.samples=a)},[a,h,e,s]),X.useEffect(()=>()=>h.dispose(),[]),h}const vl=n=>typeof n=="function",ml=X.forwardRef(({envMap:n,resolution:t=256,frames:i=1/0,children:c,makeDefault:r,...e},s)=>{const o=st(({set:A})=>A),a=st(({camera:A})=>A),l=st(({size:A})=>A),u=X.useRef(null);X.useImperativeHandle(s,()=>u.current,[]);const f=X.useRef(null),h=Al(t);X.useLayoutEffect(()=>{e.manual||u.current.updateProjectionMatrix()},[l,e]),X.useLayoutEffect(()=>{u.current.updateProjectionMatrix()}),X.useLayoutEffect(()=>{if(r){const A=a;return o(()=>({camera:u.current})),()=>o(()=>({camera:A}))}},[u,r,o]);let d=0,p=null;const v=vl(c);return bt(A=>{v&&(i===1/0||d<i)&&(f.current.visible=!1,A.gl.setRenderTarget(h),p=A.scene.background,n&&(A.scene.background=n),A.gl.render(A.scene,u.current),A.scene.background=p,A.gl.setRenderTarget(null),f.current.visible=!0,d++)}),X.createElement(X.Fragment,null,X.createElement("orthographicCamera",fi({left:l.width/-2,right:l.width/2,top:l.height/2,bottom:l.height/-2,ref:u},e),!v&&c),X.createElement("group",{ref:f},v&&c(h.texture)))});function gl(n,t){const i=X.useRef(null),[c]=X.useState(()=>t?t instanceof Kt?{current:t}:t:i),[r]=X.useState(()=>new Vs(void 0));X.useLayoutEffect(()=>{t&&(c.current=t instanceof Kt?t:t.current),r._root=c.current});const e=X.useRef({}),s=X.useMemo(()=>{const o={};return n.forEach(a=>Object.defineProperty(o,a.name,{enumerable:!0,get(){if(c.current)return e.current[a.name]||(e.current[a.name]=r.clipAction(a,c.current))},configurable:!0})),{ref:c,clips:n,actions:o,names:n.map(a=>a.name),mixer:r}},[n]);return bt((o,a)=>r.update(a)),X.useEffect(()=>{const o=c.current;return()=>{e.current={},r.stopAllAction(),Object.values(s.actions).forEach(a=>{o&&r.uncacheAction(a,o)})}},[n]),s}const hr="/",_n=n=>n.startsWith("/")?n.substring(1):n,Bl=()=>{const n=zn(`${hr}textures/grass.jpg`),t=X.useMemo(()=>{const i=n.clone();return i.wrapS=i.wrapT=Hr,i.repeat.set(30,30),i},[n]);return X.useEffect(()=>()=>{t.dispose()},[t]),z.jsxs("mesh",{rotation:[-Math.PI/2,0,0],position:[0,-.1,0],receiveShadow:!0,children:[z.jsx("planeGeometry",{args:[100,100]}),z.jsx("meshStandardMaterial",{map:t,color:"#90a880",roughness:.8})]})},ir=({position:n,rotationY:t=0,modelPath:i,name:c,scale:r=1,signSide:e,extraHitbox:s=null})=>{const o=nt(k=>k.setZone),a=nt(k=>k.currentZone),l=nt(k=>k.enableReadingMode),u=nt(k=>k.isReadingMode),h=nt(k=>k.content)[c]?.title||c,{scene:d}=dt(hr+_n(i)),p=X.useMemo(()=>Nr.clone(d),[d]),{scene:v}=dt(`${hr}models/props/sign.glb`),A=X.useMemo(()=>Nr.clone(v),[v]),[E,m]=X.useState(!1);X.useEffect(()=>{p.traverse(k=>{k.isMesh&&(k.castShadow=!0,k.receiveShadow=!0)})},[p]),X.useEffect(()=>(E?document.body.classList.add("hovering-3d"):document.body.classList.remove("hovering-3d"),()=>{document.body.classList.remove("hovering-3d")}),[E]),bt(k=>{if(u)return;const y=k.scene.getObjectByName("Player");if(y){const w=y.position.distanceTo(new Ne(...n));w<4&&a!==c?o(c):a===c&&w>4.1&&o(null)}});const C=a===c||E;let g=0,T=0,G=0,M=2;e==="right"?(g=2.5,T=.5,G=-.1):e==="left"?(g=-2.5,T=-.5,G=.1):e==="center"&&(M=3.2);const b=k=>{k.stopPropagation(),o(c),l(!0)},U=k=>{k.stopPropagation(),m(!0)},S=()=>m(!1);return z.jsxs("group",{position:n,children:[z.jsxs("mesh",{position:[0,0,0],onClick:b,onPointerOver:U,onPointerOut:S,children:[z.jsx("cylinderGeometry",{args:[3.5,3.5,0,16]}),z.jsx("meshBasicMaterial",{visible:!1})]}),s&&z.jsxs("mesh",{position:s.position||[0,0,0],onClick:b,onPointerOver:U,onPointerOut:S,children:[z.jsx("cylinderGeometry",{args:s.args}),z.jsx("meshBasicMaterial",{visible:!1})]}),z.jsx("group",{rotation:[0,t,0],scale:r,children:z.jsx("primitive",{object:p})}),z.jsxs("group",{position:[g,0,M],rotation:[0,T,0],children:[z.jsx("primitive",{object:A,scale:1}),z.jsx(ms,{speed:4,rotationIntensity:.1,floatIntensity:.1,children:z.jsx(Hs,{font:`${hr}${_n("/fonts/PersonalFont.ttf")}`,position:[G,1.6,.3],fontSize:.3,color:C?"#ffd700":"white",anchorX:"center",anchorY:"middle",outlineWidth:.02,outlineColor:"#000000",children:h})}),z.jsx("group",{visible:C,children:z.jsx(ms,{speed:10,rotationIntensity:0,floatIntensity:.5,children:z.jsx(Hs,{position:[G,2.2,.3],fontSize:.5,color:"#ffd700",outlineWidth:.02,outlineColor:"black",children:""})})})]}),z.jsxs("mesh",{rotation:[-Math.PI/2,0,0],position:[0,.05,0],receiveShadow:!0,children:[z.jsx("circleGeometry",{args:[3.5,32]}),z.jsx("meshStandardMaterial",{color:"white",opacity:.1,transparent:!0})]})]})},rt=({modelPath:n,position:t,scale:i=1,rotation:c=[0,0,0]})=>{const{scene:r}=dt(hr+_n(n)),e=X.useMemo(()=>Nr.clone(r),[r]);return X.useEffect(()=>{e.traverse(s=>{s.isMesh&&(s.castShadow=!0,s.receiveShadow=!0)})},[e]),z.jsx("group",{position:t,rotation:c,scale:i,children:z.jsx("primitive",{object:e})})},Cl=()=>{const n=X.useRef(),t=100,i=X.useMemo(()=>new Kt,[]),c=X.useRef([]);return X.useEffect(()=>{const r=[];for(let e=0;e<t;e++){const s=Math.sqrt(Math.random())*25,o=Math.random()*2*Math.PI,a=s*Math.cos(o),l=s*Math.sin(o);r.push({t:Math.random()*100,speed:.005+Math.random()*.015,x:a,y:Math.random()*5+.5,z:l,radiusOffset:Math.random()*2})}c.current=r},[]),bt(()=>{n.current&&(c.current.forEach((r,e)=>{r.t+=r.speed;const s=r.x+Math.cos(r.t)*r.radiusOffset,o=r.z+Math.sin(r.t)*r.radiusOffset,a=r.y+Math.sin(r.t*2)*.5;i.position.set(s,a,o);const l=.5+Math.sin(r.t*5)*.3;i.scale.set(l,l,l),i.updateMatrix(),n.current.setMatrixAt(e,i.matrix)}),n.current.instanceMatrix.needsUpdate=!0)}),z.jsxs("instancedMesh",{ref:n,args:[null,null,t],children:[z.jsx("sphereGeometry",{args:[.08,6,6]}),z.jsx("meshBasicMaterial",{color:[3,3,0],toneMapped:!1,transparent:!0,opacity:.8,blending:ba})]})},El=()=>{const n=X.useRef(),t=17,i=80;return bt(c=>{if(n.current){const r=c.clock.getElapsedTime();n.current.rotation.z-=.005,n.current.material&&(n.current.material.opacity=.3+Math.sin(r*2)*.15)}}),z.jsxs("group",{position:[0,.02,0],rotation:[-Math.PI/2,0,0],children:[z.jsxs("mesh",{ref:n,children:[z.jsx("ringGeometry",{args:[t-.4,t,64]}),z.jsx("meshBasicMaterial",{color:"#aaddff",transparent:!0,opacity:.3,side:Ft})]}),z.jsxs("mesh",{position:[0,0,.01],children:[z.jsx("ringGeometry",{args:[t-.1,t,64]}),z.jsx("meshBasicMaterial",{color:"#ffffff",transparent:!0,opacity:.15})]}),z.jsxs("mesh",{position:[0,0,-.01],children:[z.jsx("ringGeometry",{args:[t,i,64]}),z.jsx("meshBasicMaterial",{color:"#051020",opacity:.5,transparent:!0})]})]})};function yl(){return z.jsxs("group",{children:[z.jsx(Bl,{}),z.jsx(ir,{position:[-10,0,-4],modelPath:"/models/buildings/house.glb",name:"Propos",rotationY:Math.PI/6,scale:8,signSide:"right",extraHitbox:{args:[.3,2.5,3,16],position:[-.7,1.7,0]}}),z.jsx(ir,{position:[10,0,-4],modelPath:"/models/buildings/runeStone.glb",name:"Parcours",rotationY:-Math.PI-3.3,scale:2.5,signSide:"left",extraHitbox:{args:[.3,2,3,16],position:[-.3,1.3,0]}}),z.jsx(ir,{position:[-8,0,8],modelPath:"/models/buildings/tower.glb",name:"Projets",rotationY:Math.PI/7,scale:.3,signSide:"right",extraHitbox:{args:[1.3,1.3,3,16],position:[0,2,0]}}),z.jsx(ir,{position:[8,0,8],modelPath:"/models/buildings/treeStump.glb",name:"Competences",rotationY:-Math.PI,scale:12,signSide:"left"}),z.jsx(ir,{position:[0,0,-10],modelPath:"/models/buildings/fountain.glb",name:"Loisirs",rotationY:0,scale:3,signSide:"center"}),z.jsx(rt,{modelPath:"/models/nature/rock.glb",position:[0,0,9],scale:4}),z.jsx(rt,{modelPath:"/models/nature/bush.glb",position:[1.5,0,8.5],scale:4}),z.jsx(rt,{modelPath:"/models/nature/bush.glb",position:[-1.5,0,8.5],scale:4}),z.jsx(rt,{modelPath:"/models/nature/tree.glb",position:[-10,2,2],scale:1.4}),z.jsx(rt,{modelPath:"/models/nature/rock.glb",position:[-9,0,3],scale:3}),z.jsx(rt,{modelPath:"/models/nature/tree.glb",position:[10,2,2],scale:1.4,rotation:[0,3,0]}),z.jsx(rt,{modelPath:"/models/nature/rock.glb",position:[9,0,3],scale:3,rotation:[0,1,0]}),z.jsx(rt,{modelPath:"/models/nature/bush.glb",position:[-5,0,-8],scale:6}),z.jsx(rt,{modelPath:"/models/nature/tree.glb",position:[-6,2,-9],scale:1.3}),z.jsx(rt,{modelPath:"/models/nature/bush.glb",position:[5,0,-8],scale:6,rotation:[0,.5,0]}),z.jsx(rt,{modelPath:"/models/nature/tree.glb",position:[6,2,-9],scale:1.3,rotation:[0,2,0]}),z.jsx(Cl,{}),z.jsx(El,{})]})}const bn="/",bl=()=>{const n=X.useRef(),{camera:t}=st(),i=X.useRef({}),c=7,r=17,[e,s]=X.useState(!1),o=nt(b=>b.isSceneReady),a=X.useRef({scale:0,y:15}),{scene:l}=dt(`${bn}character/skin.glb`),{animations:u}=dt(`${bn}character/animations.glb`),{animations:f}=dt(`${bn}character/idle.glb`),h=X.useMemo(()=>[...f,...u],[f,u]),d=X.useMemo(()=>Nr.clone(l),[l]),{actions:p}=gl(h,n),v=nt(b=>b.currentZone),A=nt(b=>b.isReadingMode),E=nt(b=>b.enableReadingMode),m=nt(b=>b.isContactOpen),[C,g]=X.useState(""),[T,G]=X.useState({idle:"",run:""}),M=X.useRef(new Ne);return X.useEffect(()=>{if(h.length>0){const b=h.find(S=>S.name.match(/idle/i))?.name||h[0].name,U=h.find(S=>S.name.match(/run|walk/i))?.name||h[1]?.name;G({idle:b,run:U}),p[b]&&(p[b].reset().fadeIn(.5).play(),g(b))}},[h,p]),X.useEffect(()=>{d.traverse(b=>{b.isMesh&&(b.castShadow=!0)})},[d]),X.useEffect(()=>{if(o){const b=setTimeout(()=>{s(!0)},1e3);return()=>clearTimeout(b)}},[o]),X.useEffect(()=>{const b=S=>{i.current[S.code]=!0,S.code==="Space"&&v&&!m&&E(!0)},U=S=>i.current[S.code]=!1;return window.addEventListener("keydown",b),window.addEventListener("keyup",U),()=>{window.removeEventListener("keydown",b),window.removeEventListener("keyup",U)}},[v,E,m]),bt((b,U)=>{if(!n.current)return;const S=Math.min(U,.1);e?(a.current.scale=wr.lerp(a.current.scale,1.1,S*3),a.current.y=wr.lerp(a.current.y,0,S*3),a.current.y<0&&(a.current.y=0)):a.current={scale:0,y:15},n.current.scale.setScalar(a.current.scale),n.current.position.y=a.current.y;let k=0,y=0;!A&&!m&&e&&((i.current.ArrowUp||i.current.KeyW)&&(y-=1),(i.current.ArrowDown||i.current.KeyS)&&(y+=1),(i.current.ArrowLeft||i.current.KeyA)&&(k-=1),(i.current.ArrowRight||i.current.KeyD)&&(k+=1));const w=k!==0||y!==0;if(w){const V=new Ne(k,0,y).normalize();let P=n.current.position.x+V.x*c*U,_=n.current.position.z+V.z*c*U;const B=Math.sqrt(P*P+_*_);if(B>r){const D=r/B;P*=D,_*=D}n.current.position.x=P,n.current.position.z=_;const x=Math.atan2(V.x,V.z);n.current.rotation.y=x}const F=w?T.run:T.idle;F&&C!==F&&p[F]&&(p[C]&&p[C].fadeOut(.2),p[F].reset().fadeIn(.2).play(),g(F));const j=new Ne,K=new Ne;let q=40;if(A&&v){let V=0,P=0;switch(v){case"Propos":V=-10,P=-4;break;case"Parcours":V=10,P=-4;break;case"Projets":V=-8,P=8;break;case"Competences":V=8,P=8;break;case"Loisirs":V=0,P=-10;break}j.set(V+10,20,P+10),K.set(V,0,P),q=60}else j.set(n.current.position.x,20,n.current.position.z+30),K.set(n.current.position.x,0,n.current.position.z),q=40;t.position.lerp(j,.1),t.zoom=wr.lerp(t.zoom,q,.05),M.current.lerp(K,.12),t.lookAt(M.current),t.updateProjectionMatrix()}),z.jsxs(z.Fragment,{children:[z.jsxs("group",{ref:n,name:"Player",children:[z.jsx("primitive",{object:d}),z.jsxs("mesh",{rotation:[-Math.PI/2,0,0],position:[0,.05,0],children:[z.jsx("circleGeometry",{args:[.4,16]}),z.jsx("meshBasicMaterial",{color:"black",opacity:.2,transparent:!0})]})]}),z.jsx(Tl,{playerRef:n,keys:i})]})},Tl=({playerRef:n,keys:t})=>{const i=X.useRef(),c=X.useMemo(()=>new Kt,[]),r=30,e=X.useMemo(()=>new Array(r).fill(0).map(()=>({active:!1,x:0,y:0,z:0,vx:0,vz:0,scale:0,life:0})),[]),s=X.useRef(0);return bt((o,a)=>{if(!n.current||!i.current)return;const l=o.clock.getElapsedTime(),u=t.current.ArrowUp||t.current.KeyW||t.current.ArrowDown||t.current.KeyS||t.current.ArrowLeft||t.current.KeyA||t.current.ArrowRight||t.current.KeyD;if(s.current+=a,u&&s.current>.08){s.current=0;const f=e.find(h=>!h.active);if(f){const h=n.current.position;f.active=!0,f.life=1,f.scale=1,f.x=h.x+(Math.random()-.5)*.5,f.y=.1,f.z=h.z+(Math.random()-.5)*.5,f.vx=(Math.random()-.5)*.5,f.vz=(Math.random()-.5)*.5}}e.forEach((f,h)=>{f.active?(f.life-=a*1.5,f.life<=0?(f.active=!1,f.scale=0):(f.scale=f.life,f.y+=a*.5,f.x+=f.vx*a,f.z+=f.vz*a)):f.scale=0,c.position.set(f.x,f.y,f.z),c.scale.set(f.scale,f.scale,f.scale),c.rotation.set(0,l*2+h,0),c.updateMatrix(),i.current.setMatrixAt(h,c.matrix)}),i.current.instanceMatrix.needsUpdate=!0}),z.jsxs("instancedMesh",{ref:i,args:[null,null,r],frustumCulled:!1,children:[z.jsx("circleGeometry",{args:[.3,8]}),z.jsx("meshBasicMaterial",{color:"#dddddd",transparent:!0,opacity:.4})]})};var Tn=1/1e3,Ml=1e3,xl=class{constructor(){this.startTime=performance.now(),this.previousTime=0,this.currentTime=0,this._delta=0,this._elapsed=0,this._fixedDelta=1e3/60,this.timescale=1,this.useFixedDelta=!1,this._autoReset=!1}get autoReset(){return this._autoReset}set autoReset(n){typeof document<"u"&&document.hidden!==void 0&&(n?document.addEventListener("visibilitychange",this):document.removeEventListener("visibilitychange",this),this._autoReset=n)}get delta(){return this._delta*Tn}get fixedDelta(){return this._fixedDelta*Tn}set fixedDelta(n){this._fixedDelta=n*Ml}get elapsed(){return this._elapsed*Tn}update(n){this.useFixedDelta?this._delta=this.fixedDelta:(this.previousTime=this.currentTime,this.currentTime=(n!==void 0?n:performance.now())-this.startTime,this._delta=this.currentTime-this.previousTime),this._delta*=this.timescale,this._elapsed+=this._delta}reset(){this._delta=0,this._elapsed=0,this.currentTime=performance.now()-this.startTime}getDelta(){return this.delta}getElapsed(){return this.elapsed}handleEvent(n){document.hidden||(this.currentTime=performance.now()-this.startTime)}dispose(){this.autoReset=!1}},Sl=(()=>{const n=new Float32Array([-1,-1,0,3,-1,0,-1,3,0]),t=new Float32Array([0,0,2,0,0,2]),i=new On;return i.setAttribute("position",new Dt(n,3)),i.setAttribute("uv",new Dt(t,2)),i})(),Xe=class Ln{static get fullscreenGeometry(){return Sl}constructor(t="Pass",i=new vs,c=new ri){this.name=t,this.renderer=null,this.scene=i,this.camera=c,this.screen=null,this.rtt=!0,this.needsSwap=!0,this.needsDepthTexture=!1,this.enabled=!0}get renderToScreen(){return!this.rtt}set renderToScreen(t){if(this.rtt===t){const i=this.fullscreenMaterial;i!==null&&(i.needsUpdate=!0),this.rtt=!t}}set mainScene(t){}set mainCamera(t){}setRenderer(t){this.renderer=t}isEnabled(){return this.enabled}setEnabled(t){this.enabled=t}get fullscreenMaterial(){return this.screen!==null?this.screen.material:null}set fullscreenMaterial(t){let i=this.screen;i!==null?i.material=t:(i=new Ar(Ln.fullscreenGeometry,t),i.frustumCulled=!1,this.scene===null&&(this.scene=new vs),this.scene.add(i),this.screen=i)}getFullscreenMaterial(){return this.fullscreenMaterial}setFullscreenMaterial(t){this.fullscreenMaterial=t}getDepthTexture(){return null}setDepthTexture(t,i=jt){}render(t,i,c,r,e){throw new Error("Render method not implemented!")}setSize(t,i){}initialize(t,i,c){}dispose(){for(const t of Object.keys(this)){const i=this[t];(i instanceof it||i instanceof cr||i instanceof It||i instanceof Ln)&&this[t].dispose()}this.fullscreenMaterial!==null&&this.fullscreenMaterial.dispose()}},Fl=class extends Xe{constructor(){super("ClearMaskPass",null,null),this.needsSwap=!1}render(n,t,i,c,r){const e=n.state.buffers.stencil;e.setLocked(!1),e.setTest(!1)}},Rl=`#ifdef COLOR_WRITE
#include <common>
#include <dithering_pars_fragment>
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#endif
#ifdef DEPTH_WRITE
#include <packing>
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
return unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
return texture2D(depthBuffer,uv).r;
#endif
}
#endif
#ifdef USE_WEIGHTS
uniform vec4 channelWeights;
#endif
uniform float opacity;varying vec2 vUv;void main(){
#ifdef COLOR_WRITE
vec4 texel=texture2D(inputBuffer,vUv);
#ifdef USE_WEIGHTS
texel*=channelWeights;
#endif
gl_FragColor=opacity*texel;
#ifdef COLOR_SPACE_CONVERSION
#include <colorspace_fragment>
#endif
#include <dithering_fragment>
#else
gl_FragColor=vec4(0.0);
#endif
#ifdef DEPTH_WRITE
gl_FragDepth=readDepth(vUv);
#endif
}`,Gi="varying vec2 vUv;void main(){vUv=position.xy*0.5+0.5;gl_Position=vec4(position.xy,1.0,1.0);}",Ui=class extends yt{constructor(){super({name:"CopyMaterial",defines:{DEPTH_PACKING:"0",COLOR_WRITE:"1"},uniforms:{inputBuffer:new be(null),depthBuffer:new be(null),channelWeights:new be(null),opacity:new be(1)},blending:_t,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:Rl,vertexShader:Gi}),this.depthFunc=Fa}get inputBuffer(){return this.uniforms.inputBuffer.value}set inputBuffer(n){const t=n!==null;this.colorWrite!==t&&(t?this.defines.COLOR_WRITE=!0:delete this.defines.COLOR_WRITE,this.colorWrite=t,this.needsUpdate=!0),this.uniforms.inputBuffer.value=n}get depthBuffer(){return this.uniforms.depthBuffer.value}set depthBuffer(n){const t=n!==null;this.depthWrite!==t&&(t?this.defines.DEPTH_WRITE=!0:delete this.defines.DEPTH_WRITE,this.depthTest=t,this.depthWrite=t,this.needsUpdate=!0),this.uniforms.depthBuffer.value=n}set depthPacking(n){this.defines.DEPTH_PACKING=n.toFixed(0),this.needsUpdate=!0}get channelWeights(){return this.uniforms.channelWeights.value}set channelWeights(n){n!==null?(this.defines.USE_WEIGHTS="1",this.uniforms.channelWeights.value=n):delete this.defines.USE_WEIGHTS,this.needsUpdate=!0}setInputBuffer(n){this.uniforms.inputBuffer.value=n}getOpacity(n){return this.uniforms.opacity.value}setOpacity(n){this.uniforms.opacity.value=n}},Dl=class extends Xe{constructor(n,t=!0){super("CopyPass"),this.fullscreenMaterial=new Ui,this.needsSwap=!1,this.renderTarget=n,n===void 0&&(this.renderTarget=new it(1,1,{minFilter:ot,magFilter:ot,stencilBuffer:!1,depthBuffer:!1}),this.renderTarget.texture.name="CopyPass.Target"),this.autoResize=t}get resize(){return this.autoResize}set resize(n){this.autoResize=n}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}setAutoResizeEnabled(n){this.autoResize=n}render(n,t,i,c,r){this.fullscreenMaterial.inputBuffer=t.texture,n.setRenderTarget(this.renderToScreen?null:this.renderTarget),n.render(this.scene,this.camera)}setSize(n,t){this.autoResize&&this.renderTarget.setSize(n,t)}initialize(n,t,i){i!==void 0&&(this.renderTarget.texture.type=i,i!==wt?this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1":n!==null&&n.outputColorSpace===ke&&(this.renderTarget.texture.colorSpace=ke))}},Os=new Ye,Ii=class extends Xe{constructor(n=!0,t=!0,i=!1){super("ClearPass",null,null),this.needsSwap=!1,this.color=n,this.depth=t,this.stencil=i,this.overrideClearColor=null,this.overrideClearAlpha=-1}setClearFlags(n,t,i){this.color=n,this.depth=t,this.stencil=i}getOverrideClearColor(){return this.overrideClearColor}setOverrideClearColor(n){this.overrideClearColor=n}getOverrideClearAlpha(){return this.overrideClearAlpha}setOverrideClearAlpha(n){this.overrideClearAlpha=n}render(n,t,i,c,r){const e=this.overrideClearColor,s=this.overrideClearAlpha,o=n.getClearAlpha(),a=e!==null,l=s>=0;a?(n.getClearColor(Os),n.setClearColor(e,l?s:o)):l&&n.setClearAlpha(s),n.setRenderTarget(this.renderToScreen?null:t),n.clear(this.color,this.depth,this.stencil),a?n.setClearColor(Os,o):l&&n.setClearAlpha(o)}},Gl=class extends Xe{constructor(n,t){super("MaskPass",n,t),this.needsSwap=!1,this.clearPass=new Ii(!1,!1,!0),this.inverse=!1}set mainScene(n){this.scene=n}set mainCamera(n){this.camera=n}get inverted(){return this.inverse}set inverted(n){this.inverse=n}get clear(){return this.clearPass.enabled}set clear(n){this.clearPass.enabled=n}getClearPass(){return this.clearPass}isInverted(){return this.inverted}setInverted(n){this.inverted=n}render(n,t,i,c,r){const e=n.getContext(),s=n.state.buffers,o=this.scene,a=this.camera,l=this.clearPass,u=this.inverted?0:1,f=1-u;s.color.setMask(!1),s.depth.setMask(!1),s.color.setLocked(!0),s.depth.setLocked(!0),s.stencil.setTest(!0),s.stencil.setOp(e.REPLACE,e.REPLACE,e.REPLACE),s.stencil.setFunc(e.ALWAYS,u,4294967295),s.stencil.setClear(f),s.stencil.setLocked(!0),this.clearPass.enabled&&(this.renderToScreen?l.render(n,null):(l.render(n,t),l.render(n,i))),this.renderToScreen?(n.setRenderTarget(null),n.render(o,a)):(n.setRenderTarget(t),n.render(o,a),n.setRenderTarget(i),n.render(o,a)),s.color.setLocked(!1),s.depth.setLocked(!1),s.stencil.setLocked(!1),s.stencil.setFunc(e.EQUAL,1,4294967295),s.stencil.setOp(e.KEEP,e.KEEP,e.KEEP),s.stencil.setLocked(!0)}},Ul=class{constructor(n=null,{depthBuffer:t=!0,stencilBuffer:i=!1,multisampling:c=0,frameBufferType:r}={}){this.renderer=null,this.inputBuffer=this.createBuffer(t,i,r,c),this.outputBuffer=this.inputBuffer.clone(),this.copyPass=new Dl,this.depthTexture=null,this.passes=[],this.timer=new xl,this.autoRenderToScreen=!0,this.setRenderer(n)}get multisampling(){return this.inputBuffer.samples||0}set multisampling(n){const t=this.inputBuffer,i=this.multisampling;i>0&&n>0?(this.inputBuffer.samples=n,this.outputBuffer.samples=n,this.inputBuffer.dispose(),this.outputBuffer.dispose()):i!==n&&(this.inputBuffer.dispose(),this.outputBuffer.dispose(),this.inputBuffer=this.createBuffer(t.depthBuffer,t.stencilBuffer,t.texture.type,n),this.inputBuffer.depthTexture=this.depthTexture,this.outputBuffer=this.inputBuffer.clone())}getTimer(){return this.timer}getRenderer(){return this.renderer}setRenderer(n){if(this.renderer=n,n!==null){const t=n.getSize(new we),i=n.getContext().getContextAttributes().alpha,c=this.inputBuffer.texture.type;c===wt&&n.outputColorSpace===ke&&(this.inputBuffer.texture.colorSpace=ke,this.outputBuffer.texture.colorSpace=ke,this.inputBuffer.dispose(),this.outputBuffer.dispose()),n.autoClear=!1,this.setSize(t.width,t.height);for(const r of this.passes)r.initialize(n,i,c)}}replaceRenderer(n,t=!0){const i=this.renderer,c=i.domElement.parentNode;return this.setRenderer(n),t&&c!==null&&(c.removeChild(i.domElement),c.appendChild(n.domElement)),i}createDepthTexture(){const n=this.depthTexture=new oi;return this.inputBuffer.depthTexture=n,this.inputBuffer.dispose(),this.inputBuffer.stencilBuffer?(n.format=Ta,n.type=Ma):n.type=xa,n}deleteDepthTexture(){if(this.depthTexture!==null){this.depthTexture.dispose(),this.depthTexture=null,this.inputBuffer.depthTexture=null,this.inputBuffer.dispose();for(const n of this.passes)n.setDepthTexture(null)}}createBuffer(n,t,i,c){const r=this.renderer,e=r===null?new we:r.getDrawingBufferSize(new we),s={minFilter:ot,magFilter:ot,stencilBuffer:t,depthBuffer:n,type:i},o=new it(e.width,e.height,s);return c>0&&(o.samples=c),i===wt&&r!==null&&r.outputColorSpace===ke&&(o.texture.colorSpace=ke),o.texture.name="EffectComposer.Buffer",o.texture.generateMipmaps=!1,o}setMainScene(n){for(const t of this.passes)t.mainScene=n}setMainCamera(n){for(const t of this.passes)t.mainCamera=n}addPass(n,t){const i=this.passes,c=this.renderer,r=c.getDrawingBufferSize(new we),e=c.getContext().getContextAttributes().alpha,s=this.inputBuffer.texture.type;if(n.setRenderer(c),n.setSize(r.width,r.height),n.initialize(c,e,s),this.autoRenderToScreen&&(i.length>0&&(i[i.length-1].renderToScreen=!1),n.renderToScreen&&(this.autoRenderToScreen=!1)),t!==void 0?i.splice(t,0,n):i.push(n),this.autoRenderToScreen&&(i[i.length-1].renderToScreen=!0),n.needsDepthTexture||this.depthTexture!==null)if(this.depthTexture===null){const o=this.createDepthTexture();for(n of i)n.setDepthTexture(o)}else n.setDepthTexture(this.depthTexture)}removePass(n){const t=this.passes,i=t.indexOf(n);if(i!==-1&&t.splice(i,1).length>0){if(this.depthTexture!==null){const e=(o,a)=>o||a.needsDepthTexture;t.reduce(e,!1)||(n.getDepthTexture()===this.depthTexture&&n.setDepthTexture(null),this.deleteDepthTexture())}this.autoRenderToScreen&&i===t.length&&(n.renderToScreen=!1,t.length>0&&(t[t.length-1].renderToScreen=!0))}}removeAllPasses(){const n=this.passes;this.deleteDepthTexture(),n.length>0&&(this.autoRenderToScreen&&(n[n.length-1].renderToScreen=!1),this.passes=[])}render(n){const t=this.renderer,i=this.copyPass;let c=this.inputBuffer,r=this.outputBuffer,e=!1,s,o,a;n===void 0&&(this.timer.update(),n=this.timer.getDelta());for(const l of this.passes)l.enabled&&(l.render(t,c,r,n,e),l.needsSwap&&(e&&(i.renderToScreen=l.renderToScreen,s=t.getContext(),o=t.state.buffers.stencil,o.setFunc(s.NOTEQUAL,1,4294967295),i.render(t,c,r,n,e),o.setFunc(s.EQUAL,1,4294967295)),a=c,c=r,r=a),l instanceof Gl?e=!0:l instanceof Fl&&(e=!1))}setSize(n,t,i){const c=this.renderer,r=c.getSize(new we);(n===void 0||t===void 0)&&(n=r.width,t=r.height),(r.width!==n||r.height!==t)&&c.setSize(n,t,i);const e=c.getDrawingBufferSize(new we);this.inputBuffer.setSize(e.width,e.height),this.outputBuffer.setSize(e.width,e.height);for(const s of this.passes)s.setSize(e.width,e.height)}reset(){this.dispose(),this.autoRenderToScreen=!0}dispose(){for(const n of this.passes)n.dispose();this.passes=[],this.inputBuffer!==null&&this.inputBuffer.dispose(),this.outputBuffer!==null&&this.outputBuffer.dispose(),this.deleteDepthTexture(),this.copyPass.dispose(),this.timer.dispose(),Xe.fullscreenGeometry.dispose()}},Ut={NONE:0,DEPTH:1,CONVOLUTION:2},Te={FRAGMENT_HEAD:"FRAGMENT_HEAD",FRAGMENT_MAIN_UV:"FRAGMENT_MAIN_UV",FRAGMENT_MAIN_IMAGE:"FRAGMENT_MAIN_IMAGE",VERTEX_HEAD:"VERTEX_HEAD",VERTEX_MAIN_SUPPORT:"VERTEX_MAIN_SUPPORT"},Il=class{constructor(){this.shaderParts=new Map([[Te.FRAGMENT_HEAD,null],[Te.FRAGMENT_MAIN_UV,null],[Te.FRAGMENT_MAIN_IMAGE,null],[Te.VERTEX_HEAD,null],[Te.VERTEX_MAIN_SUPPORT,null]]),this.defines=new Map,this.uniforms=new Map,this.blendModes=new Map,this.extensions=new Set,this.attributes=Ut.NONE,this.varyings=new Set,this.uvTransformation=!1,this.readDepth=!1,this.colorSpace=ci}},Mn=!1,ks=class{constructor(n=null){this.originalMaterials=new Map,this.material=null,this.materials=null,this.materialsBackSide=null,this.materialsDoubleSide=null,this.materialsFlatShaded=null,this.materialsFlatShadedBackSide=null,this.materialsFlatShadedDoubleSide=null,this.setMaterial(n),this.meshCount=0,this.replaceMaterial=t=>{if(t.isMesh){let i;if(t.material.flatShading)switch(t.material.side){case Ft:i=this.materialsFlatShadedDoubleSide;break;case Rr:i=this.materialsFlatShadedBackSide;break;default:i=this.materialsFlatShaded;break}else switch(t.material.side){case Ft:i=this.materialsDoubleSide;break;case Rr:i=this.materialsBackSide;break;default:i=this.materials;break}this.originalMaterials.set(t,t.material),t.isSkinnedMesh?t.material=i[2]:t.isInstancedMesh?t.material=i[1]:t.material=i[0],++this.meshCount}}}cloneMaterial(n){if(!(n instanceof yt))return n.clone();const t=n.uniforms,i=new Map;for(const r in t){const e=t[r].value;e.isRenderTargetTexture&&(t[r].value=null,i.set(r,e))}const c=n.clone();for(const r of i)t[r[0]].value=r[1],c.uniforms[r[0]].value=r[1];return c}setMaterial(n){if(this.disposeMaterials(),this.material=n,n!==null){const t=this.materials=[this.cloneMaterial(n),this.cloneMaterial(n),this.cloneMaterial(n)];for(const i of t)i.uniforms=Object.assign({},n.uniforms),i.side=si;t[2].skinning=!0,this.materialsBackSide=t.map(i=>{const c=this.cloneMaterial(i);return c.uniforms=Object.assign({},n.uniforms),c.side=Rr,c}),this.materialsDoubleSide=t.map(i=>{const c=this.cloneMaterial(i);return c.uniforms=Object.assign({},n.uniforms),c.side=Ft,c}),this.materialsFlatShaded=t.map(i=>{const c=this.cloneMaterial(i);return c.uniforms=Object.assign({},n.uniforms),c.flatShading=!0,c}),this.materialsFlatShadedBackSide=t.map(i=>{const c=this.cloneMaterial(i);return c.uniforms=Object.assign({},n.uniforms),c.flatShading=!0,c.side=Rr,c}),this.materialsFlatShadedDoubleSide=t.map(i=>{const c=this.cloneMaterial(i);return c.uniforms=Object.assign({},n.uniforms),c.flatShading=!0,c.side=Ft,c})}}render(n,t,i){const c=n.shadowMap.enabled;if(n.shadowMap.enabled=!1,Mn){const r=this.originalMaterials;this.meshCount=0,t.traverse(this.replaceMaterial),n.render(t,i);for(const e of r)e[0].material=e[1];this.meshCount!==r.size&&r.clear()}else{const r=t.overrideMaterial;t.overrideMaterial=this.material,n.render(t,i),t.overrideMaterial=r}n.shadowMap.enabled=c}disposeMaterials(){if(this.material!==null){const n=this.materials.concat(this.materialsBackSide).concat(this.materialsDoubleSide).concat(this.materialsFlatShaded).concat(this.materialsFlatShadedBackSide).concat(this.materialsFlatShadedDoubleSide);for(const t of n)t.dispose()}}dispose(){this.originalMaterials.clear(),this.disposeMaterials()}static get workaroundEnabled(){return Mn}static set workaroundEnabled(n){Mn=n}},Ct=-1,Je=class extends Jn{constructor(n,t=Ct,i=Ct,c=1){super(),this.resizable=n,this.baseSize=new we(1,1),this.preferredSize=new we(t,i),this.target=this.preferredSize,this.s=c,this.effectiveSize=new we,this.addEventListener("change",()=>this.updateEffectiveSize()),this.updateEffectiveSize()}updateEffectiveSize(){const n=this.baseSize,t=this.preferredSize,i=this.effectiveSize,c=this.scale;t.width!==Ct?i.width=t.width:t.height!==Ct?i.width=Math.round(t.height*(n.width/Math.max(n.height,1))):i.width=Math.round(n.width*c),t.height!==Ct?i.height=t.height:t.width!==Ct?i.height=Math.round(t.width/Math.max(n.width/Math.max(n.height,1),1)):i.height=Math.round(n.height*c)}get width(){return this.effectiveSize.width}set width(n){this.preferredWidth=n}get height(){return this.effectiveSize.height}set height(n){this.preferredHeight=n}getWidth(){return this.width}getHeight(){return this.height}get scale(){return this.s}set scale(n){this.s!==n&&(this.s=n,this.preferredSize.setScalar(Ct),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getScale(){return this.scale}setScale(n){this.scale=n}get baseWidth(){return this.baseSize.width}set baseWidth(n){this.baseSize.width!==n&&(this.baseSize.width=n,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getBaseWidth(){return this.baseWidth}setBaseWidth(n){this.baseWidth=n}get baseHeight(){return this.baseSize.height}set baseHeight(n){this.baseSize.height!==n&&(this.baseSize.height=n,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getBaseHeight(){return this.baseHeight}setBaseHeight(n){this.baseHeight=n}setBaseSize(n,t){(this.baseSize.width!==n||this.baseSize.height!==t)&&(this.baseSize.set(n,t),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}get preferredWidth(){return this.preferredSize.width}set preferredWidth(n){this.preferredSize.width!==n&&(this.preferredSize.width=n,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getPreferredWidth(){return this.preferredWidth}setPreferredWidth(n){this.preferredWidth=n}get preferredHeight(){return this.preferredSize.height}set preferredHeight(n){this.preferredSize.height!==n&&(this.preferredSize.height=n,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getPreferredHeight(){return this.preferredHeight}setPreferredHeight(n){this.preferredHeight=n}setPreferredSize(n,t){(this.preferredSize.width!==n||this.preferredSize.height!==t)&&(this.preferredSize.set(n,t),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}copy(n){this.s=n.scale,this.baseSize.set(n.baseWidth,n.baseHeight),this.preferredSize.set(n.preferredWidth,n.preferredHeight),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height)}static get AUTO_SIZE(){return Ct}},ye={ADD:0,AVERAGE:2,COLOR:3,COLOR_BURN:4,COLOR_DODGE:5,DARKEN:6,DIFFERENCE:7,DIVIDE:8,DST:9,EXCLUSION:10,HARD_LIGHT:11,HARD_MIX:12,HUE:13,INVERT:14,INVERT_RGB:15,LIGHTEN:16,LINEAR_BURN:17,LINEAR_DODGE:18,LINEAR_LIGHT:19,LUMINOSITY:20,MULTIPLY:21,NEGATION:22,NORMAL:23,OVERLAY:24,PIN_LIGHT:25,REFLECT:26,SATURATION:27,SCREEN:28,SOFT_LIGHT:29,SRC:30,SUBTRACT:31,VIVID_LIGHT:32},wl="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(x.rgb+y.rgb,y.a),y.a*opacity);}",_l="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4((x.rgb+y.rgb)*0.5,y.a),y.a*opacity);}",Ll="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(yHSL.xy,xHSL.z));return mix(x,vec4(z,y.a),y.a*opacity);}",Pl="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 a=x.rgb,b=y.rgb;vec3 z=mix(step(0.0,b)*(1.0-min(vec3(1.0),(1.0-a)/b)),vec3(1.0),step(1.0,a));return mix(x,vec4(z,y.a),y.a*opacity);}",Hl="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 a=x.rgb,b=y.rgb;vec3 z=step(0.0,a)*mix(min(vec3(1.0),a/max(1.0-b,1e-9)),vec3(1.0),step(1.0,b));return mix(x,vec4(z,y.a),y.a*opacity);}",Ol="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(min(x.rgb,y.rgb),y.a),y.a*opacity);}",kl="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(abs(x.rgb-y.rgb),y.a),y.a*opacity);}",Nl="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(x.rgb/max(y.rgb,1e-12),y.a),y.a*opacity);}",Jl="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4((x.rgb+y.rgb-2.0*x.rgb*y.rgb),y.a),y.a*opacity);}",Kl="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 a=min(x.rgb,1.0);vec3 b=min(y.rgb,1.0);vec3 z=mix(2.0*a*b,1.0-2.0*(1.0-a)*(1.0-b),step(0.5,b));return mix(x,vec4(z,y.a),y.a*opacity);}",jl="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(step(1.0,x.rgb+y.rgb),y.a),y.a*opacity);}",zl="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(yHSL.x,xHSL.yz));return mix(x,vec4(z,y.a),y.a*opacity);}",Wl="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(1.0-y.rgb,y.a),y.a*opacity);}",Ql="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(y.rgb*(1.0-x.rgb),y.a),y.a*opacity);}",Xl="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(max(x.rgb,y.rgb),y.a),y.a*opacity);}",Vl="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(clamp(y.rgb+x.rgb-1.0,0.0,1.0),y.a),y.a*opacity);}",Yl="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(min(x.rgb+y.rgb,1.0),y.a),y.a*opacity);}",Zl="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(clamp(2.0*y.rgb+x.rgb-1.0,0.0,1.0),y.a),y.a*opacity);}",ql="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(xHSL.xy,yHSL.z));return mix(x,vec4(z,y.a),y.a*opacity);}",$l="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(x.rgb*y.rgb,y.a),y.a*opacity);}",ec="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(1.0-abs(1.0-x.rgb-y.rgb),y.a),y.a*opacity);}",tc="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,y,y.a*opacity);}",rc="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 z=mix(2.0*y.rgb*x.rgb,1.0-2.0*(1.0-y.rgb)*(1.0-x.rgb),step(0.5,x.rgb));return mix(x,vec4(z,y.a),y.a*opacity);}",nc="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 y2=2.0*y.rgb;vec3 z=mix(mix(y2,x.rgb,step(0.5*x.rgb,y.rgb)),max(y2-1.0,vec3(0.0)),step(x.rgb,y2-1.0));return mix(x,vec4(z,y.a),y.a*opacity);}",sc="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 z=mix(min(x.rgb*x.rgb/max(1.0-y.rgb,1e-12),1.0),y.rgb,step(1.0,y.rgb));return mix(x,vec4(z,y.a),y.a*opacity);}",ic="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(xHSL.x,yHSL.y,xHSL.z));return mix(x,vec4(z,y.a),y.a*opacity);}",ac="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(x.rgb+y.rgb-min(x.rgb*y.rgb,1.0),y.a),y.a*opacity);}",oc="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 a=x.rgb;vec3 b=y.rgb;vec3 y2=2.0*b;vec3 w=step(0.5,b);vec3 c=a-(1.0-y2)*a*(1.0-a);vec3 d=mix(a+(y2-1.0)*(sqrt(a)-a),a+(y2-1.0)*a*((16.0*a-12.0)*a+3.0),w*(1.0-step(0.25,a)));vec3 z=mix(c,d,w);return mix(x,vec4(z,y.a),y.a*opacity);}",lc="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return y;}",cc="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(max(x.rgb+y.rgb-1.0,0.0),y.a),y.a*opacity);}",uc="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 z=mix(max(1.0-min((1.0-x.rgb)/(2.0*y.rgb),1.0),0.0),min(x.rgb/(2.0*(1.0-y.rgb)),1.0),step(0.5,y.rgb));return mix(x,vec4(z,y.a),y.a*opacity);}",fc=new Map([[ye.ADD,wl],[ye.AVERAGE,_l],[ye.COLOR,Ll],[ye.COLOR_BURN,Pl],[ye.COLOR_DODGE,Hl],[ye.DARKEN,Ol],[ye.DIFFERENCE,kl],[ye.DIVIDE,Nl],[ye.DST,null],[ye.EXCLUSION,Jl],[ye.HARD_LIGHT,Kl],[ye.HARD_MIX,jl],[ye.HUE,zl],[ye.INVERT,Wl],[ye.INVERT_RGB,Ql],[ye.LIGHTEN,Xl],[ye.LINEAR_BURN,Vl],[ye.LINEAR_DODGE,Yl],[ye.LINEAR_LIGHT,Zl],[ye.LUMINOSITY,ql],[ye.MULTIPLY,$l],[ye.NEGATION,ec],[ye.NORMAL,tc],[ye.OVERLAY,rc],[ye.PIN_LIGHT,nc],[ye.REFLECT,sc],[ye.SATURATION,ic],[ye.SCREEN,ac],[ye.SOFT_LIGHT,oc],[ye.SRC,lc],[ye.SUBTRACT,cc],[ye.VIVID_LIGHT,uc]]),hc=class extends Jn{constructor(n,t=1){super(),this._blendFunction=n,this.opacity=new be(t)}getOpacity(){return this.opacity.value}setOpacity(n){this.opacity.value=n}get blendFunction(){return this._blendFunction}set blendFunction(n){this._blendFunction=n,this.dispatchEvent({type:"change"})}getBlendFunction(){return this.blendFunction}setBlendFunction(n){this.blendFunction=n}getShaderCode(){return fc.get(this.blendFunction)}},Kr=class extends Jn{constructor(n,t,{attributes:i=Ut.NONE,blendFunction:c=ye.NORMAL,defines:r=new Map,uniforms:e=new Map,extensions:s=null,vertexShader:o=null}={}){super(),this.name=n,this.renderer=null,this.attributes=i,this.fragmentShader=t,this.vertexShader=o,this.defines=r,this.uniforms=e,this.extensions=s,this.blendMode=new hc(c),this.blendMode.addEventListener("change",a=>this.setChanged()),this._inputColorSpace=ci,this._outputColorSpace=ui}get inputColorSpace(){return this._inputColorSpace}set inputColorSpace(n){this._inputColorSpace=n,this.setChanged()}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(n){this._outputColorSpace=n,this.setChanged()}set mainScene(n){}set mainCamera(n){}getName(){return this.name}setRenderer(n){this.renderer=n}getDefines(){return this.defines}getUniforms(){return this.uniforms}getExtensions(){return this.extensions}getBlendMode(){return this.blendMode}getAttributes(){return this.attributes}setAttributes(n){this.attributes=n,this.setChanged()}getFragmentShader(){return this.fragmentShader}setFragmentShader(n){this.fragmentShader=n,this.setChanged()}getVertexShader(){return this.vertexShader}setVertexShader(n){this.vertexShader=n,this.setChanged()}setChanged(){this.dispatchEvent({type:"change"})}setDepthTexture(n,t=jt){}update(n,t,i){}setSize(n,t){}initialize(n,t,i){}dispose(){for(const n of Object.keys(this)){const t=this[n];(t instanceof it||t instanceof cr||t instanceof It||t instanceof Xe)&&this[n].dispose()}}},Wn={MEDIUM:2,LARGE:3},dc=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec4 sum=texture2D(inputBuffer,vUv0);sum+=texture2D(inputBuffer,vUv1);sum+=texture2D(inputBuffer,vUv2);sum+=texture2D(inputBuffer,vUv3);gl_FragColor=sum*0.25;
#include <colorspace_fragment>
}`,pc="uniform vec4 texelSize;uniform float kernel;uniform float scale;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec2 uv=position.xy*0.5+0.5;vec2 dUv=(texelSize.xy*vec2(kernel)+texelSize.zw)*scale;vUv0=vec2(uv.x-dUv.x,uv.y+dUv.y);vUv1=vec2(uv.x+dUv.x,uv.y+dUv.y);vUv2=vec2(uv.x+dUv.x,uv.y-dUv.y);vUv3=vec2(uv.x-dUv.x,uv.y-dUv.y);gl_Position=vec4(position.xy,1.0,1.0);}",Ac=[new Float32Array([0,0]),new Float32Array([0,1,1]),new Float32Array([0,1,1,2]),new Float32Array([0,1,2,2,3]),new Float32Array([0,1,2,3,4,4,5]),new Float32Array([0,1,2,3,4,5,7,8,9,10])],vc=class extends yt{constructor(n=new Or){super({name:"KawaseBlurMaterial",uniforms:{inputBuffer:new be(null),texelSize:new be(new Or),scale:new be(1),kernel:new be(0)},blending:_t,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:dc,vertexShader:pc}),this.setTexelSize(n.x,n.y),this.kernelSize=Wn.MEDIUM}set inputBuffer(n){this.uniforms.inputBuffer.value=n}setInputBuffer(n){this.inputBuffer=n}get kernelSequence(){return Ac[this.kernelSize]}get scale(){return this.uniforms.scale.value}set scale(n){this.uniforms.scale.value=n}getScale(){return this.uniforms.scale.value}setScale(n){this.uniforms.scale.value=n}getKernel(){return null}get kernel(){return this.uniforms.kernel.value}set kernel(n){this.uniforms.kernel.value=n}setKernel(n){this.kernel=n}setTexelSize(n,t){this.uniforms.texelSize.value.set(n,t,n*.5,t*.5)}setSize(n,t){const i=1/n,c=1/t;this.uniforms.texelSize.value.set(i,c,i*.5,c*.5)}},mc=class extends Xe{constructor({kernelSize:n=Wn.MEDIUM,resolutionScale:t=.5,width:i=Je.AUTO_SIZE,height:c=Je.AUTO_SIZE,resolutionX:r=i,resolutionY:e=c}={}){super("KawaseBlurPass"),this.renderTargetA=new it(1,1,{depthBuffer:!1}),this.renderTargetA.texture.name="Blur.Target.A",this.renderTargetB=this.renderTargetA.clone(),this.renderTargetB.texture.name="Blur.Target.B";const s=this.resolution=new Je(this,r,e,t);s.addEventListener("change",o=>this.setSize(s.baseWidth,s.baseHeight)),this._blurMaterial=new vc,this._blurMaterial.kernelSize=n,this.copyMaterial=new Ui}getResolution(){return this.resolution}get blurMaterial(){return this._blurMaterial}set blurMaterial(n){this._blurMaterial=n}get dithering(){return this.copyMaterial.dithering}set dithering(n){this.copyMaterial.dithering=n}get kernelSize(){return this.blurMaterial.kernelSize}set kernelSize(n){this.blurMaterial.kernelSize=n}get width(){return this.resolution.width}set width(n){this.resolution.preferredWidth=n}get height(){return this.resolution.height}set height(n){this.resolution.preferredHeight=n}get scale(){return this.blurMaterial.scale}set scale(n){this.blurMaterial.scale=n}getScale(){return this.blurMaterial.scale}setScale(n){this.blurMaterial.scale=n}getKernelSize(){return this.kernelSize}setKernelSize(n){this.kernelSize=n}getResolutionScale(){return this.resolution.scale}setResolutionScale(n){this.resolution.scale=n}render(n,t,i,c,r){const e=this.scene,s=this.camera,o=this.renderTargetA,a=this.renderTargetB,l=this.blurMaterial,u=l.kernelSequence;let f=t;this.fullscreenMaterial=l;for(let h=0,d=u.length;h<d;++h){const p=(h&1)===0?o:a;l.kernel=u[h],l.inputBuffer=f.texture,n.setRenderTarget(p),n.render(e,s),f=p}this.fullscreenMaterial=this.copyMaterial,this.copyMaterial.inputBuffer=f.texture,n.setRenderTarget(this.renderToScreen?null:i),n.render(e,s)}setSize(n,t){const i=this.resolution;i.setBaseSize(n,t);const c=i.width,r=i.height;this.renderTargetA.setSize(c,r),this.renderTargetB.setSize(c,r),this.blurMaterial.setSize(n,t)}initialize(n,t,i){i!==void 0&&(this.renderTargetA.texture.type=i,this.renderTargetB.texture.type=i,i!==wt?(this.blurMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1",this.copyMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1"):n!==null&&n.outputColorSpace===ke&&(this.renderTargetA.texture.colorSpace=ke,this.renderTargetB.texture.colorSpace=ke))}static get AUTO_SIZE(){return Je.AUTO_SIZE}},gc=`#include <common>
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#ifdef RANGE
uniform vec2 range;
#elif defined(THRESHOLD)
uniform float threshold;uniform float smoothing;
#endif
varying vec2 vUv;void main(){vec4 texel=texture2D(inputBuffer,vUv);float l=luminance(texel.rgb);float mask=1.0;
#ifdef RANGE
float low=step(range.x,l);float high=step(l,range.y);mask=low*high;
#elif defined(THRESHOLD)
mask=smoothstep(threshold,threshold+smoothing,l);
#endif
#ifdef COLOR
gl_FragColor=texel*mask;
#else
gl_FragColor=vec4(l*mask);
#endif
}`,Bc=class extends yt{constructor(n=!1,t=null){super({name:"LuminanceMaterial",defines:{THREE_REVISION:Pn.replace(/\D+/g,"")},uniforms:{inputBuffer:new be(null),threshold:new be(0),smoothing:new be(1),range:new be(null)},blending:_t,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:gc,vertexShader:Gi}),this.colorOutput=n,this.luminanceRange=t}set inputBuffer(n){this.uniforms.inputBuffer.value=n}setInputBuffer(n){this.uniforms.inputBuffer.value=n}get threshold(){return this.uniforms.threshold.value}set threshold(n){this.smoothing>0||n>0?this.defines.THRESHOLD="1":delete this.defines.THRESHOLD,this.uniforms.threshold.value=n}getThreshold(){return this.threshold}setThreshold(n){this.threshold=n}get smoothing(){return this.uniforms.smoothing.value}set smoothing(n){this.threshold>0||n>0?this.defines.THRESHOLD="1":delete this.defines.THRESHOLD,this.uniforms.smoothing.value=n}getSmoothingFactor(){return this.smoothing}setSmoothingFactor(n){this.smoothing=n}get useThreshold(){return this.threshold>0||this.smoothing>0}set useThreshold(n){}get colorOutput(){return this.defines.COLOR!==void 0}set colorOutput(n){n?this.defines.COLOR="1":delete this.defines.COLOR,this.needsUpdate=!0}isColorOutputEnabled(n){return this.colorOutput}setColorOutputEnabled(n){this.colorOutput=n}get useRange(){return this.luminanceRange!==null}set useRange(n){this.luminanceRange=null}get luminanceRange(){return this.uniforms.range.value}set luminanceRange(n){n!==null?this.defines.RANGE="1":delete this.defines.RANGE,this.uniforms.range.value=n,this.needsUpdate=!0}getLuminanceRange(){return this.luminanceRange}setLuminanceRange(n){this.luminanceRange=n}},Cc=class extends Xe{constructor({renderTarget:n,luminanceRange:t,colorOutput:i,resolutionScale:c=1,width:r=Je.AUTO_SIZE,height:e=Je.AUTO_SIZE,resolutionX:s=r,resolutionY:o=e}={}){super("LuminancePass"),this.fullscreenMaterial=new Bc(i,t),this.needsSwap=!1,this.renderTarget=n,this.renderTarget===void 0&&(this.renderTarget=new it(1,1,{depthBuffer:!1}),this.renderTarget.texture.name="LuminancePass.Target");const a=this.resolution=new Je(this,s,o,c);a.addEventListener("change",l=>this.setSize(a.baseWidth,a.baseHeight))}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}render(n,t,i,c,r){const e=this.fullscreenMaterial;e.inputBuffer=t.texture,n.setRenderTarget(this.renderToScreen?null:this.renderTarget),n.render(this.scene,this.camera)}setSize(n,t){const i=this.resolution;i.setBaseSize(n,t),this.renderTarget.setSize(i.width,i.height)}initialize(n,t,i){i!==void 0&&i!==wt&&(this.renderTarget.texture.type=i,this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}},Ec=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#define WEIGHT_INNER 0.125
#define WEIGHT_OUTER 0.0555555
varying vec2 vUv;varying vec2 vUv00;varying vec2 vUv01;varying vec2 vUv02;varying vec2 vUv03;varying vec2 vUv04;varying vec2 vUv05;varying vec2 vUv06;varying vec2 vUv07;varying vec2 vUv08;varying vec2 vUv09;varying vec2 vUv10;varying vec2 vUv11;float clampToBorder(const in vec2 uv){return float(uv.s>=0.0&&uv.s<=1.0&&uv.t>=0.0&&uv.t<=1.0);}void main(){vec4 c=vec4(0.0);vec4 w=WEIGHT_INNER*vec4(clampToBorder(vUv00),clampToBorder(vUv01),clampToBorder(vUv02),clampToBorder(vUv03));c+=w.x*texture2D(inputBuffer,vUv00);c+=w.y*texture2D(inputBuffer,vUv01);c+=w.z*texture2D(inputBuffer,vUv02);c+=w.w*texture2D(inputBuffer,vUv03);w=WEIGHT_OUTER*vec4(clampToBorder(vUv04),clampToBorder(vUv05),clampToBorder(vUv06),clampToBorder(vUv07));c+=w.x*texture2D(inputBuffer,vUv04);c+=w.y*texture2D(inputBuffer,vUv05);c+=w.z*texture2D(inputBuffer,vUv06);c+=w.w*texture2D(inputBuffer,vUv07);w=WEIGHT_OUTER*vec4(clampToBorder(vUv08),clampToBorder(vUv09),clampToBorder(vUv10),clampToBorder(vUv11));c+=w.x*texture2D(inputBuffer,vUv08);c+=w.y*texture2D(inputBuffer,vUv09);c+=w.z*texture2D(inputBuffer,vUv10);c+=w.w*texture2D(inputBuffer,vUv11);c+=WEIGHT_OUTER*texture2D(inputBuffer,vUv);gl_FragColor=c;
#include <colorspace_fragment>
}`,yc="uniform vec2 texelSize;varying vec2 vUv;varying vec2 vUv00;varying vec2 vUv01;varying vec2 vUv02;varying vec2 vUv03;varying vec2 vUv04;varying vec2 vUv05;varying vec2 vUv06;varying vec2 vUv07;varying vec2 vUv08;varying vec2 vUv09;varying vec2 vUv10;varying vec2 vUv11;void main(){vUv=position.xy*0.5+0.5;vUv00=vUv+texelSize*vec2(-1.0,1.0);vUv01=vUv+texelSize*vec2(1.0,1.0);vUv02=vUv+texelSize*vec2(-1.0,-1.0);vUv03=vUv+texelSize*vec2(1.0,-1.0);vUv04=vUv+texelSize*vec2(-2.0,2.0);vUv05=vUv+texelSize*vec2(0.0,2.0);vUv06=vUv+texelSize*vec2(2.0,2.0);vUv07=vUv+texelSize*vec2(-2.0,0.0);vUv08=vUv+texelSize*vec2(2.0,0.0);vUv09=vUv+texelSize*vec2(-2.0,-2.0);vUv10=vUv+texelSize*vec2(0.0,-2.0);vUv11=vUv+texelSize*vec2(2.0,-2.0);gl_Position=vec4(position.xy,1.0,1.0);}",bc=class extends yt{constructor(){super({name:"DownsamplingMaterial",uniforms:{inputBuffer:new be(null),texelSize:new be(new we)},blending:_t,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:Ec,vertexShader:yc})}set inputBuffer(n){this.uniforms.inputBuffer.value=n}setSize(n,t){this.uniforms.texelSize.value.set(1/n,1/t)}},Tc=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;uniform mediump sampler2D supportBuffer;
#else
uniform lowp sampler2D inputBuffer;uniform lowp sampler2D supportBuffer;
#endif
uniform float radius;varying vec2 vUv;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;varying vec2 vUv4;varying vec2 vUv5;varying vec2 vUv6;varying vec2 vUv7;void main(){vec4 c=vec4(0.0);c+=texture2D(inputBuffer,vUv0)*0.0625;c+=texture2D(inputBuffer,vUv1)*0.125;c+=texture2D(inputBuffer,vUv2)*0.0625;c+=texture2D(inputBuffer,vUv3)*0.125;c+=texture2D(inputBuffer,vUv)*0.25;c+=texture2D(inputBuffer,vUv4)*0.125;c+=texture2D(inputBuffer,vUv5)*0.0625;c+=texture2D(inputBuffer,vUv6)*0.125;c+=texture2D(inputBuffer,vUv7)*0.0625;vec4 baseColor=texture2D(supportBuffer,vUv);gl_FragColor=mix(baseColor,c,radius);
#include <colorspace_fragment>
}`,Mc="uniform vec2 texelSize;varying vec2 vUv;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;varying vec2 vUv4;varying vec2 vUv5;varying vec2 vUv6;varying vec2 vUv7;void main(){vUv=position.xy*0.5+0.5;vUv0=vUv+texelSize*vec2(-1.0,1.0);vUv1=vUv+texelSize*vec2(0.0,1.0);vUv2=vUv+texelSize*vec2(1.0,1.0);vUv3=vUv+texelSize*vec2(-1.0,0.0);vUv4=vUv+texelSize*vec2(1.0,0.0);vUv5=vUv+texelSize*vec2(-1.0,-1.0);vUv6=vUv+texelSize*vec2(0.0,-1.0);vUv7=vUv+texelSize*vec2(1.0,-1.0);gl_Position=vec4(position.xy,1.0,1.0);}",xc=class extends yt{constructor(){super({name:"UpsamplingMaterial",uniforms:{inputBuffer:new be(null),supportBuffer:new be(null),texelSize:new be(new we),radius:new be(.85)},blending:_t,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:Tc,vertexShader:Mc})}set inputBuffer(n){this.uniforms.inputBuffer.value=n}set supportBuffer(n){this.uniforms.supportBuffer.value=n}get radius(){return this.uniforms.radius.value}set radius(n){this.uniforms.radius.value=n}setSize(n,t){this.uniforms.texelSize.value.set(1/n,1/t)}},Sc=class extends Xe{constructor(){super("MipmapBlurPass"),this.needsSwap=!1,this.renderTarget=new it(1,1,{depthBuffer:!1}),this.renderTarget.texture.name="Upsampling.Mipmap0",this.downsamplingMipmaps=[],this.upsamplingMipmaps=[],this.downsamplingMaterial=new bc,this.upsamplingMaterial=new xc,this.resolution=new we}get texture(){return this.renderTarget.texture}get levels(){return this.downsamplingMipmaps.length}set levels(n){if(this.levels!==n){const t=this.renderTarget;this.dispose(),this.downsamplingMipmaps=[],this.upsamplingMipmaps=[];for(let i=0;i<n;++i){const c=t.clone();c.texture.name="Downsampling.Mipmap"+i,this.downsamplingMipmaps.push(c)}this.upsamplingMipmaps.push(t);for(let i=1,c=n-1;i<c;++i){const r=t.clone();r.texture.name="Upsampling.Mipmap"+i,this.upsamplingMipmaps.push(r)}this.setSize(this.resolution.x,this.resolution.y)}}get radius(){return this.upsamplingMaterial.radius}set radius(n){this.upsamplingMaterial.radius=n}render(n,t,i,c,r){const{scene:e,camera:s}=this,{downsamplingMaterial:o,upsamplingMaterial:a}=this,{downsamplingMipmaps:l,upsamplingMipmaps:u}=this;let f=t;this.fullscreenMaterial=o;for(let h=0,d=l.length;h<d;++h){const p=l[h];o.setSize(f.width,f.height),o.inputBuffer=f.texture,n.setRenderTarget(p),n.render(e,s),f=p}this.fullscreenMaterial=a;for(let h=u.length-1;h>=0;--h){const d=u[h];a.setSize(f.width,f.height),a.inputBuffer=f.texture,a.supportBuffer=l[h].texture,n.setRenderTarget(d),n.render(e,s),f=d}}setSize(n,t){const i=this.resolution;i.set(n,t);let c=i.width,r=i.height;for(let e=0,s=this.downsamplingMipmaps.length;e<s;++e)c=Math.round(c*.5),r=Math.round(r*.5),this.downsamplingMipmaps[e].setSize(c,r),e<this.upsamplingMipmaps.length&&this.upsamplingMipmaps[e].setSize(c,r)}initialize(n,t,i){if(i!==void 0){const c=this.downsamplingMipmaps.concat(this.upsamplingMipmaps);for(const r of c)r.texture.type=i;if(i!==wt)this.downsamplingMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1",this.upsamplingMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1";else if(n!==null&&n.outputColorSpace===ke)for(const r of c)r.texture.colorSpace=ke}}dispose(){super.dispose();for(const n of this.downsamplingMipmaps.concat(this.upsamplingMipmaps))n.dispose()}},Fc=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D map;
#else
uniform lowp sampler2D map;
#endif
uniform float intensity;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec4 texel=texture2D(map,uv);outputColor=vec4(texel.rgb*intensity,max(inputColor.a,texel.a));}`,Rc=class extends Kr{constructor({blendFunction:n=ye.SCREEN,luminanceThreshold:t=1,luminanceSmoothing:i=.03,mipmapBlur:c=!0,intensity:r=1,radius:e=.85,levels:s=8,kernelSize:o=Wn.LARGE,resolutionScale:a=.5,width:l=Je.AUTO_SIZE,height:u=Je.AUTO_SIZE,resolutionX:f=l,resolutionY:h=u}={}){super("BloomEffect",Fc,{blendFunction:n,uniforms:new Map([["map",new be(null)],["intensity",new be(r)]])}),this.renderTarget=new it(1,1,{depthBuffer:!1}),this.renderTarget.texture.name="Bloom.Target",this.blurPass=new mc({kernelSize:o}),this.luminancePass=new Cc({colorOutput:!0}),this.luminanceMaterial.threshold=t,this.luminanceMaterial.smoothing=i,this.mipmapBlurPass=new Sc,this.mipmapBlurPass.enabled=c,this.mipmapBlurPass.radius=e,this.mipmapBlurPass.levels=s,this.uniforms.get("map").value=c?this.mipmapBlurPass.texture:this.renderTarget.texture;const d=this.resolution=new Je(this,f,h,a);d.addEventListener("change",p=>this.setSize(d.baseWidth,d.baseHeight))}get texture(){return this.mipmapBlurPass.enabled?this.mipmapBlurPass.texture:this.renderTarget.texture}getTexture(){return this.texture}getResolution(){return this.resolution}getBlurPass(){return this.blurPass}getLuminancePass(){return this.luminancePass}get luminanceMaterial(){return this.luminancePass.fullscreenMaterial}getLuminanceMaterial(){return this.luminancePass.fullscreenMaterial}get width(){return this.resolution.width}set width(n){this.resolution.preferredWidth=n}get height(){return this.resolution.height}set height(n){this.resolution.preferredHeight=n}get dithering(){return this.blurPass.dithering}set dithering(n){this.blurPass.dithering=n}get kernelSize(){return this.blurPass.kernelSize}set kernelSize(n){this.blurPass.kernelSize=n}get distinction(){return console.warn(this.name,"distinction was removed"),1}set distinction(n){console.warn(this.name,"distinction was removed")}get intensity(){return this.uniforms.get("intensity").value}set intensity(n){this.uniforms.get("intensity").value=n}getIntensity(){return this.intensity}setIntensity(n){this.intensity=n}getResolutionScale(){return this.resolution.scale}setResolutionScale(n){this.resolution.scale=n}update(n,t,i){const c=this.renderTarget,r=this.luminancePass;r.enabled?(r.render(n,t),this.mipmapBlurPass.enabled?this.mipmapBlurPass.render(n,r.renderTarget):this.blurPass.render(n,r.renderTarget,c)):this.mipmapBlurPass.enabled?this.mipmapBlurPass.render(n,t):this.blurPass.render(n,t,c)}setSize(n,t){const i=this.resolution;i.setBaseSize(n,t),this.renderTarget.setSize(i.width,i.height),this.blurPass.resolution.copy(i),this.luminancePass.setSize(n,t),this.mipmapBlurPass.setSize(n,t)}initialize(n,t,i){this.blurPass.initialize(n,t,i),this.luminancePass.initialize(n,t,i),this.mipmapBlurPass.initialize(n,t,i),i!==void 0&&(this.renderTarget.texture.type=i,n!==null&&n.outputColorSpace===ke&&(this.renderTarget.texture.colorSpace=ke))}},wi=class extends Xe{constructor(n,t,i=null){super("RenderPass",n,t),this.needsSwap=!1,this.clearPass=new Ii,this.overrideMaterialManager=i===null?null:new ks(i),this.ignoreBackground=!1,this.skipShadowMapUpdate=!1,this.selection=null}set mainScene(n){this.scene=n}set mainCamera(n){this.camera=n}get renderToScreen(){return super.renderToScreen}set renderToScreen(n){super.renderToScreen=n,this.clearPass.renderToScreen=n}get overrideMaterial(){const n=this.overrideMaterialManager;return n!==null?n.material:null}set overrideMaterial(n){const t=this.overrideMaterialManager;n!==null?t!==null?t.setMaterial(n):this.overrideMaterialManager=new ks(n):t!==null&&(t.dispose(),this.overrideMaterialManager=null)}getOverrideMaterial(){return this.overrideMaterial}setOverrideMaterial(n){this.overrideMaterial=n}get clear(){return this.clearPass.enabled}set clear(n){this.clearPass.enabled=n}getSelection(){return this.selection}setSelection(n){this.selection=n}isBackgroundDisabled(){return this.ignoreBackground}setBackgroundDisabled(n){this.ignoreBackground=n}isShadowMapDisabled(){return this.skipShadowMapUpdate}setShadowMapDisabled(n){this.skipShadowMapUpdate=n}getClearPass(){return this.clearPass}render(n,t,i,c,r){const e=this.scene,s=this.camera,o=this.selection,a=s.layers.mask,l=e.background,u=n.shadowMap.autoUpdate,f=this.renderToScreen?null:t;o!==null&&s.layers.set(o.getLayer()),this.skipShadowMapUpdate&&(n.shadowMap.autoUpdate=!1),(this.ignoreBackground||this.clearPass.overrideClearColor!==null)&&(e.background=null),this.clearPass.enabled&&this.clearPass.render(n,t),n.setRenderTarget(f),this.overrideMaterialManager!==null?this.overrideMaterialManager.render(n,e,s):n.render(e,s),s.layers.mask=a,e.background=l,n.shadowMap.autoUpdate=u}},ar={DEFAULT:0,ESKIL:1},Dc=`#include <packing>
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
#ifdef DOWNSAMPLE_NORMALS
uniform lowp sampler2D normalBuffer;
#endif
varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
return unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
return texture2D(depthBuffer,uv).r;
#endif
}int findBestDepth(const in float samples[4]){float c=(samples[0]+samples[1]+samples[2]+samples[3])*0.25;float distances[4];distances[0]=abs(c-samples[0]);distances[1]=abs(c-samples[1]);distances[2]=abs(c-samples[2]);distances[3]=abs(c-samples[3]);float maxDistance=max(max(distances[0],distances[1]),max(distances[2],distances[3]));int remaining[3];int rejected[3];int i,j,k;for(i=0,j=0,k=0;i<4;++i){if(distances[i]<maxDistance){remaining[j++]=i;}else{rejected[k++]=i;}}for(;j<3;++j){remaining[j]=rejected[--k];}vec3 s=vec3(samples[remaining[0]],samples[remaining[1]],samples[remaining[2]]);c=(s.x+s.y+s.z)/3.0;distances[0]=abs(c-s.x);distances[1]=abs(c-s.y);distances[2]=abs(c-s.z);float minDistance=min(distances[0],min(distances[1],distances[2]));for(i=0;i<3;++i){if(distances[i]==minDistance){break;}}return remaining[i];}void main(){float d[4];d[0]=readDepth(vUv0);d[1]=readDepth(vUv1);d[2]=readDepth(vUv2);d[3]=readDepth(vUv3);int index=findBestDepth(d);
#ifdef DOWNSAMPLE_NORMALS
vec3 n[4];n[0]=texture2D(normalBuffer,vUv0).rgb;n[1]=texture2D(normalBuffer,vUv1).rgb;n[2]=texture2D(normalBuffer,vUv2).rgb;n[3]=texture2D(normalBuffer,vUv3).rgb;
#else
vec3 n[4];n[0]=vec3(0.0);n[1]=vec3(0.0);n[2]=vec3(0.0);n[3]=vec3(0.0);
#endif
gl_FragColor=vec4(n[index],d[index]);}`,Gc="uniform vec2 texelSize;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec2 uv=position.xy*0.5+0.5;vUv0=uv;vUv1=vec2(uv.x,uv.y+texelSize.y);vUv2=vec2(uv.x+texelSize.x,uv.y);vUv3=uv+texelSize;gl_Position=vec4(position.xy,1.0,1.0);}",Uc=class extends yt{constructor(){super({name:"DepthDownsamplingMaterial",defines:{DEPTH_PACKING:"0"},uniforms:{depthBuffer:new be(null),normalBuffer:new be(null),texelSize:new be(new we)},blending:_t,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:Dc,vertexShader:Gc})}set depthBuffer(n){this.uniforms.depthBuffer.value=n}set depthPacking(n){this.defines.DEPTH_PACKING=n.toFixed(0),this.needsUpdate=!0}setDepthBuffer(n,t=jt){this.depthBuffer=n,this.depthPacking=t}set normalBuffer(n){this.uniforms.normalBuffer.value=n,n!==null?this.defines.DOWNSAMPLE_NORMALS="1":delete this.defines.DOWNSAMPLE_NORMALS,this.needsUpdate=!0}setNormalBuffer(n){this.normalBuffer=n}setTexelSize(n,t){this.uniforms.texelSize.value.set(n,t)}setSize(n,t){this.uniforms.texelSize.value.set(1/n,1/t)}},Ic=class extends Xe{constructor({normalBuffer:n=null,resolutionScale:t=.5,width:i=Je.AUTO_SIZE,height:c=Je.AUTO_SIZE,resolutionX:r=i,resolutionY:e=c}={}){super("DepthDownsamplingPass");const s=new Uc;s.normalBuffer=n,this.fullscreenMaterial=s,this.needsDepthTexture=!0,this.needsSwap=!1,this.renderTarget=new it(1,1,{minFilter:pr,magFilter:pr,depthBuffer:!1,type:li}),this.renderTarget.texture.name="DepthDownsamplingPass.Target",this.renderTarget.texture.generateMipmaps=!1;const o=this.resolution=new Je(this,r,e,t);o.addEventListener("change",a=>this.setSize(o.baseWidth,o.baseHeight))}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}setDepthTexture(n,t=jt){this.fullscreenMaterial.depthBuffer=n,this.fullscreenMaterial.depthPacking=t}render(n,t,i,c,r){n.setRenderTarget(this.renderToScreen?null:this.renderTarget),n.render(this.scene,this.camera)}setSize(n,t){const i=this.resolution;i.setBaseSize(n,t),this.renderTarget.setSize(i.width,i.height),this.fullscreenMaterial.setSize(n,t)}initialize(n,t,i){const c=n.getContext();if(!(c.getExtension("EXT_color_buffer_float")||c.getExtension("EXT_color_buffer_half_float")))throw new Error("Rendering to float texture is not supported.")}},wc=`uniform float offset;uniform float darkness;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){const vec2 center=vec2(0.5);vec3 color=inputColor.rgb;
#if VIGNETTE_TECHNIQUE == 0
float d=distance(uv,center);color*=smoothstep(0.8,offset*0.799,d*(darkness+offset));
#else
vec2 coord=(uv-center)*vec2(offset);color=mix(color,vec3(1.0-darkness),dot(coord,coord));
#endif
outputColor=vec4(color,inputColor.a);}`,_c=class extends Kr{constructor({blendFunction:n,eskil:t=!1,technique:i=t?ar.ESKIL:ar.DEFAULT,offset:c=.5,darkness:r=.5}={}){super("VignetteEffect",wc,{blendFunction:n,defines:new Map([["VIGNETTE_TECHNIQUE",i.toFixed(0)]]),uniforms:new Map([["offset",new be(c)],["darkness",new be(r)]])})}get technique(){return Number(this.defines.get("VIGNETTE_TECHNIQUE"))}set technique(n){this.technique!==n&&(this.defines.set("VIGNETTE_TECHNIQUE",n.toFixed(0)),this.setChanged())}get eskil(){return this.technique===ar.ESKIL}set eskil(n){this.technique=n?ar.ESKIL:ar.DEFAULT}getTechnique(){return this.technique}setTechnique(n){this.technique=n}get offset(){return this.uniforms.get("offset").value}set offset(n){this.uniforms.get("offset").value=n}getOffset(){return this.offset}setOffset(n){this.offset=n}get darkness(){return this.uniforms.get("darkness").value}set darkness(n){this.uniforms.get("darkness").value=n}getDarkness(){return this.darkness}setDarkness(n){this.darkness=n}},Lc=`#include <common>
#include <packing>
#include <dithering_pars_fragment>
#define packFloatToRGBA(v) packDepthToRGBA(v)
#define unpackRGBAToFloat(v) unpackRGBAToDepth(v)
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#if DEPTH_PACKING == 3201
uniform lowp sampler2D depthBuffer;
#elif defined(GL_FRAGMENT_PRECISION_HIGH)
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
uniform vec2 resolution;uniform vec2 texelSize;uniform float cameraNear;uniform float cameraFar;uniform float aspect;uniform float time;varying vec2 vUv;vec4 sRGBToLinear(const in vec4 value){return vec4(mix(pow(value.rgb*0.9478672986+vec3(0.0521327014),vec3(2.4)),value.rgb*0.0773993808,vec3(lessThanEqual(value.rgb,vec3(0.04045)))),value.a);}float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
float depth=unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
float depth=texture2D(depthBuffer,uv).r;
#endif
#if defined(USE_LOGARITHMIC_DEPTH_BUFFER) || defined(LOG_DEPTH)
float d=pow(2.0,depth*log2(cameraFar+1.0))-1.0;float a=cameraFar/(cameraFar-cameraNear);float b=cameraFar*cameraNear/(cameraNear-cameraFar);depth=a+b/d;
#elif defined(USE_REVERSED_DEPTH_BUFFER)
depth=1.0-depth;
#endif
return depth;}float getViewZ(const in float depth){
#ifdef PERSPECTIVE_CAMERA
return perspectiveDepthToViewZ(depth,cameraNear,cameraFar);
#else
return orthographicDepthToViewZ(depth,cameraNear,cameraFar);
#endif
}vec3 RGBToHCV(const in vec3 RGB){vec4 P=mix(vec4(RGB.bg,-1.0,2.0/3.0),vec4(RGB.gb,0.0,-1.0/3.0),step(RGB.b,RGB.g));vec4 Q=mix(vec4(P.xyw,RGB.r),vec4(RGB.r,P.yzx),step(P.x,RGB.r));float C=Q.x-min(Q.w,Q.y);float H=abs((Q.w-Q.y)/(6.0*C+EPSILON)+Q.z);return vec3(H,C,Q.x);}vec3 RGBToHSL(const in vec3 RGB){vec3 HCV=RGBToHCV(RGB);float L=HCV.z-HCV.y*0.5;float S=HCV.y/(1.0-abs(L*2.0-1.0)+EPSILON);return vec3(HCV.x,S,L);}vec3 HueToRGB(const in float H){float R=abs(H*6.0-3.0)-1.0;float G=2.0-abs(H*6.0-2.0);float B=2.0-abs(H*6.0-4.0);return clamp(vec3(R,G,B),0.0,1.0);}vec3 HSLToRGB(const in vec3 HSL){vec3 RGB=HueToRGB(HSL.x);float C=(1.0-abs(2.0*HSL.z-1.0))*HSL.y;return(RGB-0.5)*C+HSL.z;}FRAGMENT_HEAD void main(){FRAGMENT_MAIN_UV vec4 color0=texture2D(inputBuffer,UV);vec4 color1=vec4(0.0);FRAGMENT_MAIN_IMAGE color0.a=clamp(color0.a,0.0,1.0);gl_FragColor=color0;
#ifdef ENCODE_OUTPUT
#include <colorspace_fragment>
#endif
#include <dithering_fragment>
}`,Pc="uniform vec2 resolution;uniform vec2 texelSize;uniform float cameraNear;uniform float cameraFar;uniform float aspect;uniform float time;varying vec2 vUv;VERTEX_HEAD void main(){vUv=position.xy*0.5+0.5;VERTEX_MAIN_SUPPORT gl_Position=vec4(position.xy,1.0,1.0);}",Hc=class extends yt{constructor(n,t,i,c,r=!1){super({name:"EffectMaterial",defines:{THREE_REVISION:Pn.replace(/\D+/g,""),DEPTH_PACKING:"0",ENCODE_OUTPUT:"1"},uniforms:{inputBuffer:new be(null),depthBuffer:new be(null),resolution:new be(new we),texelSize:new be(new we),cameraNear:new be(.3),cameraFar:new be(1e3),aspect:new be(1),time:new be(0)},blending:_t,toneMapped:!1,depthWrite:!1,depthTest:!1,dithering:r}),n&&this.setShaderParts(n),t&&this.setDefines(t),i&&this.setUniforms(i),this.copyCameraSettings(c)}set inputBuffer(n){this.uniforms.inputBuffer.value=n}setInputBuffer(n){this.uniforms.inputBuffer.value=n}get depthBuffer(){return this.uniforms.depthBuffer.value}set depthBuffer(n){this.uniforms.depthBuffer.value=n}get depthPacking(){return Number(this.defines.DEPTH_PACKING)}set depthPacking(n){this.defines.DEPTH_PACKING=n.toFixed(0),this.needsUpdate=!0}setDepthBuffer(n,t=jt){this.depthBuffer=n,this.depthPacking=t}setShaderData(n){this.setShaderParts(n.shaderParts),this.setDefines(n.defines),this.setUniforms(n.uniforms),this.setExtensions(n.extensions)}setShaderParts(n){return this.fragmentShader=Lc.replace(Te.FRAGMENT_HEAD,n.get(Te.FRAGMENT_HEAD)||"").replace(Te.FRAGMENT_MAIN_UV,n.get(Te.FRAGMENT_MAIN_UV)||"").replace(Te.FRAGMENT_MAIN_IMAGE,n.get(Te.FRAGMENT_MAIN_IMAGE)||""),this.vertexShader=Pc.replace(Te.VERTEX_HEAD,n.get(Te.VERTEX_HEAD)||"").replace(Te.VERTEX_MAIN_SUPPORT,n.get(Te.VERTEX_MAIN_SUPPORT)||""),this.needsUpdate=!0,this}setDefines(n){for(const t of n.entries())this.defines[t[0]]=t[1];return this.needsUpdate=!0,this}setUniforms(n){for(const t of n.entries())this.uniforms[t[0]]=t[1];return this}setExtensions(n){this.extensions={};for(const t of n)this.extensions[t]=!0;return this}get encodeOutput(){return this.defines.ENCODE_OUTPUT!==void 0}set encodeOutput(n){this.encodeOutput!==n&&(n?this.defines.ENCODE_OUTPUT="1":delete this.defines.ENCODE_OUTPUT,this.needsUpdate=!0)}isOutputEncodingEnabled(n){return this.encodeOutput}setOutputEncodingEnabled(n){this.encodeOutput=n}get time(){return this.uniforms.time.value}set time(n){this.uniforms.time.value=n}setDeltaTime(n){this.uniforms.time.value+=n}adoptCameraSettings(n){this.copyCameraSettings(n)}copyCameraSettings(n){n&&(this.uniforms.cameraNear.value=n.near,this.uniforms.cameraFar.value=n.far,n instanceof ti?this.defines.PERSPECTIVE_CAMERA="1":delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}setSize(n,t){const i=this.uniforms;i.resolution.value.set(n,t),i.texelSize.value.set(1/n,1/t),i.aspect.value=n/t}static get Section(){return Te}};function Ns(n,t,i){for(const c of t){const r="$1"+n+c.charAt(0).toUpperCase()+c.slice(1),e=new RegExp("([^\\.])(\\b"+c+"\\b)","g");for(const s of i.entries())s[1]!==null&&i.set(s[0],s[1].replace(e,r))}}function Oc(n,t,i){let c=t.getFragmentShader(),r=t.getVertexShader();const e=c!==void 0&&/mainImage/.test(c),s=c!==void 0&&/mainUv/.test(c);if(i.attributes|=t.getAttributes(),c===void 0)throw new Error(`Missing fragment shader (${t.name})`);if(s&&(i.attributes&Ut.CONVOLUTION)!==0)throw new Error(`Effects that transform UVs are incompatible with convolution effects (${t.name})`);if(!e&&!s)throw new Error(`Could not find mainImage or mainUv function (${t.name})`);{const o=/\w+\s+(\w+)\([\w\s,]*\)\s*{/g,a=i.shaderParts;let l=a.get(Te.FRAGMENT_HEAD)||"",u=a.get(Te.FRAGMENT_MAIN_UV)||"",f=a.get(Te.FRAGMENT_MAIN_IMAGE)||"",h=a.get(Te.VERTEX_HEAD)||"",d=a.get(Te.VERTEX_MAIN_SUPPORT)||"";const p=new Set,v=new Set;if(s&&(u+=`	${n}MainUv(UV);
`,i.uvTransformation=!0),r!==null&&/mainSupport/.test(r)){const m=/mainSupport *\([\w\s]*?uv\s*?\)/.test(r);d+=`	${n}MainSupport(`,d+=m?`vUv);
`:`);
`;for(const C of r.matchAll(/(?:varying\s+\w+\s+([\S\s]*?);)/g))for(const g of C[1].split(/\s*,\s*/))i.varyings.add(g),p.add(g),v.add(g);for(const C of r.matchAll(o))v.add(C[1])}for(const m of c.matchAll(o))v.add(m[1]);for(const m of t.defines.keys())v.add(m.replace(/\([\w\s,]*\)/g,""));for(const m of t.uniforms.keys())v.add(m);v.delete("while"),v.delete("for"),v.delete("if"),t.uniforms.forEach((m,C)=>i.uniforms.set(n+C.charAt(0).toUpperCase()+C.slice(1),m)),t.defines.forEach((m,C)=>i.defines.set(n+C.charAt(0).toUpperCase()+C.slice(1),m));const A=new Map([["fragment",c],["vertex",r]]);Ns(n,v,i.defines),Ns(n,v,A),c=A.get("fragment"),r=A.get("vertex");const E=t.blendMode;if(i.blendModes.set(E.blendFunction,E),e){t.inputColorSpace!==null&&t.inputColorSpace!==i.colorSpace&&(f+=t.inputColorSpace===ke?`color0 = sRGBTransferOETF(color0);
	`:`color0 = sRGBToLinear(color0);
	`),t.outputColorSpace!==ui?i.colorSpace=t.outputColorSpace:t.inputColorSpace!==null&&(i.colorSpace=t.inputColorSpace);const m=/MainImage *\([\w\s,]*?depth[\w\s,]*?\)/;f+=`${n}MainImage(color0, UV, `,(i.attributes&Ut.DEPTH)!==0&&m.test(c)&&(f+="depth, ",i.readDepth=!0),f+=`color1);
	`;const C=n+"BlendOpacity";i.uniforms.set(C,E.opacity),f+=`color0 = blend${E.blendFunction}(color0, color1, ${C});

	`,l+=`uniform float ${C};

`}if(l+=c+`
`,r!==null&&(h+=r+`
`),a.set(Te.FRAGMENT_HEAD,l),a.set(Te.FRAGMENT_MAIN_UV,u),a.set(Te.FRAGMENT_MAIN_IMAGE,f),a.set(Te.VERTEX_HEAD,h),a.set(Te.VERTEX_MAIN_SUPPORT,d),t.extensions!==null)for(const m of t.extensions)i.extensions.add(m)}}var kc=class extends Xe{constructor(n,...t){super("EffectPass"),this.fullscreenMaterial=new Hc(null,null,null,n),this.listener=i=>this.handleEvent(i),this.effects=[],this.setEffects(t),this.skipRendering=!1,this.minTime=1,this.maxTime=Number.POSITIVE_INFINITY,this.timeScale=1}set mainScene(n){for(const t of this.effects)t.mainScene=n}set mainCamera(n){this.fullscreenMaterial.copyCameraSettings(n);for(const t of this.effects)t.mainCamera=n}get encodeOutput(){return this.fullscreenMaterial.encodeOutput}set encodeOutput(n){this.fullscreenMaterial.encodeOutput=n}get dithering(){return this.fullscreenMaterial.dithering}set dithering(n){const t=this.fullscreenMaterial;t.dithering=n,t.needsUpdate=!0}setEffects(n){for(const t of this.effects)t.removeEventListener("change",this.listener);this.effects=n.sort((t,i)=>i.attributes-t.attributes);for(const t of this.effects)t.addEventListener("change",this.listener)}updateMaterial(){const n=new Il;let t=0;for(const s of this.effects)if(s.blendMode.blendFunction===ye.DST)n.attributes|=s.getAttributes()&Ut.DEPTH;else{if((n.attributes&s.getAttributes()&Ut.CONVOLUTION)!==0)throw new Error(`Convolution effects cannot be merged (${s.name})`);Oc("e"+t++,s,n)}let i=n.shaderParts.get(Te.FRAGMENT_HEAD),c=n.shaderParts.get(Te.FRAGMENT_MAIN_IMAGE),r=n.shaderParts.get(Te.FRAGMENT_MAIN_UV);const e=/\bblend\b/g;for(const s of n.blendModes.values())i+=s.getShaderCode().replace(e,`blend${s.blendFunction}`)+`
`;(n.attributes&Ut.DEPTH)!==0?(n.readDepth&&(c=`float depth = readDepth(UV);

	`+c),this.needsDepthTexture=this.getDepthTexture()===null):this.needsDepthTexture=!1,n.colorSpace===ke&&(c+=`color0 = sRGBToLinear(color0);
	`),n.uvTransformation?(r=`vec2 transformedUv = vUv;
`+r,n.defines.set("UV","transformedUv")):n.defines.set("UV","vUv"),n.shaderParts.set(Te.FRAGMENT_HEAD,i),n.shaderParts.set(Te.FRAGMENT_MAIN_IMAGE,c),n.shaderParts.set(Te.FRAGMENT_MAIN_UV,r);for(const[s,o]of n.shaderParts)o!==null&&n.shaderParts.set(s,o.trim().replace(/^#/,`
#`));this.skipRendering=t===0,this.needsSwap=!this.skipRendering,this.fullscreenMaterial.setShaderData(n)}recompile(){this.updateMaterial()}getDepthTexture(){return this.fullscreenMaterial.depthBuffer}setDepthTexture(n,t=jt){this.fullscreenMaterial.depthBuffer=n,this.fullscreenMaterial.depthPacking=t;for(const i of this.effects)i.setDepthTexture(n,t)}render(n,t,i,c,r){for(const e of this.effects)e.update(n,t,c);if(!this.skipRendering||this.renderToScreen){const e=this.fullscreenMaterial;e.inputBuffer=t.texture,e.time+=c*this.timeScale,n.setRenderTarget(this.renderToScreen?null:i),n.render(this.scene,this.camera)}}setSize(n,t){this.fullscreenMaterial.setSize(n,t);for(const i of this.effects)i.setSize(n,t)}initialize(n,t,i){this.renderer=n;for(const c of this.effects)c.initialize(n,t,i);this.updateMaterial(),i!==void 0&&i!==wt&&(this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}dispose(){super.dispose();for(const n of this.effects)n.removeEventListener("change",this.listener),n.dispose()}handleEvent(n){switch(n.type){case"change":this.recompile();break}}},Nc=class extends Xe{constructor(n,t,{renderTarget:i,resolutionScale:c=1,width:r=Je.AUTO_SIZE,height:e=Je.AUTO_SIZE,resolutionX:s=r,resolutionY:o=e}={}){super("NormalPass"),this.needsSwap=!1,this.renderPass=new wi(n,t,new Sa);const a=this.renderPass;a.ignoreBackground=!0,a.skipShadowMapUpdate=!0;const l=a.getClearPass();l.overrideClearColor=new Ye(7829503),l.overrideClearAlpha=1,this.renderTarget=i,this.renderTarget===void 0&&(this.renderTarget=new it(1,1,{minFilter:pr,magFilter:pr}),this.renderTarget.texture.name="NormalPass.Target");const u=this.resolution=new Je(this,s,o,c);u.addEventListener("change",f=>this.setSize(u.baseWidth,u.baseHeight))}set mainScene(n){this.renderPass.mainScene=n}set mainCamera(n){this.renderPass.mainCamera=n}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}getResolutionScale(){return this.resolution.scale}setResolutionScale(n){this.resolution.scale=n}render(n,t,i,c,r){const e=this.renderToScreen?null:this.renderTarget;this.renderPass.render(n,e,e)}setSize(n,t){const i=this.resolution;i.setBaseSize(n,t),this.renderTarget.setSize(i.width,i.height)}};function dr(n,t,i){return t in n?Object.defineProperty(n,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):n[t]=i,n}new we;new we;function _i(n,t){if(!(n instanceof t))throw new TypeError("Cannot call a class as a function")}var Ze=function n(t,i,c){var r=this;_i(this,n),dr(this,"dot2",function(e,s){return r.x*e+r.y*s}),dr(this,"dot3",function(e,s,o){return r.x*e+r.y*s+r.z*o}),this.x=t,this.y=i,this.z=c},Jc=[new Ze(1,1,0),new Ze(-1,1,0),new Ze(1,-1,0),new Ze(-1,-1,0),new Ze(1,0,1),new Ze(-1,0,1),new Ze(1,0,-1),new Ze(-1,0,-1),new Ze(0,1,1),new Ze(0,-1,1),new Ze(0,1,-1),new Ze(0,-1,-1)],Js=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],Ks=new Array(512),js=new Array(512),Kc=function(t){t>0&&t<1&&(t*=65536),t=Math.floor(t),t<256&&(t|=t<<8);for(var i=0;i<256;i++){var c;i&1?c=Js[i]^t&255:c=Js[i]^t>>8&255,Ks[i]=Ks[i+256]=c,js[i]=js[i+256]=Jc[c%12]}};Kc(0);function jc(n){if(typeof n=="number")n=Math.abs(n);else if(typeof n=="string"){var t=n;n=0;for(var i=0;i<t.length;i++)n=(n+(i+1)*(t.charCodeAt(i)%96))%2147483647}return n===0&&(n=311),n}function zs(n){var t=jc(n);return function(){var i=t*48271%2147483647;return t=i,i/2147483647}}var zc=function n(t){var i=this;_i(this,n),dr(this,"seed",0),dr(this,"init",function(c){i.seed=c,i.value=zs(c)}),dr(this,"value",zs(this.seed)),this.init(t)};new zc(Math.random());const Wc=X.createContext(null),Ws=n=>(n.getAttributes()&2)===2,Qc=X.memo(X.forwardRef(({children:n,camera:t,scene:i,resolutionScale:c,enabled:r=!0,renderPriority:e=1,autoClear:s=!0,depthBuffer:o,enableNormalPass:a,stencilBuffer:l,multisampling:u=8,frameBufferType:f=ai},h)=>{const{gl:d,scene:p,camera:v,size:A}=st(),E=i||p,m=t||v,[C,g,T]=X.useMemo(()=>{const b=new Ul(d,{depthBuffer:o,stencilBuffer:l,multisampling:u,frameBufferType:f});b.addPass(new wi(E,m));let U=null,S=null;return a&&(S=new Nc(E,m),S.enabled=!1,b.addPass(S),c!==void 0&&(U=new Ic({normalBuffer:S.texture,resolutionScale:c}),U.enabled=!1,b.addPass(U))),[b,S,U]},[m,d,o,l,u,f,E,a,c]);X.useEffect(()=>C?.setSize(A.width,A.height),[C,A]),bt((b,U)=>{if(r){const S=d.autoClear;d.autoClear=s,l&&!s&&d.clearStencil(),C.render(U),d.autoClear=S}},r?e:0);const G=X.useRef(null);X.useLayoutEffect(()=>{const b=[],U=G.current.__r3f;if(U&&C){const S=U.children;for(let k=0;k<S.length;k++){const y=S[k].object;if(y instanceof Kr){const w=[y];if(!Ws(y)){let j=null;for(;(j=S[k+1]?.object)instanceof Kr&&!Ws(j);)w.push(j),k++}const F=new kc(m,...w);b.push(F)}else y instanceof Xe&&b.push(y)}for(const k of b)C?.addPass(k);g&&(g.enabled=!0),T&&(T.enabled=!0)}return()=>{for(const S of b)C?.removePass(S);g&&(g.enabled=!1),T&&(T.enabled=!1)}},[C,n,m,g,T]),X.useEffect(()=>{const b=d.toneMapping;return d.toneMapping=Ra,()=>{d.toneMapping=b}},[d]);const M=X.useMemo(()=>({composer:C,normalPass:g,downSamplingPass:T,resolutionScale:c,camera:m,scene:E}),[C,g,T,c,m,E]);return X.useImperativeHandle(h,()=>C,[C]),z.jsx(Wc.Provider,{value:M,children:z.jsx("group",{ref:G,children:n})})}));let Xc=0;const Qs=new WeakMap,Li=(n,t)=>function({blendFunction:i=t?.blendFunction,opacity:c=t?.opacity,...r}){let e=Qs.get(n);if(!e){const a=`@react-three/postprocessing/${n.name}-${Xc++}`;Ga({[a]:n}),Qs.set(n,e=a)}const s=st(a=>a.camera),o=Ki.useMemo(()=>[...t?.args??[],...r.args??[{...t,...r}]],[JSON.stringify(r)]);return z.jsx(e,{camera:s,"blendMode-blendFunction":i,"blendMode-opacity-value":c,...r,args:o})},Vc=Li(Rc,{blendFunction:0}),Yc=Li(_c),Zc=()=>z.jsxs(Qc,{disableNormalPass:!0,children:[z.jsx(Vc,{luminanceThreshold:1,mipmapBlur:!0,intensity:1.5,radius:.6}),z.jsx(Yc,{eskil:!1,offset:.1,darkness:.5})]}),qc=()=>{const{gl:n,scene:t,camera:i}=st(),c=nt(r=>r.setSceneReady);return X.useEffect(()=>{n.compile(t,i);const r=setTimeout(()=>{c(!0)},100);return()=>{clearTimeout(r),c(!1)}},[n,t,i,c]),null};function au(){return z.jsxs(z.Fragment,{children:[z.jsx(qc,{}),z.jsx("color",{attach:"background",args:["#aaddff"]}),z.jsx("fog",{attach:"fog",args:["#aaddff",10,130]}),z.jsx(ml,{makeDefault:!0,position:[0,30,30],zoom:40,near:-50,far:200}),z.jsx("ambientLight",{intensity:.6,color:"#ffeebb"}),z.jsx("directionalLight",{position:[10,20,5],intensity:1.5,castShadow:!0,"shadow-mapSize":[1024,1024],color:"#ffeedd",children:z.jsx("orthographicCamera",{attach:"shadow-camera",args:[-30,30,30,-30]})}),z.jsx(yl,{}),z.jsx(bl,{}),z.jsx(Zc,{})]})}export{au as default};
