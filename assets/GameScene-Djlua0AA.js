import{j as e,r as a,l as se}from"./vendor-core-p6T6tmdW.js";import{u as w}from"./index-BUSrx3vq.js";import{b as ne,R as oe,c as I,d as K,a as Z,F as _,T as J,O as Q,A as re,D as ae,V as C,e as ee,f as ie,M as X,g as ce,w as le,q as ue,h as de}from"./vendor-three-Dxm0pZ8k.js";const D="/",N=t=>t.startsWith("/")?t.substring(1):t,me=()=>{const t=ne(`${D}textures/grass.jpg`);return t.wrapS=t.wrapT=oe,t.repeat.set(30,30),e.jsxs("mesh",{rotation:[-Math.PI/2,0,0],position:[0,-.1,0],receiveShadow:!0,children:[e.jsx("planeGeometry",{args:[100,100]}),e.jsx("meshStandardMaterial",{map:t,color:"#90a880",roughness:.8})]})},G=({position:t,rotationY:o=0,modelPath:r,name:i,scale:n=1,signSide:d,extraHitbox:m=null})=>{const x=w(c=>c.setZone),u=w(c=>c.currentZone),p=w(c=>c.enableReadingMode),A=w(c=>c.isReadingMode),f=w(c=>c.content)[i]?.title||i,{scene:z}=I(D+N(r)),M=a.useMemo(()=>K.clone(z),[z]),{scene:v}=I(`${D}models/props/sign.glb`),F=a.useMemo(()=>K.clone(v),[v]),[k,E]=a.useState(!1);a.useEffect(()=>{M.traverse(c=>{c.isMesh&&(c.castShadow=!0,c.receiveShadow=!0)})},[M]),a.useEffect(()=>(k?document.body.classList.add("hovering-3d"):document.body.classList.remove("hovering-3d"),()=>{document.body.classList.remove("hovering-3d")}),[k]),Z(c=>{if(A)return;const B=c.scene.getObjectByName("Player");if(B){const P=B.position.distanceTo(new C(...t));P<4&&u!==i?x(i):u===i&&P>4.1&&x(null)}});const O=u===i||k;let L=0,T=0,S=0,l=2;d==="right"?(L=2.5,T=.5,S=-.1):d==="left"?(L=-2.5,T=-.5,S=.1):d==="center"&&(l=3.2);const y=c=>{c.stopPropagation(),x(i),p(!0)},h=c=>{c.stopPropagation(),E(!0)},R=c=>E(!1);return e.jsxs("group",{position:t,children:[e.jsxs("mesh",{position:[0,0,0],onClick:y,onPointerOver:h,onPointerOut:R,children:[e.jsx("cylinderGeometry",{args:[3.5,3.5,0,16]}),e.jsx("meshBasicMaterial",{visible:!1})]}),m&&e.jsxs("mesh",{position:m.position||[0,0,0],onClick:y,onPointerOver:h,onPointerOut:R,children:[e.jsx("cylinderGeometry",{args:m.args}),e.jsx("meshBasicMaterial",{visible:!1})]}),e.jsx("group",{rotation:[0,o,0],scale:n,children:e.jsx("primitive",{object:M})}),e.jsxs("group",{position:[L,0,l],rotation:[0,T,0],children:[e.jsx("primitive",{object:F,scale:1}),e.jsx(_,{speed:4,rotationIntensity:.1,floatIntensity:.1,children:e.jsx(J,{font:`${D}${N("/fonts/PersonalFont.ttf")}`,position:[S,1.6,.3],fontSize:.3,color:O?"#ffd700":"white",anchorX:"center",anchorY:"middle",outlineWidth:.02,outlineColor:"#000000",children:f})}),O&&e.jsx(_,{speed:10,rotationIntensity:0,floatIntensity:.5,children:e.jsx(J,{position:[S,2.2,.3],fontSize:.5,color:"#ffd700",outlineWidth:.02,outlineColor:"black",children:"â–¼"})})]}),e.jsxs("mesh",{rotation:[-Math.PI/2,0,0],position:[0,.05,0],receiveShadow:!0,children:[e.jsx("circleGeometry",{args:[3.5,32]}),e.jsx("meshStandardMaterial",{color:"white",opacity:.1,transparent:!0})]})]})},b=({modelPath:t,position:o,scale:r=1,rotation:i=[0,0,0]})=>{const{scene:n}=I(D+N(t)),d=a.useMemo(()=>K.clone(n),[n]);return a.useEffect(()=>{d.traverse(m=>{m.isMesh&&(m.castShadow=!0,m.receiveShadow=!0)})},[d]),e.jsx("group",{position:o,rotation:i,scale:r,children:e.jsx("primitive",{object:d})})},fe=()=>{const t=a.useRef(),o=100,r=a.useMemo(()=>new Q,[]),i=a.useMemo(()=>{const n=[];for(let d=0;d<o;d++){const m=Math.sqrt(Math.random())*25,x=Math.random()*2*Math.PI,u=m*Math.cos(x),p=m*Math.sin(x);n.push({t:Math.random()*100,speed:.005+Math.random()*.015,x:u,y:Math.random()*5+.5,z:p,radiusOffset:Math.random()*2})}return n},[]);return Z(()=>{t.current&&(i.forEach((n,d)=>{n.t+=n.speed;const m=n.x+Math.cos(n.t)*n.radiusOffset,x=n.z+Math.sin(n.t)*n.radiusOffset,u=n.y+Math.sin(n.t*2)*.5;r.position.set(m,u,x);const p=.5+Math.sin(n.t*5)*.3;r.scale.set(p,p,p),r.updateMatrix(),t.current.setMatrixAt(d,r.matrix)}),t.current.instanceMatrix.needsUpdate=!0)}),e.jsxs("instancedMesh",{ref:t,args:[null,null,o],children:[e.jsx("sphereGeometry",{args:[.08,6,6]}),e.jsx("meshBasicMaterial",{color:[3,3,0],toneMapped:!1,transparent:!0,opacity:.8,blending:re})]})},he=()=>{const t=a.useRef(),o=17,r=80;return Z(i=>{if(t.current){const n=i.clock.getElapsedTime();t.current.rotation.z-=.005,t.current.material&&(t.current.material.opacity=.3+Math.sin(n*2)*.15)}}),e.jsxs("group",{position:[0,.02,0],rotation:[-Math.PI/2,0,0],children:[e.jsxs("mesh",{ref:t,children:[e.jsx("ringGeometry",{args:[o-.4,o,64]}),e.jsx("meshBasicMaterial",{color:"#aaddff",transparent:!0,opacity:.3,side:ae})]}),e.jsxs("mesh",{position:[0,0,.01],children:[e.jsx("ringGeometry",{args:[o-.1,o,64]}),e.jsx("meshBasicMaterial",{color:"#ffffff",transparent:!0,opacity:.15})]}),e.jsxs("mesh",{position:[0,0,-.01],children:[e.jsx("ringGeometry",{args:[o,r,64]}),e.jsx("meshBasicMaterial",{color:"#051020",opacity:.5,transparent:!0})]})]})};function xe(){return e.jsxs("group",{children:[e.jsx(me,{}),e.jsx(G,{position:[-10,0,-4],modelPath:"/models/buildings/house.glb",name:"Propos",rotationY:Math.PI/6,scale:8,signSide:"right",extraHitbox:{args:[.3,2.5,3,16],position:[-.7,1.7,0]}}),e.jsx(G,{position:[10,0,-4],modelPath:"/models/buildings/runeStone.glb",name:"Parcours",rotationY:-Math.PI-3.3,scale:2.5,signSide:"left",extraHitbox:{args:[.3,2,3,16],position:[-.3,1.3,0]}}),e.jsx(G,{position:[-8,0,8],modelPath:"/models/buildings/tower.glb",name:"Projets",rotationY:Math.PI/7,scale:.3,signSide:"right",extraHitbox:{args:[1.3,1.3,3,16],position:[0,2,0]}}),e.jsx(G,{position:[8,0,8],modelPath:"/models/buildings/treeStump.glb",name:"Competences",rotationY:-Math.PI,scale:12,signSide:"left"}),e.jsx(G,{position:[0,0,-10],modelPath:"/models/buildings/fountain.glb",name:"Loisirs",rotationY:0,scale:3,signSide:"center"}),e.jsx(b,{modelPath:"/models/nature/rock.glb",position:[0,0,9],scale:4}),e.jsx(b,{modelPath:"/models/nature/bush.glb",position:[1.5,0,8.5],scale:4}),e.jsx(b,{modelPath:"/models/nature/bush.glb",position:[-1.5,0,8.5],scale:4}),e.jsx(b,{modelPath:"/models/nature/tree.glb",position:[-10,2,2],scale:1.4}),e.jsx(b,{modelPath:"/models/nature/rock.glb",position:[-9,0,3],scale:3}),e.jsx(b,{modelPath:"/models/nature/tree.glb",position:[10,2,2],scale:1.4,rotation:[0,3,0]}),e.jsx(b,{modelPath:"/models/nature/rock.glb",position:[9,0,3],scale:3,rotation:[0,1,0]}),e.jsx(b,{modelPath:"/models/nature/bush.glb",position:[-5,0,-8],scale:6}),e.jsx(b,{modelPath:"/models/nature/tree.glb",position:[-6,2,-9],scale:1.3}),e.jsx(b,{modelPath:"/models/nature/bush.glb",position:[5,0,-8],scale:6,rotation:[0,.5,0]}),e.jsx(b,{modelPath:"/models/nature/tree.glb",position:[6,2,-9],scale:1.3,rotation:[0,2,0]}),e.jsx(fe,{}),e.jsx(he,{})]})}const q="/",pe=()=>{const t=a.useRef(),{camera:o}=ee(),r=a.useRef({}),i=7,n=17,[d,m]=a.useState(!1),x=w(l=>l.isSceneReady),u=a.useRef({scale:0,y:15}),{scene:p}=I(`${q}character/skin.glb`),{animations:A}=I(`${q}character/animations.glb`),{animations:s}=I(`${q}character/idle.glb`),f=a.useMemo(()=>[...s,...A],[s,A]),z=se.useMemo(()=>K.clone(p),[p]),{actions:M}=ie(f,t),v=w(l=>l.currentZone),F=w(l=>l.isReadingMode),k=w(l=>l.enableReadingMode),[E,O]=a.useState(""),[L,T]=a.useState({idle:"",run:""}),S=a.useRef(new C);return a.useEffect(()=>{if(f.length>0){const l=f.find(h=>h.name.match(/idle/i))?.name||f[0].name,y=f.find(h=>h.name.match(/run|walk/i))?.name||f[1]?.name;T({idle:l,run:y}),M[l]&&(M[l].reset().fadeIn(.5).play(),O(l))}},[f,M]),a.useEffect(()=>{z.traverse(l=>{l.isMesh&&(l.castShadow=!0)})},[z]),a.useEffect(()=>{if(x){const l=setTimeout(()=>{m(!0)},1e3);return()=>clearTimeout(l)}},[x]),a.useEffect(()=>{const l=h=>{r.current[h.code]=!0,h.code==="Space"&&v&&k(!0)},y=h=>r.current[h.code]=!1;return window.addEventListener("keydown",l),window.addEventListener("keyup",y),()=>{window.removeEventListener("keydown",l),window.removeEventListener("keyup",y)}},[v,k]),Z((l,y)=>{if(!t.current)return;const h=Math.min(y,.1);d?(u.current.scale=X.lerp(u.current.scale,1.1,h*3),u.current.y=X.lerp(u.current.y,0,h*3),u.current.y<0&&(u.current.y=0)):u.current={scale:0,y:15},t.current.scale.setScalar(u.current.scale),t.current.position.y=u.current.y;let R=0,c=0;!F&&d&&((r.current.ArrowUp||r.current.KeyW)&&(c-=1),(r.current.ArrowDown||r.current.KeyS)&&(c+=1),(r.current.ArrowLeft||r.current.KeyA)&&(R-=1),(r.current.ArrowRight||r.current.KeyD)&&(R+=1));const B=R!==0||c!==0;if(B){const g=new C(R,0,c).normalize();let j=t.current.position.x+g.x*i*y,U=t.current.position.z+g.z*i*y;const H=Math.sqrt(j*j+U*U);if(H>n){const V=n/H;j*=V,U*=V}t.current.position.x=j,t.current.position.z=U;const te=Math.atan2(g.x,g.z);t.current.rotation.y=te}const P=B?L.run:L.idle;P&&E!==P&&M[P]&&(M[E]&&M[E].fadeOut(.2),M[P].reset().fadeIn(.2).play(),O(P));const $=new C,W=new C;let Y=40;if(F&&v){let g=0,j=0;switch(v){case"Propos":g=-10,j=-4;break;case"Parcours":g=10,j=-4;break;case"Projets":g=-8,j=8;break;case"Competences":g=8,j=8;break;case"Loisirs":g=0,j=-10;break}$.set(g+10,20,j+10),W.set(g,0,j),Y=60}else $.set(t.current.position.x,20,t.current.position.z+30),W.set(t.current.position.x,0,t.current.position.z),Y=40;o.position.lerp($,.1),o.zoom=X.lerp(o.zoom,Y,.05),S.current.lerp(W,.1),o.lookAt(S.current),o.updateProjectionMatrix()}),e.jsxs(e.Fragment,{children:[e.jsxs("group",{ref:t,name:"Player",children:[e.jsx("primitive",{object:z}),e.jsxs("mesh",{rotation:[-Math.PI/2,0,0],position:[0,.05,0],children:[e.jsx("circleGeometry",{args:[.4,16]}),e.jsx("meshBasicMaterial",{color:"black",opacity:.2,transparent:!0})]})]}),e.jsx(ge,{playerRef:t,keys:r})]})},ge=({playerRef:t,keys:o})=>{const r=a.useRef(),i=a.useMemo(()=>new Q,[]),n=30,d=a.useMemo(()=>new Array(n).fill(0).map(()=>({active:!1,x:0,y:0,z:0,vx:0,vz:0,scale:0,life:0})),[]),m=a.useRef(0);return Z((x,u)=>{if(!t.current||!r.current)return;const p=x.clock.getElapsedTime(),A=o.current.ArrowUp||o.current.KeyW||o.current.ArrowDown||o.current.KeyS||o.current.ArrowLeft||o.current.KeyA||o.current.ArrowRight||o.current.KeyD;if(m.current+=u,A&&m.current>.08){m.current=0;const s=d.find(f=>!f.active);if(s){const f=t.current.position;s.active=!0,s.life=1,s.scale=1,s.x=f.x+(Math.random()-.5)*.5,s.y=.1,s.z=f.z+(Math.random()-.5)*.5,s.vx=(Math.random()-.5)*.5,s.vz=(Math.random()-.5)*.5}}d.forEach((s,f)=>{s.active?(s.life-=u*1.5,s.life<=0?(s.active=!1,s.scale=0):(s.scale=s.life,s.y+=u*.5,s.x+=s.vx*u,s.z+=s.vz*u)):s.scale=0,i.position.set(s.x,s.y,s.z),i.scale.set(s.scale,s.scale,s.scale),i.rotation.set(0,p*2+f,0),i.updateMatrix(),r.current.setMatrixAt(f,i.matrix)}),r.current.instanceMatrix.needsUpdate=!0}),e.jsxs("instancedMesh",{ref:r,args:[null,null,n],frustumCulled:!1,children:[e.jsx("circleGeometry",{args:[.3,8]}),e.jsx("meshBasicMaterial",{color:"#dddddd",transparent:!0,opacity:.4})]})},je=()=>e.jsxs(ce,{disableNormalPass:!0,children:[e.jsx(le,{luminanceThreshold:1,mipmapBlur:!0,intensity:1.5,radius:.6}),e.jsx(ue,{eskil:!1,offset:.1,darkness:.5})]}),Me=()=>{const{gl:t,scene:o,camera:r}=ee(),i=w(n=>n.setSceneReady);return a.useEffect(()=>{t.compile(o,r);const n=setTimeout(()=>{i(!0)},100);return()=>clearTimeout(n)},[t,o,r,i]),null};function Pe(){return e.jsxs(e.Fragment,{children:[e.jsx(Me,{}),e.jsx("color",{attach:"background",args:["#aaddff"]}),e.jsx("fog",{attach:"fog",args:["#aaddff",10,130]}),e.jsx(de,{makeDefault:!0,position:[0,30,30],zoom:40,near:-50,far:200}),e.jsx("ambientLight",{intensity:.6,color:"#ffeebb"}),e.jsx("directionalLight",{position:[10,20,5],intensity:1.5,castShadow:!0,"shadow-mapSize":[1024,1024],color:"#ffeedd",children:e.jsx("orthographicCamera",{attach:"shadow-camera",args:[-30,30,30,-30]})}),e.jsx(xe,{}),e.jsx(pe,{}),e.jsx(je,{})]})}export{Pe as default};
